<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg ¬∑ Buscar</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#08080d; --bg2:#0e0e16; --surface:#11111c; --surface2:#181825;
  --border:#22223a; --border2:#2d2d4a;
  --accent:#d4f53c; --accent-glow:rgba(212,245,60,0.15); --accent-dim:rgba(212,245,60,0.06);
  --text:#eeeef8; --text2:#9898b8; --text3:#55556a;
  --nm:#2ed573; --lp:#ffa502; --mp:#ff4757;
  --nm-bg:rgba(46,213,115,0.08); --lp-bg:rgba(255,165,2,0.08); --mp-bg:rgba(255,71,87,0.08);
  --psa10:#d4f53c; --psa9:#38bdf8; --psa8:#a78bfa;
  --sealed:#f59e0b; --sealed-bg:rgba(245,158,11,0.08);
  --font-display:'Bebas Neue',sans-serif;
  --font-mono:'DM Mono',monospace;
  --font-body:'Plus Jakarta Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay;}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* NAV */
nav{display:flex;align-items:center;gap:16px;padding:0 40px;height:60px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(8,8,13,0.96);backdrop-filter:blur(24px);z-index:100;}
.logo{font-family:var(--font-display);font-size:1.8rem;letter-spacing:3px;cursor:pointer;flex-shrink:0;}
.logo .dot{color:var(--accent);}

/* SEARCH BAR ‚Äî main element */
.search-wrap{flex:1;display:flex;align-items:center;gap:0;background:var(--surface);border:1px solid var(--border2);border-radius:8px;overflow:hidden;transition:border-color 0.15s;max-width:680px;}
.search-wrap:focus-within{border-color:var(--accent);}
.search-type-select{padding:0 14px;height:40px;background:var(--surface2);border:none;border-right:1px solid var(--border2);color:var(--text2);font-family:var(--font-mono);font-size:0.7rem;letter-spacing:0.5px;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%2355556a'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px;}
.search-type-select:focus{outline:none;}
.search-input{flex:1;height:40px;background:none;border:none;padding:0 14px;color:var(--text);font-family:var(--font-mono);font-size:0.82rem;outline:none;letter-spacing:0.3px;}
.search-input::placeholder{color:var(--text3);}
.search-btn{width:44px;height:40px;background:var(--accent);border:none;color:#08080d;font-size:1rem;cursor:pointer;transition:all 0.15s;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.search-btn:hover{box-shadow:inset 0 0 12px rgba(0,0,0,0.1);}

.nav-right{display:flex;gap:10px;align-items:center;margin-left:auto;flex-shrink:0;}
.btn-outline{padding:7px 16px;border:1px solid var(--border2);border-radius:5px;background:none;color:var(--text2);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-outline:hover{border-color:var(--accent);color:var(--accent);}
.btn-accent{padding:7px 18px;border:none;border-radius:5px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all 0.15s;}
.btn-accent:hover{box-shadow:0 0 20px var(--accent-glow);}

/* RESULTS BAR */
.results-bar{padding:14px 40px;border-bottom:1px solid var(--border);background:var(--bg2);display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;}
.rb-left{display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
.rb-query{font-family:var(--font-display);font-size:1.4rem;letter-spacing:1px;}
.rb-query .q{color:var(--accent);}
.rb-count{font-family:var(--font-mono);font-size:0.7rem;color:var(--text3);letter-spacing:0.5px;}
.rb-right{display:flex;align-items:center;gap:8px;}
.sort-label{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:1px;text-transform:uppercase;}
.sort-select{background:var(--surface);border:1px solid var(--border);border-radius:5px;padding:6px 28px 6px 10px;color:var(--text2);font-family:var(--font-mono);font-size:0.7rem;outline:none;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%2355556a'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;transition:border-color 0.15s;}
.sort-select:focus{border-color:var(--accent);}

/* LAYOUT */
.page-layout{display:grid;grid-template-columns:260px 1fr;max-width:1400px;margin:0 auto;min-height:calc(100vh - 120px);}

/* FILTERS SIDEBAR */
.filters-panel{border-right:1px solid var(--border);padding:24px 20px;position:sticky;top:60px;height:calc(100vh - 60px);overflow-y:auto;}
.fp-title{font-family:var(--font-display);font-size:1rem;letter-spacing:2px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;}
.fp-clear{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);cursor:pointer;letter-spacing:0.5px;transition:color 0.15s;font-weight:normal;}
.fp-clear:hover{color:var(--accent);}

.filter-group{margin-bottom:22px;}
.fg-title{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);}

/* Display type pills */
.type-pills{display:flex;flex-direction:column;gap:5px;}
.type-pill{display:flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--border);border-radius:6px;cursor:pointer;transition:all 0.15s;font-size:0.8rem;}
.type-pill:hover{border-color:var(--border2);background:var(--surface);}
.type-pill.active{border-color:var(--accent);background:var(--accent-dim);}
.type-pill.active-raw{border-color:var(--nm);background:var(--nm-bg);}
.type-pill.active-slab{border-color:var(--psa10);background:rgba(212,245,60,0.06);}
.type-pill.active-sealed{border-color:var(--sealed);background:var(--sealed-bg);}
.tp-icon{font-size:1rem;flex-shrink:0;}
.tp-label{font-size:0.8rem;font-weight:500;}
.tp-count{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);margin-left:auto;}

/* Condition checkboxes */
.cond-options{display:flex;flex-direction:column;gap:6px;}
.cond-opt{display:flex;align-items:center;gap:8px;cursor:pointer;padding:4px 0;}
.cond-opt input{accent-color:var(--accent);width:14px;height:14px;cursor:pointer;}
.co-label{font-size:0.8rem;display:flex;align-items:center;gap:6px;}
.co-badge{font-family:var(--font-mono);font-size:0.6rem;font-weight:700;padding:1px 6px;border-radius:3px;letter-spacing:0.5px;}
.co-nm{background:var(--nm-bg);border:1px solid rgba(46,213,115,0.2);color:var(--nm);}
.co-lp{background:var(--lp-bg);border:1px solid rgba(255,165,2,0.2);color:var(--lp);}
.co-mp{background:var(--mp-bg);border:1px solid rgba(255,71,87,0.2);color:var(--mp);}
.co-p10{background:rgba(212,245,60,0.08);border:1px solid rgba(212,245,60,0.2);color:var(--psa10);}
.co-p9{background:rgba(56,189,248,0.08);border:1px solid rgba(56,189,248,0.2);color:var(--psa9);}
.co-p8{background:rgba(167,139,250,0.08);border:1px solid rgba(167,139,250,0.2);color:var(--psa8);}
.co-count{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);margin-left:auto;}

/* Price range */
.price-range{display:flex;gap:8px;align-items:center;}
.pr-input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:5px;padding:7px 10px;color:var(--text);font-family:var(--font-mono);font-size:0.75rem;outline:none;transition:border-color 0.15s;width:0;}
.pr-input:focus{border-color:var(--accent);}
.pr-sep{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);}
.price-apply{width:100%;margin-top:8px;padding:7px;border:1px solid var(--border2);border-radius:5px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.68rem;font-weight:600;cursor:pointer;transition:all 0.15s;letter-spacing:0.5px;text-transform:uppercase;}
.price-apply:hover{border-color:var(--accent);color:var(--accent);}

/* Set search */
.set-search{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:5px;padding:7px 10px;color:var(--text);font-family:var(--font-mono);font-size:0.72rem;outline:none;transition:border-color 0.15s;margin-bottom:8px;}
.set-search:focus{border-color:var(--accent);}
.set-search::placeholder{color:var(--text3);}
.set-list{display:flex;flex-direction:column;gap:3px;max-height:180px;overflow-y:auto;}
.set-item{display:flex;align-items:center;gap:7px;padding:5px 4px;cursor:pointer;border-radius:4px;transition:background 0.12s;}
.set-item:hover{background:var(--surface);}
.set-item input{accent-color:var(--accent);width:13px;height:13px;cursor:pointer;flex-shrink:0;}
.set-name{font-family:var(--font-mono);font-size:0.68rem;color:var(--text2);}
.set-count{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-left:auto;}

/* Active filters */
.active-filters{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:14px;padding:0 40px;}
.af-tag{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;background:var(--surface);border:1px solid var(--border2);border-radius:20px;font-family:var(--font-mono);font-size:0.62rem;color:var(--text2);letter-spacing:0.3px;}
.af-remove{cursor:pointer;color:var(--text3);transition:color 0.12s;font-size:0.7rem;}
.af-remove:hover{color:var(--mp);}

/* RESULTS GRID */
.results-area{padding:24px 40px;}
.results-tabs{display:flex;gap:0;border:1px solid var(--border);border-radius:6px;overflow:hidden;width:fit-content;margin-bottom:20px;}
.rt-tab{padding:7px 20px;font-family:var(--font-mono);font-size:0.7rem;font-weight:500;letter-spacing:1px;text-transform:uppercase;color:var(--text3);cursor:pointer;border:none;background:none;border-right:1px solid var(--border);transition:all 0.15s;}
.rt-tab:last-child{border-right:none;}
.rt-tab:hover{background:var(--surface);color:var(--text2);}
.rt-tab.active{background:var(--accent);color:#08080d;font-weight:700;}
.rt-tab .tab-count{opacity:0.7;font-size:0.6rem;margin-left:5px;}

/* Product results */
.product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:10px;margin-bottom:28px;}
.result-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;transition:all 0.2s;position:relative;}
.result-card:hover{transform:translateY(-3px);border-color:var(--border2);box-shadow:0 12px 24px rgba(0,0,0,0.4);}
.rc-img{width:100%;height:125px;background:linear-gradient(135deg,#13132a,#1a1a35);display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;}
.rc-img img{width:100%;height:100%;object-fit:contain;padding:4px;}
.rc-type-badge{position:absolute;bottom:6px;left:6px;font-family:var(--font-mono);font-size:0.58rem;font-weight:700;padding:2px 6px;border-radius:3px;letter-spacing:0.5px;}
.rcb-raw{background:var(--nm-bg);border:1px solid rgba(46,213,115,0.3);color:var(--nm);}
.rcb-slab{background:rgba(212,245,60,0.1);border:1px solid rgba(212,245,60,0.3);color:var(--psa10);}
.rcb-sealed{background:var(--sealed-bg);border:1px solid rgba(245,158,11,0.3);color:var(--sealed);}
.rc-verified{position:absolute;top:6px;right:6px;width:18px;height:18px;border-radius:50%;background:var(--nm);display:flex;align-items:center;justify-content:center;font-size:0.5rem;color:#08080d;font-weight:700;}
.rc-body{padding:10px 11px;}
.rc-name{font-family:var(--font-display);font-size:0.9rem;letter-spacing:0.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:1px;}
.rc-set{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rc-seller{font-family:var(--font-mono);font-size:0.6rem;color:var(--text2);margin-bottom:6px;}
.rc-footer{display:flex;justify-content:space-between;align-items:center;}
.rc-price{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;color:var(--accent);}
.rc-stars{font-size:0.65rem;color:var(--accent);}

/* Seller results */
.sellers-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px;}
.seller-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:14px;}
.seller-card:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,0.3);}
.sc-av{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-size:1.3rem;color:#08080d;flex-shrink:0;}
.sc-info{flex:1;min-width:0;}
.sc-name{font-family:var(--font-display);font-size:1rem;letter-spacing:1px;margin-bottom:3px;display:flex;align-items:center;gap:7px;}
.sc-verified-badge{font-family:var(--font-mono);font-size:0.55rem;color:var(--nm);background:var(--nm-bg);border:1px solid rgba(46,213,115,0.2);border-radius:3px;padding:1px 5px;}
.sc-meta{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);margin-bottom:5px;letter-spacing:0.3px;}
.sc-stats{display:flex;gap:10px;}
.sc-stat{font-family:var(--font-mono);font-size:0.62rem;color:var(--text2);}
.sc-stat span{color:var(--accent);}
.sc-rating{font-family:var(--font-display);font-size:1.2rem;letter-spacing:0.5px;color:var(--accent);flex-shrink:0;}

/* Empty / no results */
.no-results{padding:60px 20px;text-align:center;}
.nr-icon{font-size:3rem;margin-bottom:16px;opacity:0.4;}
.nr-title{font-family:var(--font-display);font-size:1.6rem;letter-spacing:2px;margin-bottom:8px;color:var(--text2);}
.nr-sub{font-family:var(--font-mono);font-size:0.7rem;color:var(--text3);letter-spacing:0.5px;}

@media(max-width:900px){
  nav{padding:0 16px;gap:10px;}
  .nav-right{display:none;}
  .results-bar{padding:12px 18px;}
  .active-filters{padding:0 18px;}
  .page-layout{grid-template-columns:1fr;}
  .filters-panel{display:none;}
  .results-area{padding:16px 18px;}
  .product-grid{grid-template-columns:repeat(auto-fill,minmax(145px,1fr));}
}
</style>
</head>
<body>

<nav>
  <div class="logo" onclick="window.location.href='pple-tcg.html'">PPLE<span class="dot">.</span>TCG</div>
  <div class="search-wrap">
    <select class="search-type-select" id="searchType" onchange="handleTypeChange()">
      <option value="product">Producto</option>
      <option value="seller">Vendedores</option>
    </select>
    <input class="search-input" type="text" id="searchInput" placeholder="Buscar carta, set, producto sellado..." value="Charizard" onkeydown="handleSearchKey(event)">
    <button class="search-btn" onclick="doSearch()">‚åï</button>
  </div>
  <div class="nav-right">
    <button class="btn-outline" onclick="window.location.href='pple-tcg-auth.html'">Entrar</button>
    <button class="btn-accent">Registrarse</button>
  </div>
</nav>

<!-- RESULTS BAR -->
<div class="results-bar">
  <div class="rb-left">
    <div class="rb-query">RESULTADOS PARA <span class="q" id="queryDisplay">"Charizard"</span></div>
    <div class="rb-count" id="resultsCount">‚Äî resultados</div>
  </div>
  <div class="rb-right">
    <span class="sort-label">Ordenar</span>
    <select class="sort-select" id="sortSelect" onchange="applyFilters()">
      <option value="price_asc">Precio: menor a mayor</option>
      <option value="price_desc">Precio: mayor a menor</option>
      <option value="relevance" selected>Relevancia</option>
      <option value="rating">Valoraci√≥n vendedor</option>
      <option value="recent">M√°s reciente</option>
    </select>
  </div>
</div>

<!-- ACTIVE FILTERS -->
<div class="active-filters" id="activeFilters"></div>

<div class="page-layout">

  <!-- FILTERS -->
  <div class="filters-panel">
    <div class="fp-title">FILTROS <span class="fp-clear" onclick="clearAllFilters()">Limpiar todo</span></div>

    <!-- Type -->
    <div class="filter-group">
      <div class="fg-title">Tipo de producto</div>
      <div class="type-pills">
        <div class="type-pill active" id="typeAll" onclick="setType('all',this)">
          <span class="tp-icon">üîç</span><span class="tp-label">Todo</span><span class="tp-count" id="countAll">‚Äî</span>
        </div>
        <div class="type-pill" id="typeRaw" onclick="setType('raw',this)">
          <span class="tp-icon">üÉè</span><span class="tp-label">RAW</span><span class="tp-count" id="countRaw">‚Äî</span>
        </div>
        <div class="type-pill" id="typeSlab" onclick="setType('slab',this)">
          <span class="tp-icon">üèÜ</span><span class="tp-label">Slab PSA</span><span class="tp-count" id="countSlab">‚Äî</span>
        </div>
        <div class="type-pill" id="typeSealed" onclick="setType('sealed',this)">
          <span class="tp-icon">üì¶</span><span class="tp-label">Sellado</span><span class="tp-count" id="countSealed">‚Äî</span>
        </div>
      </div>
    </div>

    <!-- Condition (shown for RAW/all) -->
    <div class="filter-group" id="condGroup">
      <div class="fg-title">Estado / Condici√≥n</div>
      <div class="cond-options">
        <label class="cond-opt"><input type="checkbox" value="NM" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-nm">NM</span> Near Mint</span><span class="co-count">‚Äî</span></label>
        <label class="cond-opt"><input type="checkbox" value="LP" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-lp">LP</span> Lightly Played</span><span class="co-count">‚Äî</span></label>
        <label class="cond-opt"><input type="checkbox" value="MP" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-mp">MP</span> Moderately Played</span><span class="co-count">‚Äî</span></label>
      </div>
    </div>

    <!-- PSA grades (shown for slab) -->
    <div class="filter-group" id="gradeGroup" style="display:none">
      <div class="fg-title">Grado PSA</div>
      <div class="cond-options">
        <label class="cond-opt"><input type="checkbox" value="PSA10" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-p10">PSA 10</span></span><span class="co-count">‚Äî</span></label>
        <label class="cond-opt"><input type="checkbox" value="PSA9" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-p9">PSA 9</span></span><span class="co-count">‚Äî</span></label>
        <label class="cond-opt"><input type="checkbox" value="PSA8" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-p8">PSA 8</span></span><span class="co-count">‚Äî</span></label>
      </div>
    </div>

    <!-- Price range -->
    <div class="filter-group">
      <div class="fg-title">Precio (‚Ç¨)</div>
      <div class="price-range">
        <input class="pr-input" type="number" id="priceMin" placeholder="M√≠n" min="0">
        <span class="pr-sep">‚Äî</span>
        <input class="pr-input" type="number" id="priceMax" placeholder="M√°x" min="0">
      </div>
      <button class="price-apply" onclick="applyFilters()">Aplicar rango</button>
    </div>

    <!-- Set -->
    <div class="filter-group">
      <div class="fg-title">Colecci√≥n / Set</div>
      <input class="set-search" type="text" placeholder="Buscar set..." oninput="filterSets(this.value)">
      <div class="set-list" id="setList"></div>
    </div>
  </div>

  <!-- RESULTS -->
  <div class="results-area">
    <div class="results-tabs" id="resultsTabs">
      <button class="rt-tab active" onclick="switchTab('product',this)">Producto<span class="tab-count" id="tabCountProduct"></span></button>
      <button class="rt-tab" onclick="switchTab('seller',this)">Vendedores<span class="tab-count" id="tabCountSeller"></span></button>
    </div>

    <div id="productResults"></div>
    <div id="sellerResults" style="display:none"></div>
  </div>
</div>

<script>
// ---- MOCK DATA ----
const PRODUCTS = [
  { id:1, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'raw',    cond:'NM',    price:124.50, seller:'TrainerRed99',  sellerRating:4.9, verified:true  },
  { id:2, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'raw',    cond:'LP',    price:89.00,  seller:'CardShopMdrid', sellerRating:4.7, verified:false },
  { id:3, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'slab',   cond:'PSA10', price:520.00, seller:'Pok√©Collector',  sellerRating:5.0, verified:true  },
  { id:4, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'slab',   cond:'PSA9',  price:280.00, seller:'PokeMarket_EU', sellerRating:4.8, verified:true  },
  { id:5, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'slab',   cond:'PSA8',  price:165.00, seller:'tcg_madrid',    sellerRating:4.6, verified:false },
  { id:6, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'raw',    cond:'NM',    price:118.00, seller:'HoloHunter',    sellerRating:4.9, verified:true  },
  { id:7, name:'Booster Box Obsidian Flames',set:'Obsidian Flames',img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',  type:'sealed', cond:'SEALED',price:185.00, seller:'CardShopMdrid', sellerRating:4.7, verified:false },
  { id:8, name:'Charizard ex',         set:'Paldean Fates',      img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'raw',    cond:'NM',    price:42.00,  seller:'Pok√©Fan_ES',     sellerRating:4.5, verified:false },
  { id:9, name:'Charizard ex',         set:'Paldean Fates',      img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'slab',   cond:'PSA10', price:190.00, seller:'TrainerRed99',  sellerRating:4.9, verified:true  },
  { id:10,name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'raw',    cond:'MP',    price:67.00,  seller:'GottaCatchEm',  sellerRating:4.3, verified:false },
];

const SELLERS = [
  { name:'TrainerRed99',  color:'linear-gradient(135deg,#1a1a2e,#e94560)', rating:4.9, sales:247, listings:18, location:'Madrid',    verified:true  },
  { name:'CardShopMadrid',color:'linear-gradient(135deg,#0f3460,#533483)', rating:4.7, sales:512, listings:34, location:'Madrid',    verified:true  },
  { name:'Pok√©Collector',  color:'linear-gradient(135deg,#2d6a4f,#d4f53c)', rating:5.0, sales:89,  listings:12, location:'Barcelona', verified:true  },
  { name:'HoloHunter',    color:'linear-gradient(135deg,#3d1a6e,#d4f53c)', rating:4.9, sales:156, listings:9,  location:'Valencia',  verified:false },
  { name:'Pok√©Fan_ES',     color:'linear-gradient(135deg,#6e1a1a,#f53c3c)', rating:4.5, sales:44,  listings:6,  location:'Sevilla',   verified:false },
];

const SETS = ['Obsidian Flames','Paldea Evolved','151','Temporal Forces','Twilight Masquerade','Paradox Rift','Paldean Fates','Scarlet & Violet Base'];

let currentType = 'all';
let currentTab  = 'product';
let activeSetFilters = [];

// ---- INIT ----
function init() {
  renderSetList();
  applyFilters();
  updateCounts();
}

function handleTypeChange() {
  const t = document.getElementById('searchType').value;
  const input = document.getElementById('searchInput');
  input.placeholder = t === 'seller' ? 'Buscar vendedor...' : 'Buscar carta, set, producto sellado...';
  if (t === 'seller') {
    switchTab('seller', document.querySelectorAll('.rt-tab')[1]);
  } else {
    switchTab('product', document.querySelectorAll('.rt-tab')[0]);
  }
}

function handleSearchKey(e) {
  if (e.key === 'Enter') doSearch();
}

function doSearch() {
  const q = document.getElementById('searchInput').value.trim() || 'Charizard';
  document.getElementById('queryDisplay').textContent = `"${q}"`;
  applyFilters();
}

// ---- TYPE FILTER ----
function setType(type, el) {
  currentType = type;
  document.querySelectorAll('.type-pill').forEach(p => {
    p.className = 'type-pill';
  });
  const cls = type === 'all' ? 'active' : type === 'raw' ? 'active-raw' : type === 'slab' ? 'active-slab' : 'active-sealed';
  el.classList.add(cls);
  document.getElementById('condGroup').style.display  = (type === 'all' || type === 'raw') ? 'block' : 'none';
  document.getElementById('gradeGroup').style.display = (type === 'slab') ? 'block' : 'none';
  applyFilters();
}

// ---- APPLY FILTERS ----
function applyFilters() {
  const q        = document.getElementById('searchInput').value.toLowerCase();
  const sort     = document.getElementById('sortSelect').value;
  const priceMin = parseFloat(document.getElementById('priceMin').value) || 0;
  const priceMax = parseFloat(document.getElementById('priceMax').value) || Infinity;
  const checkedConds = [...document.querySelectorAll('#condGroup input:checked')].map(i=>i.value);
  const checkedGrades= [...document.querySelectorAll('#gradeGroup input:checked')].map(i=>i.value);

  let filtered = PRODUCTS.filter(p => {
    if (q && !p.name.toLowerCase().includes(q) && !p.set.toLowerCase().includes(q) && !p.seller.toLowerCase().includes(q)) return false;
    if (currentType !== 'all' && p.type !== currentType) return false;
    if (p.price < priceMin || p.price > priceMax) return false;
    if (checkedConds.length && p.type === 'raw' && !checkedConds.includes(p.cond)) return false;
    if (checkedGrades.length && p.type === 'slab' && !checkedGrades.includes(p.cond)) return false;
    if (activeSetFilters.length && !activeSetFilters.includes(p.set)) return false;
    return true;
  });

  // Sort
  if (sort === 'price_asc')  filtered.sort((a,b) => a.price - b.price);
  if (sort === 'price_desc') filtered.sort((a,b) => b.price - a.price);
  if (sort === 'rating')     filtered.sort((a,b) => b.sellerRating - a.sellerRating);

  // Sellers filter
  const sq = document.getElementById('searchInput').value.toLowerCase();
  const filteredSellers = SELLERS.filter(s =>
    !sq || s.name.toLowerCase().includes(sq) || s.location.toLowerCase().includes(sq)
  );

  renderProducts(filtered);
  renderSellers(filteredSellers);
  updateCounts(filtered, filteredSellers);
  renderActiveFilters(checkedConds, checkedGrades, priceMin, priceMax);
}

// ---- RENDER PRODUCTS ----
function renderProducts(items) {
  if (!items.length) {
    document.getElementById('productResults').innerHTML = `
      <div class="no-results">
        <div class="nr-icon">üîç</div>
        <div class="nr-title">SIN RESULTADOS</div>
        <div class="nr-sub">Prueba con otros filtros o un t√©rmino de b√∫squeda diferente</div>
      </div>`;
    return;
  }
  document.getElementById('productResults').innerHTML = `<div class="product-grid">` +
    items.map(p => {
      const isPsa = p.type === 'slab';
      const isSealed = p.type === 'sealed';
      const badgeClass = isPsa ? 'rcb-slab' : isSealed ? 'rcb-sealed' : 'rcb-raw';
      const badgeText  = isPsa ? p.cond.replace('PSA','PSA ') : isSealed ? 'SELLADO' : p.cond;
      const stars = '‚òÖ'.repeat(Math.round(p.sellerRating)) + '‚òÜ'.repeat(5-Math.round(p.sellerRating));
      return `
      <div class="result-card" onclick="window.location.href='pple-tcg-perfil.html'">
        <div class="rc-img">
          <img src="${p.img}" alt="${p.name}" onerror="this.parentNode.innerHTML='üé¥'">
          <div class="rc-type-badge ${badgeClass}">${badgeText}</div>
          ${p.verified ? '<div class="rc-verified">‚úì</div>' : ''}
        </div>
        <div class="rc-body">
          <div class="rc-name">${p.name}</div>
          <div class="rc-set">${p.set}</div>
          <div class="rc-seller">@${p.seller}</div>
          <div class="rc-footer">
            <div class="rc-price">‚Ç¨${p.price.toFixed(2)}</div>
            <div class="rc-stars">${stars}</div>
          </div>
        </div>
      </div>`;
    }).join('') + `</div>`;
}

// ---- RENDER SELLERS ----
function renderSellers(items) {
  if (!items.length) {
    document.getElementById('sellerResults').innerHTML = `
      <div class="no-results">
        <div class="nr-icon">üë§</div>
        <div class="nr-title">SIN VENDEDORES</div>
        <div class="nr-sub">No se encontraron vendedores con ese nombre</div>
      </div>`;
    return;
  }
  document.getElementById('sellerResults').innerHTML = `<div class="sellers-grid">` +
    items.map(s => `
    <div class="seller-card" onclick="window.location.href='pple-tcg-perfil.html'">
      <div class="sc-av" style="background:${s.color}">${s.name[0]}</div>
      <div class="sc-info">
        <div class="sc-name">
          ${s.name}
          ${s.verified ? '<span class="sc-verified-badge">‚úì Verificado</span>' : ''}
        </div>
        <div class="sc-meta">üìç ${s.location} ¬∑ Miembro desde 2023</div>
        <div class="sc-stats">
          <span class="sc-stat"><span>${s.sales}</span> ventas</span>
          <span class="sc-stat"><span>${s.listings}</span> en venta</span>
        </div>
      </div>
      <div class="sc-rating">${s.rating}</div>
    </div>`).join('') + `</div>`;
}

// ---- COUNTS ----
function updateCounts(filtered, filteredSellers) {
  const all    = filtered?.length ?? PRODUCTS.length;
  const raw    = (filtered ?? PRODUCTS).filter(p=>p.type==='raw').length;
  const slab   = (filtered ?? PRODUCTS).filter(p=>p.type==='slab').length;
  const sealed = (filtered ?? PRODUCTS).filter(p=>p.type==='sealed').length;
  const sellers= filteredSellers?.length ?? SELLERS.length;

  document.getElementById('countAll').textContent    = all;
  document.getElementById('countRaw').textContent    = raw;
  document.getElementById('countSlab').textContent   = slab;
  document.getElementById('countSealed').textContent = sealed;
  document.getElementById('resultsCount').textContent= `${all} productos ¬∑ ${sellers} vendedores`;
  document.getElementById('tabCountProduct').textContent = ` (${all})`;
  document.getElementById('tabCountSeller').textContent  = ` (${sellers})`;
}

// ---- ACTIVE FILTER TAGS ----
function renderActiveFilters(conds, grades, min, max) {
  const tags = [];
  if (currentType !== 'all') tags.push({ label: currentType.toUpperCase(), key:'type' });
  conds.forEach(c  => tags.push({ label:c, key:`cond_${c}` }));
  grades.forEach(g => tags.push({ label:g.replace('PSA','PSA '), key:`grade_${g}` }));
  if (min > 0)           tags.push({ label:`Desde ‚Ç¨${min}`, key:'priceMin' });
  if (max < Infinity)    tags.push({ label:`Hasta ‚Ç¨${max}`, key:'priceMax' });
  activeSetFilters.forEach(s => tags.push({ label:s, key:`set_${s}` }));

  document.getElementById('activeFilters').innerHTML = tags.map(t =>
    `<div class="af-tag">${t.label}<span class="af-remove" onclick="removeFilter('${t.key}')">‚úï</span></div>`
  ).join('');
}

function removeFilter(key) {
  if (key === 'type') { setType('all', document.getElementById('typeAll')); return; }
  if (key.startsWith('cond_')) {
    const v = key.replace('cond_','');
    document.querySelector(`#condGroup input[value="${v}"]`).checked = false;
  }
  if (key.startsWith('grade_')) {
    const v = key.replace('grade_','');
    document.querySelector(`#gradeGroup input[value="${v}"]`).checked = false;
  }
  if (key === 'priceMin') document.getElementById('priceMin').value = '';
  if (key === 'priceMax') document.getElementById('priceMax').value = '';
  if (key.startsWith('set_')) {
    activeSetFilters = activeSetFilters.filter(s => s !== key.replace('set_',''));
    renderSetList();
  }
  applyFilters();
}

function clearAllFilters() {
  setType('all', document.getElementById('typeAll'));
  document.querySelectorAll('#condGroup input, #gradeGroup input').forEach(i => i.checked = false);
  document.getElementById('priceMin').value = '';
  document.getElementById('priceMax').value = '';
  activeSetFilters = [];
  renderSetList();
  applyFilters();
}

// ---- SET LIST ----
function renderSetList(filter='') {
  document.getElementById('setList').innerHTML = SETS
    .filter(s => !filter || s.toLowerCase().includes(filter.toLowerCase()))
    .map(s => `
      <div class="set-item">
        <input type="checkbox" value="${s}" ${activeSetFilters.includes(s)?'checked':''} onchange="toggleSet('${s}',this)">
        <span class="set-name">${s}</span>
        <span class="set-count">${PRODUCTS.filter(p=>p.set===s).length}</span>
      </div>`).join('');
}

function filterSets(q) { renderSetList(q); }

function toggleSet(set, input) {
  if (input.checked) activeSetFilters.push(set);
  else activeSetFilters = activeSetFilters.filter(s => s !== set);
  applyFilters();
}

// ---- TABS ----
function switchTab(tab, btn) {
  currentTab = tab;
  document.querySelectorAll('.rt-tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('productResults').style.display = tab === 'product' ? 'block' : 'none';
  document.getElementById('sellerResults').style.display  = tab === 'seller'  ? 'block' : 'none';
  document.getElementById('condGroup').closest('.filters-panel').style.display = tab === 'seller' ? 'none' : '';
}

init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg ¬∑ Mensajes</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#08080d; --bg2:#0e0e16; --surface:#11111c; --surface2:#181825;
  --border:#22223a; --border2:#2d2d4a;
  --accent:#d4f53c; --accent-glow:rgba(212,245,60,0.15); --accent-dim:rgba(212,245,60,0.06);
  --text:#eeeef8; --text2:#9898b8; --text3:#55556a;
  --nm:#2ed573; --mp:#ff4757; --lp:#ffa502;
  --nm-bg:rgba(46,213,115,0.08); --mp-bg:rgba(255,71,87,0.08); --lp-bg:rgba(255,165,2,0.08);
  --font-display:'Bebas Neue',sans-serif;
  --font-mono:'DM Mono',monospace;
  --font-body:'Plus Jakarta Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column;overflow:hidden;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay;}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* NAV */
nav{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:60px;border-bottom:1px solid var(--border);background:rgba(8,8,13,0.97);backdrop-filter:blur(24px);flex-shrink:0;z-index:10;}
.logo{font-family:var(--font-display);font-size:1.8rem;letter-spacing:3px;cursor:pointer;}
.logo .dot{color:var(--accent);}
.nav-pills{display:flex;gap:0;border:1px solid var(--border);border-radius:6px;overflow:hidden;}
.nav-tab{padding:7px 22px;font-family:var(--font-mono);font-size:0.72rem;font-weight:500;letter-spacing:1px;text-transform:uppercase;color:var(--text2);cursor:pointer;border:none;background:none;border-right:1px solid var(--border);transition:all 0.15s;}
.nav-tab:last-child{border-right:none;}
.nav-tab:hover{background:var(--surface);color:var(--text);}
.nav-tab.active{background:var(--accent);color:#08080d;font-weight:700;}
.nav-right{display:flex;gap:10px;align-items:center;}
.nav-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#3d2a6e,#d4f53c);display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;color:#08080d;cursor:pointer;}
.notif-btn{position:relative;background:none;border:1px solid var(--border);border-radius:5px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text3);font-size:0.85rem;transition:all 0.15s;}
.notif-btn:hover{border-color:var(--border2);color:var(--text2);}
.notif-dot{position:absolute;top:5px;right:5px;width:7px;height:7px;border-radius:50%;background:var(--accent);border:1.5px solid var(--bg);}

/* LAYOUT */
.msgs-layout{display:grid;grid-template-columns:320px 1fr;flex:1;min-height:0;overflow:hidden;}

/* ===== CONVERSATIONS LIST ===== */
.conv-panel{border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;}

.conv-header{padding:16px 20px;border-bottom:1px solid var(--border);flex-shrink:0;}
.conv-title{font-family:var(--font-display);font-size:1.4rem;letter-spacing:2px;margin-bottom:10px;}
.conv-search{position:relative;}
.conv-search input{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:8px 12px 8px 32px;color:var(--text);font-family:var(--font-mono);font-size:0.72rem;outline:none;letter-spacing:0.3px;transition:border-color 0.15s;}
.conv-search input:focus{border-color:var(--accent);}
.conv-search input::placeholder{color:var(--text3);}
.conv-search-icon{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--text3);font-size:0.72rem;pointer-events:none;}

.conv-filter{display:flex;gap:0;border-bottom:1px solid var(--border);flex-shrink:0;}
.cf-tab{flex:1;padding:8px;text-align:center;font-family:var(--font-mono);font-size:0.65rem;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:var(--text3);cursor:pointer;border:none;background:none;border-bottom:2px solid transparent;transition:all 0.15s;}
.cf-tab:hover{color:var(--text2);}
.cf-tab.active{color:var(--accent);border-bottom-color:var(--accent);}

.conv-list{flex:1;overflow-y:auto;}

.conv-item{display:flex;align-items:center;gap:12px;padding:14px 20px;cursor:pointer;transition:all 0.15s;border-bottom:1px solid var(--border);position:relative;}
.conv-item:hover{background:var(--surface);}
.conv-item.active{background:var(--surface);border-right:2px solid var(--accent);}
.conv-item.unread .ci-name{color:var(--text);font-weight:700;}
.conv-item.unread .ci-last{color:var(--text2);}
.conv-item.unread::after{content:'';position:absolute;top:50%;left:6px;transform:translateY(-50%);width:5px;height:5px;border-radius:50%;background:var(--accent);}

.ci-av{width:40px;height:40px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.82rem;font-weight:700;color:#08080d;}
.ci-av-img{width:40px;height:40px;border-radius:50%;object-fit:cover;flex-shrink:0;}

.ci-info{flex:1;min-width:0;}
.ci-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:3px;}
.ci-name{font-size:0.85rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.ci-time{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);flex-shrink:0;}
.ci-last{font-size:0.78rem;color:var(--text3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:300;}

.ci-card-thumb{width:28px;height:38px;object-fit:contain;border-radius:3px;flex-shrink:0;background:var(--surface2);border:1px solid var(--border);}

/* ===== CHAT AREA ===== */
.chat-panel{display:flex;flex-direction:column;overflow:hidden;}

/* Empty state */
.chat-empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text3);}
.ce-icon{font-size:3rem;margin-bottom:14px;opacity:0.5;}
.ce-title{font-family:var(--font-display);font-size:1.4rem;letter-spacing:2px;margin-bottom:6px;color:var(--text2);}
.ce-sub{font-family:var(--font-mono);font-size:0.7rem;letter-spacing:1px;}

/* Chat header */
.chat-header{display:flex;align-items:center;gap:12px;padding:14px 24px;border-bottom:1px solid var(--border);flex-shrink:0;background:var(--bg2);}
.ch-av{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.8rem;font-weight:700;color:#08080d;flex-shrink:0;}
.ch-info{flex:1;}
.ch-name{font-size:0.88rem;font-weight:700;}
.ch-status{font-family:var(--font-mono);font-size:0.62rem;color:var(--nm);letter-spacing:0.5px;display:flex;align-items:center;gap:5px;}
.ch-status::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--nm);animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
.ch-status.offline::before{background:var(--text3);animation:none;}
.ch-status.offline{color:var(--text3);}

/* Card context bar */
.card-context{display:flex;align-items:center;gap:12px;padding:10px 24px;border-bottom:1px solid var(--border);background:var(--surface);flex-shrink:0;}
.cc-img{width:32px;height:44px;object-fit:contain;border-radius:4px;background:var(--surface2);}
.cc-info{flex:1;}
.cc-name{font-size:0.82rem;font-weight:600;}
.cc-price{font-family:var(--font-display);font-size:0.95rem;letter-spacing:0.5px;color:var(--accent);}
.cc-badge{font-family:var(--font-mono);font-size:0.6rem;padding:2px 7px;border-radius:3px;}
.cc-nm{background:var(--nm-bg);border:1px solid rgba(46,213,115,0.2);color:var(--nm);}
.cc-lp{background:var(--lp-bg);border:1px solid rgba(255,165,2,0.2);color:var(--lp);}
.cc-psa{background:rgba(212,245,60,0.07);border:1px solid rgba(212,245,60,0.2);color:#d4f53c;}
.ch-actions{display:flex;gap:8px;}
.ch-btn{padding:6px 14px;border-radius:5px;font-family:var(--font-mono);font-size:0.68rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.ch-btn-buy{border:none;background:var(--accent);color:#08080d;}
.ch-btn-buy:hover{box-shadow:0 0 14px var(--accent-glow);}
.ch-btn-offer{border:1px solid var(--border2);background:none;color:var(--text2);}
.ch-btn-offer:hover{border-color:var(--accent);color:var(--accent);}

/* Messages */
.messages{flex:1;overflow-y:auto;padding:20px 24px;display:flex;flex-direction:column;gap:14px;}

.msg-day-divider{text-align:center;font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;position:relative;margin:4px 0;}
.msg-day-divider::before,.msg-day-divider::after{content:'';position:absolute;top:50%;width:calc(50% - 60px);height:1px;background:var(--border);}
.msg-day-divider::before{left:0;}
.msg-day-divider::after{right:0;}

.msg{display:flex;gap:10px;max-width:70%;animation:msgIn 0.2s ease;}
@keyframes msgIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.msg.mine{align-self:flex-end;flex-direction:row-reverse;}
.msg.theirs{align-self:flex-start;}

.msg-av{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.65rem;font-weight:700;color:#08080d;flex-shrink:0;align-self:flex-end;}

.msg-bubble{padding:10px 14px;border-radius:14px;font-size:0.85rem;line-height:1.5;font-weight:300;position:relative;}
.msg.theirs .msg-bubble{background:var(--surface2);border:1px solid var(--border);border-bottom-left-radius:4px;color:var(--text);}
.msg.mine .msg-bubble{background:var(--accent);color:#08080d;border-bottom-right-radius:4px;font-weight:400;}
.msg-time{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-top:4px;text-align:right;}
.msg.mine .msg-time{color:rgba(8,8,13,0.5);}

/* Special message types */
.msg-offer{background:var(--surface);border:1px solid var(--border2);border-radius:10px;padding:14px;width:280px;}
.msg-offer-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;}
.msg-offer-amount{font-family:var(--font-display);font-size:1.8rem;letter-spacing:1px;color:var(--accent);margin-bottom:10px;}
.msg-offer-card{font-size:0.78rem;color:var(--text2);margin-bottom:12px;}
.msg-offer-actions{display:flex;gap:8px;}
.btn-accept{flex:1;padding:8px;border:none;border-radius:5px;background:var(--nm);color:#08080d;font-family:var(--font-mono);font-size:0.68rem;font-weight:700;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-accept:hover{box-shadow:0 0 12px rgba(46,213,115,0.3);}
.btn-decline{flex:1;padding:8px;border:1px solid var(--border2);border-radius:5px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.68rem;font-weight:600;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-decline:hover{border-color:var(--mp);color:var(--mp);}
.offer-accepted{font-family:var(--font-mono);font-size:0.68rem;color:var(--nm);margin-top:8px;display:none;}
.offer-accepted.show{display:block;}

.msg-system{align-self:center;font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:5px 14px;letter-spacing:0.5px;}

/* Typing indicator */
.typing-indicator{display:none;align-self:flex-start;padding:10px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:14px;border-bottom-left-radius:4px;}
.typing-indicator.show{display:flex;gap:4px;align-items:center;}
.typing-dot{width:6px;height:6px;border-radius:50%;background:var(--text3);animation:tdot 1.2s infinite;}
.typing-dot:nth-child(2){animation-delay:0.2s;}
.typing-dot:nth-child(3){animation-delay:0.4s;}
@keyframes tdot{0%,60%,100%{transform:translateY(0);opacity:0.4}30%{transform:translateY(-5px);opacity:1}}

/* Input bar */
.chat-input-bar{padding:14px 24px;border-top:1px solid var(--border);background:var(--bg2);flex-shrink:0;}

.quick-actions{display:flex;gap:6px;margin-bottom:10px;flex-wrap:wrap;}
.qa-btn{padding:4px 12px;border:1px solid var(--border2);border-radius:20px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.62rem;cursor:pointer;transition:all 0.15s;letter-spacing:0.3px;white-space:nowrap;}
.qa-btn:hover{border-color:var(--accent);color:var(--accent);}

.input-row{display:flex;gap:8px;align-items:flex-end;}
.msg-input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:11px 14px;color:var(--text);font-family:var(--font-body);font-size:0.85rem;outline:none;resize:none;max-height:120px;min-height:44px;transition:border-color 0.15s;line-height:1.5;}
.msg-input:focus{border-color:var(--accent);}
.msg-input::placeholder{color:var(--text3);}
.send-btn{width:44px;height:44px;border-radius:10px;border:none;background:var(--accent);color:#08080d;font-size:1rem;cursor:pointer;transition:all 0.15s;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.send-btn:hover{box-shadow:0 0 16px var(--accent-glow);}
.send-btn:disabled{opacity:0.4;cursor:not-allowed;box-shadow:none;}

/* Offer modal */
.offer-modal-overlay{position:fixed;inset:0;background:rgba(4,4,8,0.85);backdrop-filter:blur(12px);z-index:200;display:none;align-items:center;justify-content:center;}
.offer-modal-overlay.open{display:flex;}
.offer-modal{background:var(--surface);border:1px solid var(--border2);border-radius:12px;padding:28px;width:100%;max-width:380px;animation:mIn 0.2s ease;}
@keyframes mIn{from{opacity:0;transform:scale(0.96)}to{opacity:1;transform:scale(1)}}
.om-title{font-family:var(--font-display);font-size:1.4rem;letter-spacing:1px;margin-bottom:4px;}
.om-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:0.5px;margin-bottom:20px;}
.om-card-row{display:flex;align-items:center;gap:12px;padding:12px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;margin-bottom:20px;}
.om-card-img{width:36px;height:50px;object-fit:contain;}
.om-card-name{font-size:0.85rem;font-weight:600;margin-bottom:2px;}
.om-card-price{font-family:var(--font-mono);font-size:0.68rem;color:var(--text3);}
.om-input-wrap{position:relative;margin-bottom:16px;}
.om-euro{position:absolute;left:14px;top:50%;transform:translateY(-50%);font-family:var(--font-display);font-size:1.4rem;color:var(--text3);}
.om-input{width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:14px 14px 14px 36px;color:var(--text);font-family:var(--font-display);font-size:2rem;letter-spacing:1px;outline:none;transition:border-color 0.15s;}
.om-input:focus{border-color:var(--accent);}
.om-hint{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);margin-bottom:16px;letter-spacing:0.3px;}
.om-hint span{color:var(--text2);}
.om-btns{display:flex;gap:8px;}
.btn-cancel{flex:1;padding:11px;border:1px solid var(--border);border-radius:6px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;cursor:pointer;text-transform:uppercase;letter-spacing:0.5px;transition:all 0.15s;}
.btn-cancel:hover{border-color:var(--border2);color:var(--text2);}
.btn-send-offer{flex:2;padding:11px;border:none;border-radius:6px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:1px;transition:all 0.15s;}
.btn-send-offer:hover{box-shadow:0 0 18px var(--accent-glow);}

@media(max-width:700px){
  nav{padding:0 18px;}
  .nav-pills{display:none;}
  .msgs-layout{grid-template-columns:1fr;}
  .conv-panel{display:none;}
  .conv-panel.mobile-open{display:flex;}
}
</style>
</head>
<body>

<nav>
  <div class="logo" onclick="window.location.href='pple-tcg.html'">PPLE<span class="dot">.</span>TCG</div>
  <div class="nav-pills">
    <button class="nav-tab" onclick="window.location.href='pple-tcg.html'">Mercado</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-vender.html'">Vender</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-auth.html'">Verificaci√≥n</button>
    <button class="nav-tab active">Mensajes</button>
  </div>
  <div class="nav-right">
    <button class="notif-btn" title="Notificaciones">üîî<div class="notif-dot"></div></button>
    <div class="nav-avatar" title="Mi perfil">T</div>
  </div>
</nav>

<div class="msgs-layout">

  <!-- CONVERSATIONS LIST -->
  <div class="conv-panel">
    <div class="conv-header">
      <div class="conv-title">MENSAJES</div>
      <div class="conv-search">
        <span class="conv-search-icon">‚åï</span>
        <input type="text" placeholder="Buscar conversaci√≥n..." oninput="filterConvs(this.value)">
      </div>
    </div>
    <div class="conv-filter">
      <button class="cf-tab active" onclick="filterTab('all',this)">Todos</button>
      <button class="cf-tab" onclick="filterTab('compras',this)">Comprando</button>
      <button class="cf-tab" onclick="filterTab('ventas',this)">Vendiendo</button>
    </div>
    <div class="conv-list" id="convList"></div>
  </div>

  <!-- CHAT PANEL -->
  <div class="chat-panel" id="chatPanel">
    <div class="chat-empty" id="chatEmpty">
      <div class="ce-icon">üí¨</div>
      <div class="ce-title">TUS MENSAJES</div>
      <div class="ce-sub">Selecciona una conversaci√≥n para empezar</div>
    </div>

    <div id="chatContent" style="display:none;flex-direction:column;flex:1;overflow:hidden;">
      <div class="chat-header">
        <div class="ch-av" id="chAv" style="background:linear-gradient(135deg,#3d2a6e,#d4f53c)">T</div>
        <div class="ch-info">
          <div class="ch-name" id="chName">‚Äî</div>
          <div class="ch-status" id="chStatus">En l√≠nea</div>
        </div>
        <div class="ch-actions">
          <button class="ch-btn ch-btn-offer" onclick="openOfferModal()">Hacer oferta</button>
          <button class="ch-btn ch-btn-buy" onclick="buyNow()">Comprar ahora</button>
        </div>
      </div>

      <div class="card-context" id="cardContext">
        <img class="cc-img" id="ccImg" src="" onerror="this.style.display='none'" alt="">
        <div class="cc-info">
          <div class="cc-name" id="ccName">‚Äî</div>
          <div class="cc-price" id="ccPrice">‚Äî</div>
        </div>
        <span class="cc-badge" id="ccBadge">NM</span>
      </div>

      <div class="messages" id="messages"></div>

      <div class="chat-input-bar">
        <div class="quick-actions" id="quickActions"></div>
        <div class="input-row">
          <textarea class="msg-input" id="msgInput" placeholder="Escribe un mensaje..." rows="1"
            oninput="autoResize(this)" onkeydown="handleKey(event)"></textarea>
          <button class="send-btn" id="sendBtn" onclick="sendMessage()" title="Enviar">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- OFFER MODAL -->
<div class="offer-modal-overlay" id="offerModal" onclick="closeOfferModal(event)">
  <div class="offer-modal">
    <div class="om-title">HACER OFERTA</div>
    <div class="om-sub">El vendedor recibir√° tu oferta y podr√° aceptarla o rechazarla</div>
    <div class="om-card-row">
      <img class="om-card-img" id="omCardImg" src="" onerror="this.style.display='none'" alt="">
      <div>
        <div class="om-card-name" id="omCardName">‚Äî</div>
        <div class="om-card-price" id="omCardPrice">Precio: ‚Äî</div>
      </div>
    </div>
    <div class="om-input-wrap">
      <span class="om-euro">‚Ç¨</span>
      <input class="om-input" type="number" id="omAmount" placeholder="0.00" step="0.01" min="0.01" oninput="updateOfferHint()">
    </div>
    <div class="om-hint" id="omHint">Introduce el precio que quieres ofrecer</div>
    <div class="om-btns">
      <button class="btn-cancel" onclick="document.getElementById('offerModal').classList.remove('open')">Cancelar</button>
      <button class="btn-send-offer" onclick="submitOffer()">Enviar oferta ‚Üí</button>
    </div>
  </div>
</div>

<script>
// ---- DATA ----
const ME = { name:'TrainerJuan', initial:'J', color:'linear-gradient(135deg,#3d2a6e,#d4f53c)' };

const CONVERSATIONS = [
  {
    id:1, user:'TrainerRed99', initial:'T', color:'linear-gradient(135deg,#1a1a2e,#e94560)',
    status:'online', type:'compra',
    card:{ name:'Charizard ex', set:'Obsidian Flames', price:'‚Ç¨124.50', cond:'NM', img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png' },
    last:'¬øPuedes hacer env√≠o ma√±ana?', time:'14:32', unread:true,
    messages:[
      { from:'them', text:'Hola! Me interesa la Charizard ex. ¬øSigue disponible?', time:'14:15' },
      { from:'me', text:'¬°S√≠! Est√° en perfecto estado NM, nunca jugada.', time:'14:18' },
      { from:'them', text:'¬øTienes m√°s fotos del dorso? Quiero ver que no tenga marcas.', time:'14:22' },
      { from:'me', text:'Claro, ahora te mando.', time:'14:23' },
      { type:'system', text:'TrainerJuan envi√≥ 2 fotos adicionales' },
      { from:'them', text:'Perfecta, la tomo. ¬øAceptas ‚Ç¨115?', time:'14:28', isOffer:true, amount:'115.00', cardName:'Charizard ex' },
      { from:'me', text:'No bajo de ‚Ç¨120, es el precio de Cardmarket esta semana.', time:'14:30' },
      { from:'them', text:'¬øPuedes hacer env√≠o ma√±ana?', time:'14:32' },
    ]
  },
  {
    id:2, user:'CardShopMadrid', initial:'C', color:'linear-gradient(135deg,#0f3460,#533483)',
    status:'offline', type:'compra',
    card:{ name:'Pikachu ex', set:'Paldea Evolved', price:'‚Ç¨84.20', cond:'NM', img:'https://assets.tcgdex.net/univ/sv/sv02/83/high.png' },
    last:'Enviado con Correos Express üì¶', time:'Ayer', unread:false,
    messages:[
      { from:'them', text:'Buenas tardes, ¬øel Pikachu ex sigue disponible?', time:'11:00' },
      { from:'me', text:'S√≠, disponible. ¬øQu√© estado buscas?', time:'11:05' },
      { from:'them', text:'NM o Near Mint, preferiblemente sin sleeve previo.', time:'11:08' },
      { from:'me', text:'Esta nunca fue sleeve. Va directamente en toploader desde el sobre.', time:'11:10' },
      { type:'system', text:'Transacci√≥n completada ¬∑ ‚Ç¨84.20' },
      { from:'them', text:'Enviado con Correos Express üì¶', time:'16:45' },
    ]
  },
  {
    id:3, user:'Pok√©Collector_ES', initial:'P', color:'linear-gradient(135deg,#2d6a4f,#d4f53c)',
    status:'online', type:'venta',
    card:{ name:'Mewtwo ex', set:'Scarlet & Violet 151', price:'‚Ç¨210.00', cond:'PSA 10', img:'https://assets.tcgdex.net/univ/sv/sv3pt5/11/high.png', isSlab:true },
    last:'La PSA 10 tiene cert #45821937', time:'11:20', unread:true,
    messages:[
      { from:'me', text:'Hola, vi tu Mewtwo ex PSA 10. ¬øTienes foto del certificado?', time:'10:55' },
      { from:'them', text:'Claro, aqu√≠ est√°. Cert PSA #45821937, gradeada en julio 2024.', time:'11:02' },
      { type:'system', text:'Pok√©Collector_ES comparti√≥ el certificado PSA' },
      { from:'me', text:'¬øAceptas ‚Ç¨195?', time:'11:15', isOffer:true, amount:'195.00', cardName:'Mewtwo ex PSA 10' },
      { from:'them', text:'No puedo bajar de ‚Ç¨205, llevo 3 semanas sin venderla y ya tuve una oferta de ‚Ç¨200 que rechac√©.', time:'11:18' },
      { from:'them', text:'La PSA 10 tiene cert #45821937', time:'11:20' },
    ]
  },
  {
    id:4, user:'PokeMarket_EU', initial:'P', color:'linear-gradient(135deg,#7b2d8b,#d4f53c)',
    status:'offline', type:'venta',
    card:{ name:'Umbreon ex', set:'Temporal Forces', price:'‚Ç¨67.30', cond:'LP', img:'https://assets.tcgdex.net/univ/sv/sv05/95/high.png' },
    last:'De acuerdo, cerramos a ‚Ç¨65', time:'Lun', unread:false,
    messages:[
      { from:'me', text:'Hola, el Umbreon ex LP, ¬øcu√°nto marca exactamente la condici√≥n?', time:'09:30' },
      { from:'them', text:'Un ara√±azo muy leve en el dorso, apenas visible. El frontal perfecto.', time:'09:45' },
      { from:'me', text:'¬øBajar√≠as a ‚Ç¨65? Dado que es LP.', time:'10:00' },
      { from:'them', text:'De acuerdo, cerramos a ‚Ç¨65', time:'10:15' },
      { type:'system', text:'Oferta aceptada ¬∑ ‚Ç¨65.00' },
    ]
  },
];

let currentConv = null;
let convFilter = 'all';

// ---- RENDER CONVS ----
function renderConvList(filter='', tab='all') {
  const list = document.getElementById('convList');
  const convs = CONVERSATIONS.filter(c => {
    if (tab !== 'all' && c.type !== tab) return false;
    if (filter && !c.user.toLowerCase().includes(filter.toLowerCase()) &&
        !c.card.name.toLowerCase().includes(filter.toLowerCase())) return false;
    return true;
  });

  if (!convs.length) {
    list.innerHTML = '<div style="padding:24px;text-align:center;font-family:var(--font-mono);font-size:0.7rem;color:var(--text3)">Sin conversaciones</div>';
    return;
  }

  list.innerHTML = convs.map(c => `
    <div class="conv-item ${c.unread?'unread':''} ${currentConv?.id===c.id?'active':''}" onclick="openConv(${c.id})">
      <div class="ci-av" style="background:${c.color}">${c.initial}</div>
      <div class="ci-info">
        <div class="ci-top">
          <div class="ci-name">${c.user}</div>
          <div class="ci-time">${c.time}</div>
        </div>
        <div class="ci-last">${c.card.name} ¬∑ ${c.last}</div>
      </div>
      ${c.card.img ? `<img class="ci-card-thumb" src="${c.card.img}" onerror="this.style.display='none'" alt="">` : ''}
    </div>`).join('');
}

function filterConvs(q) { renderConvList(q, convFilter); }
function filterTab(tab, btn) {
  convFilter = tab;
  document.querySelectorAll('.cf-tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  renderConvList('', tab);
}

// ---- OPEN CONVERSATION ----
function openConv(id) {
  const conv = CONVERSATIONS.find(c => c.id === id);
  if (!conv) return;
  conv.unread = false;
  currentConv = conv;
  renderConvList('', convFilter);

  // Show chat
  document.getElementById('chatEmpty').style.display = 'none';
  const cc = document.getElementById('chatContent');
  cc.style.display = 'flex';

  // Header
  document.getElementById('chAv').textContent = conv.user[0];
  document.getElementById('chAv').style.background = conv.color;
  document.getElementById('chName').textContent = conv.user;
  const statusEl = document.getElementById('chStatus');
  statusEl.textContent = conv.status === 'online' ? 'En l√≠nea' : '√öltima vez hace 2h';
  statusEl.className = 'ch-status' + (conv.status === 'offline' ? ' offline' : '');

  // Card context
  document.getElementById('ccImg').src = conv.card.img || '';
  document.getElementById('ccName').textContent = `${conv.card.name} ¬∑ ${conv.card.set}`;
  document.getElementById('ccPrice').textContent = conv.card.price;
  const badge = document.getElementById('ccBadge');
  badge.textContent = conv.card.cond;
  badge.className = 'cc-badge ' + (conv.card.isSlab ? 'cc-psa' : conv.card.cond==='NM'?'cc-nm':'cc-lp');

  // Modal card data
  document.getElementById('omCardImg').src = conv.card.img || '';
  document.getElementById('omCardName').textContent = conv.card.name;
  document.getElementById('omCardPrice').textContent = `Precio: ${conv.card.price}`;

  renderMessages(conv);
  renderQuickActions(conv);
}

// ---- RENDER MESSAGES ----
function renderMessages(conv) {
  const container = document.getElementById('messages');
  let html = '<div class="msg-day-divider">HOY</div>';

  conv.messages.forEach(msg => {
    if (msg.type === 'system') {
      html += `<div class="msg-system">‚ö° ${msg.text}</div>`;
      return;
    }
    const isMine = msg.from === 'me';

    if (msg.isOffer) {
      html += `
      <div class="msg ${isMine?'mine':'theirs'}">
        ${!isMine ? `<div class="msg-av" style="background:${conv.color}">${conv.user[0]}</div>` : ''}
        <div>
          <div class="msg-offer">
            <div class="msg-offer-label">üí∞ Oferta enviada</div>
            <div class="msg-offer-amount">‚Ç¨${msg.amount}</div>
            <div class="msg-offer-card">${msg.cardName}</div>
            ${!isMine ? `<div class="msg-offer-actions">
              <button class="btn-accept" onclick="acceptOffer(this, '${msg.amount}')">Aceptar</button>
              <button class="btn-decline" onclick="declineOffer(this)">Rechazar</button>
            </div>
            <div class="offer-accepted">‚úì Oferta aceptada</div>` : '<div style="font-family:var(--font-mono);font-size:0.65rem;color:rgba(8,8,13,0.5)">Pendiente de respuesta...</div>'}
          </div>
          <div class="msg-time">${msg.time||''}</div>
        </div>
        ${isMine ? `<div class="msg-av" style="background:${ME.color}">${ME.initial}</div>` : ''}
      </div>`;
      return;
    }

    html += `
    <div class="msg ${isMine?'mine':'theirs'}">
      ${!isMine ? `<div class="msg-av" style="background:${conv.color}">${conv.user[0]}</div>` : ''}
      <div>
        <div class="msg-bubble">${msg.text}</div>
        <div class="msg-time">${msg.time||''}</div>
      </div>
      ${isMine ? `<div class="msg-av" style="background:${ME.color}">${ME.initial}</div>` : ''}
    </div>`;
  });

  html += '<div class="typing-indicator" id="typingIndicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>';
  container.innerHTML = html;
  container.scrollTop = container.scrollHeight;
}

// ---- QUICK ACTIONS ----
function renderQuickActions(conv) {
  const qa = [
    '¬øCu√°ndo puedes enviar?',
    '¬øAceptas ‚Ç¨' + (parseFloat(conv.card.price.replace('‚Ç¨',''))*0.9).toFixed(0) + '?',
    '¬øPuedes mandar m√°s fotos?',
    '¬øVa en toploader?',
  ];
  document.getElementById('quickActions').innerHTML = qa.map(q =>
    `<button class="qa-btn" onclick="insertQuickAction('${q.replace(/'/g,"\\'")}')"> ${q}</button>`
  ).join('');
}

function insertQuickAction(text) {
  const input = document.getElementById('msgInput');
  input.value = text;
  input.focus();
  autoResize(input);
}

// ---- SEND MESSAGE ----
function sendMessage() {
  const input = document.getElementById('msgInput');
  const text = input.value.trim();
  if (!text || !currentConv) return;

  const now = new Date();
  const time = `${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
  currentConv.messages.push({ from:'me', text, time });
  currentConv.last = text;
  input.value = '';
  autoResize(input);
  renderMessages(currentConv);
  renderConvList('', convFilter);

  // Simulate reply after delay
  simulateReply();
}

function simulateReply() {
  if (!currentConv) return;
  const replies = [
    '¬°Perfecto! Te confirmo en un momento.',
    'De acuerdo, lo compruebo.',
    'S√≠, puedo hacer el env√≠o ma√±ana.',
    '¬øMe puedes decir tu c√≥digo postal para calcular el env√≠o?',
    'Genial, le doy un √∫ltimo vistazo y cerramos.',
  ];

  setTimeout(() => {
    const ti = document.getElementById('typingIndicator');
    if (ti) ti.classList.add('show');
    document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
  }, 600);

  setTimeout(() => {
    const ti = document.getElementById('typingIndicator');
    if (ti) ti.classList.remove('show');
    const reply = replies[Math.floor(Math.random()*replies.length)];
    const now = new Date();
    const time = `${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
    currentConv.messages.push({ from:'them', text:reply, time });
    currentConv.last = reply;
    renderMessages(currentConv);
    renderConvList('', convFilter);
  }, 2400);
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
}
function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 120) + 'px';
}

// ---- OFFER ----
function openOfferModal() {
  document.getElementById('offerModal').classList.add('open');
  document.getElementById('omAmount').value = '';
  document.getElementById('omAmount').focus();
}
function closeOfferModal(e) {
  if (e.target === document.getElementById('offerModal'))
    document.getElementById('offerModal').classList.remove('open');
}
function updateOfferHint() {
  const v = parseFloat(document.getElementById('omAmount').value);
  const hint = document.getElementById('omHint');
  if (!v || !currentConv) { hint.textContent='Introduce el precio que quieres ofrecer'; return; }
  const ref = parseFloat(currentConv.card.price.replace('‚Ç¨',''));
  const pct = ((v - ref) / ref * 100).toFixed(1);
  const diff = (v - ref).toFixed(2);
  hint.innerHTML = pct < 0
    ? `<span style="color:var(--mp)">${pct}% (${diff}‚Ç¨) respecto al precio pedido</span>`
    : `<span style="color:var(--nm)">+${pct}% (+${diff}‚Ç¨) respecto al precio pedido</span>`;
}
function submitOffer() {
  const v = document.getElementById('omAmount').value;
  if (!v || !currentConv) return;
  document.getElementById('offerModal').classList.remove('open');
  const now = new Date();
  const time = `${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
  currentConv.messages.push({ from:'me', isOffer:true, amount:parseFloat(v).toFixed(2), cardName:currentConv.card.name, time });
  currentConv.last = `Oferta: ‚Ç¨${parseFloat(v).toFixed(2)}`;
  renderMessages(currentConv);
  renderConvList('', convFilter);
  // Simulate response
  setTimeout(() => {
    const ti = document.getElementById('typingIndicator');
    if (ti) ti.classList.add('show');
  }, 1000);
  setTimeout(() => {
    const ti = document.getElementById('typingIndicator');
    if (ti) ti.classList.remove('show');
    const ref = parseFloat(currentConv.card.price.replace('‚Ç¨',''));
    const offered = parseFloat(v);
    const reply = offered >= ref*0.95
      ? '¬°Trato hecho! Procedo con el env√≠o.'
      : `Hmm, lo m√≠nimo que puedo aceptar es ‚Ç¨${(ref*0.95).toFixed(2)}.`;
    const now2 = new Date();
    const time2 = `${now2.getHours()}:${String(now2.getMinutes()).padStart(2,'0')}`;
    currentConv.messages.push({ from:'them', text:reply, time:time2 });
    currentConv.last = reply;
    renderMessages(currentConv);
    renderConvList('', convFilter);
  }, 2800);
}

function acceptOffer(btn, amount) {
  btn.closest('.msg-offer-actions').style.display = 'none';
  btn.closest('.msg-offer').querySelector('.offer-accepted').classList.add('show');
  if (currentConv) {
    currentConv.messages.push({ type:'system', text:`Oferta aceptada ¬∑ ‚Ç¨${amount}` });
    renderMessages(currentConv);
  }
}
function declineOffer(btn) {
  btn.closest('.msg-offer').style.opacity = '0.4';
  btn.closest('.msg-offer-actions').innerHTML = '<div style="font-family:var(--font-mono);font-size:0.65rem;color:var(--mp)">Oferta rechazada</div>';
}

function buyNow() {
  if (!currentConv) return;
  const msg = `‚úÖ He pulsado Comprar ahora. ¬øPuedes confirmar disponibilidad para proceder?`;
  const now = new Date();
  currentConv.messages.push({ from:'me', text:msg, time:`${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}` });
  renderMessages(currentConv);
}

// ---- INIT ----
renderConvList();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg ¬∑ Perfil de vendedor</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#08080d; --bg2:#0e0e16; --surface:#11111c; --surface2:#181825;
  --border:#22223a; --border2:#2d2d4a;
  --accent:#d4f53c; --accent-glow:rgba(212,245,60,0.15); --accent-dim:rgba(212,245,60,0.06);
  --text:#eeeef8; --text2:#9898b8; --text3:#55556a;
  --nm:#2ed573; --lp:#ffa502; --mp:#ff4757;
  --nm-bg:rgba(46,213,115,0.08); --lp-bg:rgba(255,165,2,0.08); --mp-bg:rgba(255,71,87,0.08);
  --psa10:#d4f53c; --psa9:#38bdf8; --psa8:#a78bfa;
  --font-display:'Bebas Neue',sans-serif;
  --font-mono:'DM Mono',monospace;
  --font-body:'Plus Jakarta Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay;}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* NAV */
nav{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:60px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(8,8,13,0.96);backdrop-filter:blur(24px);z-index:100;}
.logo{font-family:var(--font-display);font-size:1.8rem;letter-spacing:3px;cursor:pointer;}
.logo .dot{color:var(--accent);}
.nav-pills{display:flex;gap:0;border:1px solid var(--border);border-radius:6px;overflow:hidden;}
.nav-tab{padding:7px 22px;font-family:var(--font-mono);font-size:0.72rem;font-weight:500;letter-spacing:1px;text-transform:uppercase;color:var(--text2);cursor:pointer;border:none;background:none;border-right:1px solid var(--border);transition:all 0.15s;}
.nav-tab:last-child{border-right:none;}
.nav-tab:hover{background:var(--surface);color:var(--text);}
.nav-tab.active{background:var(--accent);color:#08080d;font-weight:700;}
.nav-right{display:flex;gap:10px;align-items:center;}
.btn-outline{padding:7px 16px;border:1px solid var(--border2);border-radius:5px;background:none;color:var(--text2);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-outline:hover{border-color:var(--accent);color:var(--accent);}
.btn-accent{padding:7px 18px;border:none;border-radius:5px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all 0.15s;}
.btn-accent:hover{box-shadow:0 0 20px var(--accent-glow);transform:translateY(-1px);}

/* PROFILE HEADER */
.profile-header{background:var(--bg2);border-bottom:1px solid var(--border);padding:36px 40px 28px;position:relative;overflow:hidden;}
.ph-glow{position:absolute;top:-100px;right:-60px;width:400px;height:400px;background:radial-gradient(circle,rgba(212,245,60,0.05) 0%,transparent 70%);pointer-events:none;}

.ph-inner{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:auto 1fr auto;gap:24px;align-items:start;}

/* Avatar */
.ph-avatar{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#3d2a6e,#d4f53c);display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-size:2.2rem;letter-spacing:1px;color:#08080d;flex-shrink:0;border:2px solid rgba(212,245,60,0.3);}

/* Info */
.ph-info{}
.ph-top{display:flex;align-items:center;gap:12px;margin-bottom:6px;flex-wrap:wrap;}
.ph-username{font-family:var(--font-display);font-size:2rem;letter-spacing:2px;}
.ph-verified{display:inline-flex;align-items:center;gap:5px;background:var(--nm-bg);border:1px solid rgba(46,213,115,0.2);border-radius:4px;padding:3px 10px;font-family:var(--font-mono);font-size:0.62rem;color:var(--nm);letter-spacing:0.5px;}
.ph-type{display:inline-flex;align-items:center;gap:5px;background:var(--surface2);border:1px solid var(--border2);border-radius:4px;padding:3px 10px;font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);letter-spacing:0.5px;}
.ph-meta{display:flex;align-items:center;gap:16px;margin-bottom:10px;flex-wrap:wrap;}
.ph-meta-item{font-family:var(--font-mono);font-size:0.68rem;color:var(--text3);letter-spacing:0.3px;display:flex;align-items:center;gap:5px;}
.ph-desc{font-size:0.85rem;color:var(--text2);font-weight:300;line-height:1.6;max-width:560px;}

/* Stars */
.stars{display:flex;gap:2px;align-items:center;}
.star{color:var(--accent);font-size:0.85rem;}
.star.empty{color:var(--border2);}
.rating-num{font-family:var(--font-display);font-size:1.1rem;letter-spacing:0.5px;color:var(--accent);margin-left:6px;}
.rating-count{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);margin-left:4px;}

/* Ph actions */
.ph-actions{display:flex;flex-direction:column;gap:8px;align-items:flex-end;}
.btn-msg{display:flex;align-items:center;gap:7px;padding:10px 20px;border:1px solid var(--border2);border-radius:6px;background:none;color:var(--text2);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-msg:hover{border-color:var(--accent);color:var(--accent);}
.btn-follow{display:flex;align-items:center;gap:7px;padding:10px 20px;border:none;border-radius:6px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-follow:hover{box-shadow:0 0 16px var(--accent-glow);}
.btn-follow.following{background:var(--surface2);border:1px solid var(--border2);color:var(--text3);}
.ph-member{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);letter-spacing:0.3px;text-align:right;}

/* STATS BAR */
.stats-bar{background:var(--surface);border-bottom:1px solid var(--border);}
.stats-inner{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:repeat(5,1fr);divide-x:1px solid var(--border);}
.stat-item{padding:16px 24px;text-align:center;border-right:1px solid var(--border);}
.stat-item:last-child{border-right:none;}
.si-val{font-family:var(--font-display);font-size:1.6rem;letter-spacing:1px;line-height:1;margin-bottom:5px;}
.si-val.accent{color:var(--accent);}
.si-val.green{color:var(--nm);}
.si-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;}

/* MAIN LAYOUT */
.main-wrap{max-width:1200px;margin:0 auto;padding:28px 40px 80px;display:grid;grid-template-columns:1fr 320px;gap:24px;}

/* LEFT */
.left-col{}

/* Section */
.section{margin-bottom:28px;}
.sec-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--border);}
.sec-title{font-family:var(--font-display);font-size:1.2rem;letter-spacing:1px;}
.sec-meta{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:0.5px;}
.sec-link{font-family:var(--font-mono);font-size:0.65rem;color:var(--accent);cursor:pointer;letter-spacing:0.5px;transition:opacity 0.15s;}
.sec-link:hover{opacity:0.7;}

/* Listings grid */
.listings-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:10px;}
.listing-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;transition:all 0.2s;position:relative;}
.listing-card:hover{transform:translateY(-3px);border-color:var(--border2);box-shadow:0 12px 24px rgba(0,0,0,0.4);}
.lc-img{width:100%;height:120px;background:linear-gradient(135deg,#13132a,#1a1a35);display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;}
.lc-img img{width:100%;height:100%;object-fit:contain;padding:4px;}
.lc-badge{position:absolute;top:6px;left:6px;font-family:var(--font-mono);font-size:0.58rem;font-weight:700;padding:2px 6px;border-radius:3px;letter-spacing:0.5px;}
.lc-nm{background:rgba(46,213,115,0.15);border:1px solid rgba(46,213,115,0.3);color:var(--nm);}
.lc-lp{background:rgba(255,165,2,0.15);border:1px solid rgba(255,165,2,0.3);color:var(--lp);}
.lc-psa{background:rgba(212,245,60,0.12);border:1px solid rgba(212,245,60,0.3);color:var(--psa10);}
.lc-verified{position:absolute;top:6px;right:6px;width:18px;height:18px;border-radius:50%;background:var(--nm);display:flex;align-items:center;justify-content:center;font-size:0.55rem;}
.lc-body{padding:9px 10px;}
.lc-name{font-family:var(--font-display);font-size:0.88rem;letter-spacing:0.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:1px;}
.lc-set{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-bottom:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.lc-price{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;color:var(--accent);}

/* Sales history */
.sales-list{display:flex;flex-direction:column;gap:8px;}
.sale-item{display:flex;align-items:center;gap:14px;padding:12px 14px;background:var(--surface);border:1px solid var(--border);border-radius:8px;}
.si-thumb{width:34px;height:46px;object-fit:contain;border-radius:4px;background:var(--surface2);flex-shrink:0;}
.si-info{flex:1;min-width:0;}
.si-name{font-size:0.83rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px;}
.si-meta{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);letter-spacing:0.3px;}
.si-price{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;color:var(--accent);flex-shrink:0;}
.si-date{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);flex-shrink:0;text-align:right;}

/* Reviews */
.reviews-list{display:flex;flex-direction:column;gap:10px;}
.review-item{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px;}
.ri-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.ri-user{display:flex;align-items:center;gap:10px;}
.ri-av{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;color:#08080d;flex-shrink:0;}
.ri-name{font-size:0.82rem;font-weight:600;margin-bottom:1px;}
.ri-date{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);}
.ri-stars{display:flex;gap:2px;}
.ri-star{color:var(--accent);font-size:0.78rem;}
.ri-star.empty{color:var(--border2);}
.ri-text{font-size:0.82rem;color:var(--text2);line-height:1.6;font-weight:300;margin-bottom:8px;}
.ri-card{display:inline-flex;align-items:center;gap:6px;padding:3px 10px;background:var(--surface2);border:1px solid var(--border);border-radius:4px;font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);}

/* Rating breakdown */
.rating-breakdown{margin-bottom:16px;}
.rb-row{display:flex;align-items:center;gap:10px;margin-bottom:5px;}
.rb-stars{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);width:30px;text-align:right;flex-shrink:0;}
.rb-bar-wrap{flex:1;height:6px;background:var(--border);border-radius:3px;overflow:hidden;}
.rb-bar{height:100%;background:var(--accent);border-radius:3px;transition:width 0.4s ease;}
.rb-count{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);width:24px;flex-shrink:0;}

/* RIGHT sidebar */
.right-col{}

.sidebar-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;}
.sc-title{font-family:var(--font-display);font-size:1rem;letter-spacing:1px;margin-bottom:14px;}
.sc-row{display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid var(--border);}
.sc-row:last-child{border-bottom:none;}
.sc-label{font-family:var(--font-mono);font-size:0.68rem;color:var(--text3);}
.sc-val{font-family:var(--font-mono);font-size:0.72rem;font-weight:500;}
.sc-val.green{color:var(--nm);}
.sc-val.accent{color:var(--accent);}

/* Response time bar */
.response-bar{height:6px;background:var(--border);border-radius:3px;margin-top:8px;overflow:hidden;}
.rb-fill{height:100%;border-radius:3px;background:var(--nm);}

/* Badges */
.badges-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.badge-item{padding:10px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;text-align:center;}
.badge-icon{font-size:1.4rem;margin-bottom:4px;}
.badge-name{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:0.5px;line-height:1.3;}

/* Report */
.report-link{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);cursor:pointer;transition:color 0.15s;display:block;text-align:center;margin-top:4px;letter-spacing:0.3px;}
.report-link:hover{color:var(--mp);}

@media(max-width:960px){
  nav{padding:0 18px;}
  .nav-pills{display:none;}
  .profile-header{padding:24px 18px 20px;}
  .ph-inner{grid-template-columns:auto 1fr;gap:16px;}
  .ph-actions{display:none;}
  .stats-inner{grid-template-columns:repeat(3,1fr);}
  .stat-item:nth-child(4),.stat-item:nth-child(5){display:none;}
  .main-wrap{grid-template-columns:1fr;padding:20px 18px 60px;}
  .right-col{order:-1;}
  .listings-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));}
}
</style>
</head>
<body>

<nav>
  <div class="logo" onclick="window.location.href='pple-tcg.html'">PPLE<span class="dot">.</span>TCG</div>
  <div class="nav-pills">
    <button class="nav-tab" onclick="window.location.href='pple-tcg.html'">Mercado</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-vender.html'">Vender</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-verificacion.html'">Verificaci√≥n</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-portfolio.html'">Portfolio</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-mensajes.html'">Mensajes</button>
  </div>
  <div class="nav-right">
    <button class="btn-outline" onclick="window.location.href='pple-tcg-auth.html'">Entrar</button>
    <button class="btn-accent">Registrarse</button>
  </div>
</nav>

<!-- PROFILE HEADER -->
<div class="profile-header">
  <div class="ph-glow"></div>
  <div class="ph-inner">
    <div class="ph-avatar">T</div>
    <div class="ph-info">
      <div class="ph-top">
        <div class="ph-username">TrainerRed99</div>
        <div class="ph-verified">‚úì Verificado</div>
        <div class="ph-type">Particular</div>
      </div>
      <div class="ph-meta">
        <div class="ph-meta-item">
          <div class="stars" id="headerStars"></div>
          <span class="rating-num">4.9</span>
          <span class="rating-count">(127 valoraciones)</span>
        </div>
        <div class="ph-meta-item">üìç Madrid, Espa√±a</div>
        <div class="ph-meta-item">üìÖ Miembro desde enero 2023</div>
        <div class="ph-meta-item">‚ö° Responde en menos de 1h</div>
      </div>
      <div class="ph-desc">Coleccionista de Pok√©mon TCG especializado en cartas de la era Scarlet & Violet y japonesas. Siempre env√≠o en toploader y manga con seguimiento. ¬°Pregunta sin compromiso!</div>
    </div>
    <div class="ph-actions">
      <button class="btn-follow" id="btnFollow" onclick="toggleFollow()">+ Seguir</button>
      <button class="btn-msg" onclick="window.location.href='pple-tcg-mensajes.html'">üí¨ Mensaje</button>
      <div class="ph-member">Miembro desde ene. 2023</div>
    </div>
  </div>
</div>

<!-- STATS BAR -->
<div class="stats-bar">
  <div class="stats-inner">
    <div class="stat-item">
      <div class="si-val accent">247</div>
      <div class="si-label">Ventas totales</div>
    </div>
    <div class="stat-item">
      <div class="si-val green">99.2%</div>
      <div class="si-label">Valoraci√≥n positiva</div>
    </div>
    <div class="stat-item">
      <div class="si-val">18</div>
      <div class="si-label">Cartas en venta</div>
    </div>
    <div class="stat-item">
      <div class="si-val">&lt;1h</div>
      <div class="si-label">Tiempo de respuesta</div>
    </div>
    <div class="stat-item">
      <div class="si-val green">4.9</div>
      <div class="si-label">Puntuaci√≥n media</div>
    </div>
  </div>
</div>

<!-- MAIN -->
<div class="main-wrap">

  <!-- LEFT -->
  <div class="left-col">

    <!-- ACTIVE LISTINGS -->
    <div class="section">
      <div class="sec-header">
        <div>
          <div class="sec-title">EN VENTA AHORA</div>
          <div class="sec-meta">18 cartas publicadas</div>
        </div>
        <span class="sec-link" onclick="window.location.href='pple-tcg.html'">Ver todas ‚Üí</span>
      </div>
      <div class="listings-grid" id="listingsGrid"></div>
    </div>

    <!-- SALES HISTORY -->
    <div class="section">
      <div class="sec-header">
        <div>
          <div class="sec-title">VENTAS RECIENTES</div>
          <div class="sec-meta">√öltimas 10 transacciones completadas</div>
        </div>
      </div>
      <div class="sales-list" id="salesList"></div>
    </div>

    <!-- REVIEWS -->
    <div class="section">
      <div class="sec-header">
        <div>
          <div class="sec-title">VALORACIONES</div>
          <div class="sec-meta">127 rese√±as verificadas</div>
        </div>
      </div>

      <!-- Rating breakdown -->
      <div class="rating-breakdown" id="ratingBreakdown"></div>

      <!-- Reviews list -->
      <div class="reviews-list" id="reviewsList"></div>
    </div>

  </div>

  <!-- RIGHT SIDEBAR -->
  <div class="right-col">

    <!-- Quick stats -->
    <div class="sidebar-card">
      <div class="sc-title">RESUMEN DEL VENDEDOR</div>
      <div class="sc-row"><span class="sc-label">Tiempo de respuesta</span><span class="sc-val green">&lt; 1 hora</span></div>
      <div class="sc-row"><span class="sc-label">Plazo de env√≠o</span><span class="sc-val">24‚Äì48h</span></div>
      <div class="sc-row"><span class="sc-label">Transportista habitual</span><span class="sc-val">Correos Express</span></div>
      <div class="sc-row"><span class="sc-label">Env√≠o internacional</span><span class="sc-val green">S√≠</span></div>
      <div class="sc-row"><span class="sc-label">Acepta ofertas</span><span class="sc-val green">S√≠</span></div>
      <div class="sc-row"><span class="sc-label">Cartas verificadas</span><span class="sc-val accent">12 / 18</span></div>
      <div style="margin-top:14px;display:flex;flex-direction:column;gap:8px;">
        <button class="btn-accent" style="width:100%;padding:10px;" onclick="window.location.href='pple-tcg-mensajes.html'">üí¨ Enviar mensaje</button>
        <button class="btn-outline" style="width:100%;padding:10px;">Ver todas las cartas</button>
      </div>
    </div>

    <!-- Response time visual -->
    <div class="sidebar-card">
      <div class="sc-title">TIEMPO DE RESPUESTA</div>
      <div style="font-family:var(--font-display);font-size:2rem;letter-spacing:1px;color:var(--nm);margin-bottom:4px;">&lt; 1h</div>
      <div style="font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);margin-bottom:10px;">Promedio de los √∫ltimos 30 d√≠as</div>
      <div class="response-bar"><div class="rb-fill" style="width:95%"></div></div>
      <div style="font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);margin-top:5px;display:flex;justify-content:space-between;">
        <span>Inmediato</span><span>+24h</span>
      </div>
    </div>

    <!-- Badges -->
    <div class="sidebar-card">
      <div class="sc-title">LOGROS</div>
      <div class="badges-grid">
        <div class="badge-item"><div class="badge-icon">‚ö°</div><div class="badge-name">Respuesta r√°pida</div></div>
        <div class="badge-item"><div class="badge-icon">üèÜ</div><div class="badge-name">Top vendedor</div></div>
        <div class="badge-item"><div class="badge-icon">‚úÖ</div><div class="badge-name">Verificado Pple</div></div>
        <div class="badge-item"><div class="badge-icon">üì¶</div><div class="badge-name">200+ ventas</div></div>
        <div class="badge-item"><div class="badge-icon">‚≠ê</div><div class="badge-name">Valoraci√≥n 5‚òÖ</div></div>
        <div class="badge-item"><div class="badge-icon">üåç</div><div class="badge-name">Env√≠o EU</div></div>
      </div>
    </div>

    <span class="report-link">‚öë Reportar este perfil</span>

  </div>
</div>

<script>
// ---- DATA ----
const LISTINGS = [
  { name:'Charizard ex',     set:'Obsidian Flames', img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',    price:124.50, cond:'NM',    verified:true },
  { name:'Pikachu ex',       set:'Paldea Evolved',  img:'https://assets.tcgdex.net/univ/sv/sv02/83/high.png',   price:84.20,  cond:'NM',    verified:true },
  { name:'Mewtwo ex',        set:'151',             img:'https://assets.tcgdex.net/univ/sv/sv3pt5/11/high.png', price:210.00, cond:'PSA 10',verified:true },
  { name:'Umbreon ex',       set:'Temporal Forces', img:'https://assets.tcgdex.net/univ/sv/sv05/95/high.png',   price:67.30,  cond:'LP',    verified:false },
  { name:'Gardevoir ex',     set:'Paradox Rift',    img:'https://assets.tcgdex.net/univ/sv/sv04/84/high.png',   price:45.80,  cond:'NM',    verified:true },
  { name:'Iron Valiant ex',  set:'Twilight Masq.',  img:'https://assets.tcgdex.net/univ/sv/sv06/210/high.png',  price:38.20,  cond:'NM',    verified:false },
  { name:'Miraidon ex',      set:'Scarlet & Violet',img:'https://assets.tcgdex.net/univ/sv/sv01/198/high.png',  price:52.40,  cond:'NM',    verified:true },
  { name:'Tyranitar ex',     set:'Obsidian Flames', img:'https://assets.tcgdex.net/univ/sv/sv03/125/high.png',  price:89.00,  cond:'PSA 9', verified:true },
];

const SALES = [
  { name:'Rayquaza ex',      set:'Obsidian Flames',  img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',    price:145.00, date:'24 Feb 2026', buyer:'pokefan_es' },
  { name:'Eevee ex',         set:'151',              img:'https://assets.tcgdex.net/univ/sv/sv3pt5/11/high.png', price:28.50,  date:'22 Feb 2026', buyer:'CardHunter' },
  { name:'Blastoise ex',     set:'Paldea Evolved',   img:'https://assets.tcgdex.net/univ/sv/sv02/83/high.png',   price:61.00,  date:'19 Feb 2026', buyer:'JuanTrainer' },
  { name:'Sylveon ex',       set:'Paldea Evolved',   img:'https://assets.tcgdex.net/univ/sv/sv02/201/high.png',  price:55.00,  date:'17 Feb 2026', buyer:'PokeCollect' },
  { name:'Terapagos ex',     set:'Temporal Forces',  img:'https://assets.tcgdex.net/univ/sv/sv05/176/high.png',  price:41.50,  date:'14 Feb 2026', buyer:'tcg_madrid' },
];

const REVIEWS = [
  { user:'pokefan_es',  color:'linear-gradient(135deg,#1a1a2e,#e94560)', stars:5, date:'24 Feb 2026',
    text:'Vendedor excelente. La carta lleg√≥ perfectamente embalada en toploader y manga blanda. Exactamente como se describe, NM total. Env√≠o rapid√≠simo, en 24h ya la ten√≠a en casa. 100% recomendable.', card:'Rayquaza ex' },
  { user:'CardHunter', color:'linear-gradient(135deg,#0f3460,#533483)', stars:5, date:'22 Feb 2026',
    text:'Todo perfecto. Muy buen comunicador, respondi√≥ todas mis dudas antes de comprar. La Eevee ex lleg√≥ en condiciones impecables.', card:'Eevee ex' },
  { user:'JuanTrainer', color:'linear-gradient(135deg,#2d6a4f,#d4f53c)', stars:4, date:'19 Feb 2026',
    text:'Buen vendedor, carta en buen estado. Tard√≥ un poco m√°s de lo esperado en enviarla (3 d√≠as) pero lleg√≥ bien protegida y en el estado descrito.', card:'Blastoise ex' },
  { user:'PokeCollect', color:'linear-gradient(135deg,#7b2d8b,#d4f53c)', stars:5, date:'17 Feb 2026',
    text:'Perfecta transacci√≥n. El vendedor muy atento y la carta ven√≠a con sleeve y toploader de calidad. Repetir√© sin duda.', card:'Sylveon ex' },
];

const RATING_DIST = { 5:118, 4:6, 3:2, 2:1, 1:0 };

// ---- RENDER ----
function renderStars(n, container) {
  container.innerHTML = [1,2,3,4,5].map(i =>
    `<span class="star ${i<=n?'':'empty'}">‚òÖ</span>`).join('');
}

function renderHeaderStars() {
  renderStars(5, document.getElementById('headerStars'));
}

function renderListings() {
  document.getElementById('listingsGrid').innerHTML = LISTINGS.map(l => {
    const isPsa = l.cond.startsWith('PSA');
    const badgeClass = isPsa ? 'lc-psa' : l.cond==='NM' ? 'lc-nm' : 'lc-lp';
    return `
    <div class="listing-card">
      <div class="lc-img">
        <img src="${l.img}" alt="${l.name}" onerror="this.parentNode.innerHTML='üé¥'">
        <div class="lc-badge ${badgeClass}">${l.cond}</div>
        ${l.verified ? '<div class="lc-verified">‚úì</div>' : ''}
      </div>
      <div class="lc-body">
        <div class="lc-name">${l.name}</div>
        <div class="lc-set">${l.set}</div>
        <div class="lc-price">‚Ç¨${l.price.toFixed(2)}</div>
      </div>
    </div>`;
  }).join('');
}

function renderSales() {
  document.getElementById('salesList').innerHTML = SALES.map(s => `
    <div class="sale-item">
      <img class="si-thumb" src="${s.img}" onerror="this.style.display='none'" alt="">
      <div class="si-info">
        <div class="si-name">${s.name}</div>
        <div class="si-meta">${s.set} ¬∑ Comprador: @${s.buyer}</div>
      </div>
      <div class="si-price">‚Ç¨${s.price.toFixed(2)}</div>
      <div class="si-date">${s.date}</div>
    </div>`).join('');
}

function renderRatingBreakdown() {
  const total = Object.values(RATING_DIST).reduce((a,b)=>a+b,0);
  document.getElementById('ratingBreakdown').innerHTML = [5,4,3,2,1].map(n => {
    const count = RATING_DIST[n] || 0;
    const pct = total ? (count/total*100).toFixed(0) : 0;
    return `<div class="rb-row">
      <span class="rb-stars">${n}‚òÖ</span>
      <div class="rb-bar-wrap"><div class="rb-bar" style="width:${pct}%"></div></div>
      <span class="rb-count">${count}</span>
    </div>`;
  }).join('');
}

function renderReviews() {
  document.getElementById('reviewsList').innerHTML = REVIEWS.map(r => `
    <div class="review-item">
      <div class="ri-top">
        <div class="ri-user">
          <div class="ri-av" style="background:${r.color}">${r.user[0]}</div>
          <div>
            <div class="ri-name">@${r.user}</div>
            <div class="ri-date">${r.date}</div>
          </div>
        </div>
        <div class="ri-stars">${[1,2,3,4,5].map(i=>`<span class="ri-star ${i<=r.stars?'':'empty'}">‚òÖ</span>`).join('')}</div>
      </div>
      <div class="ri-text">${r.text}</div>
      <div class="ri-card">üÉè ${r.card}</div>
    </div>`).join('');
}

let following = false;
function toggleFollow() {
  following = !following;
  const btn = document.getElementById('btnFollow');
  btn.textContent = following ? '‚úì Siguiendo' : '+ Seguir';
  btn.classList.toggle('following', following);
}

// ---- INIT ----
renderHeaderStars();
renderListings();
renderSales();
renderRatingBreakdown();
renderReviews();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg ¬∑ Portfolio</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#08080d; --bg2:#0e0e16; --surface:#11111c; --surface2:#181825;
  --border:#22223a; --border2:#2d2d4a;
  --accent:#d4f53c; --accent-glow:rgba(212,245,60,0.15); --accent-dim:rgba(212,245,60,0.06);
  --text:#eeeef8; --text2:#9898b8; --text3:#55556a;
  --nm:#2ed573; --lp:#ffa502; --mp:#ff4757;
  --nm-bg:rgba(46,213,115,0.08); --lp-bg:rgba(255,165,2,0.08); --mp-bg:rgba(255,71,87,0.08);
  --psa10:#d4f53c; --psa9:#38bdf8; --psa8:#a78bfa;
  --sealed:#f59e0b;
  --sealed-bg:rgba(245,158,11,0.08);
  --font-display:'Bebas Neue',sans-serif;
  --font-mono:'DM Mono',monospace;
  --font-body:'Plus Jakarta Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay;}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* NAV */
nav{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:60px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(8,8,13,0.96);backdrop-filter:blur(24px);z-index:100;}
.logo{font-family:var(--font-display);font-size:1.8rem;letter-spacing:3px;cursor:pointer;}
.logo .dot{color:var(--accent);}
.nav-pills{display:flex;gap:0;border:1px solid var(--border);border-radius:6px;overflow:hidden;}
.nav-tab{padding:7px 22px;font-family:var(--font-mono);font-size:0.72rem;font-weight:500;letter-spacing:1px;text-transform:uppercase;color:var(--text2);cursor:pointer;border:none;background:none;border-right:1px solid var(--border);transition:all 0.15s;}
.nav-tab:last-child{border-right:none;}
.nav-tab:hover{background:var(--surface);color:var(--text);}
.nav-tab.active{background:var(--accent);color:#08080d;font-weight:700;}
.nav-right{display:flex;gap:10px;align-items:center;}
.nav-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#3d2a6e,#d4f53c);display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;color:#08080d;cursor:pointer;border:1px solid rgba(212,245,60,0.3);}
.btn-accent{padding:7px 18px;border:none;border-radius:5px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all 0.15s;}
.btn-accent:hover{box-shadow:0 0 20px var(--accent-glow);transform:translateY(-1px);}

/* PAGE HEADER */
.page-header{padding:32px 40px 28px;border-bottom:1px solid var(--border);background:var(--bg2);display:flex;align-items:flex-end;justify-content:space-between;gap:24px;flex-wrap:wrap;}
.ph-left{}
.ph-eyebrow{font-family:var(--font-mono);font-size:0.65rem;color:var(--accent);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;}
.ph-title{font-family:var(--font-display);font-size:2.8rem;letter-spacing:2px;line-height:1;margin-bottom:4px;}
.ph-user{font-family:var(--font-mono);font-size:0.72rem;color:var(--text3);letter-spacing:1px;}
.ph-right{display:flex;gap:8px;}
.btn-outline{padding:8px 16px;border:1px solid var(--border2);border-radius:6px;background:none;color:var(--text2);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-outline:hover{border-color:var(--accent);color:var(--accent);}

/* MAIN */
.main{max-width:1400px;margin:0 auto;padding:28px 40px 80px;}

/* KPI ROW */
.kpi-row{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-bottom:24px;}
.kpi-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 18px;transition:border-color 0.15s;}
.kpi-card:hover{border-color:var(--border2);}
.kpi-card.highlight{border-color:rgba(212,245,60,0.2);background:var(--accent-dim);}
.kc-label{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;}
.kc-val{font-family:var(--font-display);font-size:1.8rem;letter-spacing:1px;line-height:1;color:var(--text);}
.kc-val.accent{color:var(--accent);}
.kc-sub{font-family:var(--font-mono);font-size:0.65rem;margin-top:5px;}
.kc-up{color:var(--nm);}
.kc-down{color:var(--mp);}
.kc-flat{color:var(--text3);}

/* CHART SECTION */
.chart-section{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:24px;}
.cs-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.cs-title{font-family:var(--font-display);font-size:1.3rem;letter-spacing:1px;}
.cs-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);margin-top:2px;letter-spacing:0.5px;}
.period-tabs{display:flex;gap:4px;}
.pt-btn{padding:4px 12px;border-radius:4px;border:1px solid var(--border);background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.65rem;cursor:pointer;transition:all 0.12s;letter-spacing:0.3px;}
.pt-btn.active{background:var(--accent);border-color:var(--accent);color:#08080d;font-weight:700;}
.chart-wrap{position:relative;}
svg.portfolio-chart{width:100%;height:180px;}
.chart-labels{display:flex;justify-content:space-between;margin-top:8px;padding:0 2px;}
.chart-lbl{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:0.3px;}
.chart-tooltip{position:absolute;background:var(--surface2);border:1px solid var(--border2);border-radius:6px;padding:8px 12px;font-family:var(--font-mono);font-size:0.7rem;pointer-events:none;display:none;white-space:nowrap;}
.ct-date{color:var(--text3);font-size:0.62rem;margin-bottom:3px;}
.ct-val{color:var(--accent);font-weight:500;}

/* SECTION HEADERS */
.section{margin-bottom:28px;}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.sh-left{display:flex;align-items:center;gap:12px;}
.sh-icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;}
.sh-icon.raw{background:var(--nm-bg);border:1px solid rgba(46,213,115,0.2);}
.sh-icon.psa{background:rgba(212,245,60,0.07);border:1px solid rgba(212,245,60,0.15);}
.sh-icon.sealed{background:var(--sealed-bg);border:1px solid rgba(245,158,11,0.2);}
.sh-icon.wish{background:var(--mp-bg);border:1px solid rgba(255,71,87,0.15);}
.sh-title{font-family:var(--font-display);font-size:1.2rem;letter-spacing:1px;}
.sh-count{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:1px;}
.sh-value{font-family:var(--font-display);font-size:1.1rem;letter-spacing:0.5px;color:var(--accent);}
.sh-right{display:flex;align-items:center;gap:10px;}
.add-btn{display:flex;align-items:center;gap:6px;padding:6px 14px;border:1px solid var(--border2);border-radius:5px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.68rem;font-weight:600;cursor:pointer;transition:all 0.15s;letter-spacing:0.3px;text-transform:uppercase;}
.add-btn:hover{border-color:var(--accent);color:var(--accent);}

/* CARDS GRID */
.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;}

.pcard{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;transition:all 0.2s;position:relative;}
.pcard:hover{transform:translateY(-3px);border-color:var(--border2);box-shadow:0 12px 24px rgba(0,0,0,0.4);}
.pcard.for-sale{border-color:rgba(212,245,60,0.2);}
.pcard.for-sale::after{content:'EN VENTA';position:absolute;top:7px;right:7px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.55rem;font-weight:700;letter-spacing:1px;padding:2px 6px;border-radius:3px;}

.pcard-img{width:100%;height:130px;background:linear-gradient(135deg,#13132a,#1a1a35);display:flex;align-items:center;justify-content:center;font-size:2rem;overflow:hidden;position:relative;}
.pcard-img img{width:100%;height:100%;object-fit:contain;padding:4px;}

/* slab frame effect */
.pcard.is-slab .pcard-img{background:linear-gradient(135deg,#1a1a0a,#2a2a10,#1a1a0a);border-bottom:2px solid rgba(212,245,60,0.15);}

.pc-grade{position:absolute;bottom:6px;left:6px;font-family:var(--font-mono);font-size:0.6rem;font-weight:700;padding:2px 7px;border-radius:3px;letter-spacing:0.5px;}
.grade-10{background:rgba(212,245,60,0.2);border:1px solid rgba(212,245,60,0.4);color:#d4f53c;}
.grade-9{background:rgba(56,189,248,0.15);border:1px solid rgba(56,189,248,0.3);color:#38bdf8;}
.grade-8{background:rgba(167,139,250,0.15);border:1px solid rgba(167,139,250,0.3);color:#a78bfa;}
.cond-raw{position:absolute;bottom:6px;left:6px;font-family:var(--font-mono);font-size:0.6rem;font-weight:700;padding:2px 7px;border-radius:3px;letter-spacing:0.5px;}
.raw-nm{background:rgba(46,213,115,0.15);border:1px solid rgba(46,213,115,0.3);color:var(--nm);}
.raw-lp{background:rgba(255,165,2,0.15);border:1px solid rgba(255,165,2,0.3);color:var(--lp);}

.pcard-body{padding:10px 11px;}
.pc-name{font-family:var(--font-display);font-size:0.9rem;letter-spacing:0.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:1px;}
.pc-set{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-bottom:7px;letter-spacing:0.3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.pc-footer{display:flex;justify-content:space-between;align-items:baseline;}
.pc-price{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;}
.pc-chg{font-family:var(--font-mono);font-size:0.6rem;}
.chg-up{color:var(--nm);}
.chg-down{color:var(--mp);}
.pc-paid{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-top:3px;}

/* Sealed product grid */
.sealed-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:10px;}
.sealed-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;transition:all 0.2s;}
.sealed-card:hover{transform:translateY(-3px);border-color:rgba(245,158,11,0.3);box-shadow:0 12px 24px rgba(0,0,0,0.4);}
.sc-img{width:100%;height:150px;background:linear-gradient(135deg,#1a1208,#2a200a,#1a1208);display:flex;align-items:center;justify-content:center;font-size:2.5rem;overflow:hidden;}
.sc-img img{width:100%;height:100%;object-fit:contain;padding:8px;}
.sc-body{padding:11px 12px;}
.sc-type{font-family:var(--font-mono);font-size:0.6rem;color:var(--sealed);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:4px;}
.sc-name{font-family:var(--font-display);font-size:0.95rem;letter-spacing:0.5px;margin-bottom:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sc-set{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);margin-bottom:7px;letter-spacing:0.3px;}
.sc-footer{display:flex;justify-content:space-between;align-items:baseline;}
.sc-price{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;color:var(--sealed);}
.sc-trend{font-family:var(--font-mono);font-size:0.6rem;}
.sc-qty{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);margin-top:3px;}
.sealed-badge{display:inline-flex;align-items:center;gap:4px;background:var(--sealed-bg);border:1px solid rgba(245,158,11,0.2);border-radius:3px;padding:2px 7px;font-family:var(--font-mono);font-size:0.6rem;color:var(--sealed);letter-spacing:0.5px;}

/* Wishlist */
.wish-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:8px;}
.wish-item{display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--surface);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all 0.15s;}
.wish-item:hover{border-color:var(--border2);}
.wi-img{width:36px;height:50px;object-fit:contain;border-radius:4px;background:var(--surface2);flex-shrink:0;}
.wi-info{flex:1;min-width:0;}
.wi-name{font-size:0.83rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px;}
.wi-set{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:0.3px;}
.wi-target{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);margin-top:3px;}
.wi-target span{color:var(--accent);}
.wi-price{text-align:right;flex-shrink:0;}
.wi-current{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;}
.wi-diff{font-family:var(--font-mono);font-size:0.62rem;margin-top:2px;}
.wi-alert{width:28px;height:28px;border-radius:50%;border:1px solid rgba(212,245,60,0.2);background:var(--accent-dim);display:flex;align-items:center;justify-content:center;font-size:0.7rem;flex-shrink:0;cursor:pointer;transition:all 0.15s;}
.wi-alert:hover{background:var(--accent);border-color:var(--accent);}
.wi-alert.active{background:var(--accent);border-color:var(--accent);}

/* Empty states */
.empty-state{padding:32px;text-align:center;border:1.5px dashed var(--border);border-radius:10px;cursor:pointer;transition:all 0.15s;}
.empty-state:hover{border-color:var(--border2);}
.es-icon{font-size:2rem;margin-bottom:10px;opacity:0.5;}
.es-title{font-family:var(--font-display);font-size:1rem;letter-spacing:1px;color:var(--text2);margin-bottom:4px;}
.es-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:0.3px;}

/* Add card modal */
.modal-overlay{position:fixed;inset:0;background:rgba(4,4,8,0.9);backdrop-filter:blur(16px);z-index:500;display:none;align-items:center;justify-content:center;padding:20px;}
.modal-overlay.open{display:flex;}
.modal{background:var(--surface);border:1px solid var(--border2);border-radius:12px;width:100%;max-width:480px;padding:28px;animation:mIn 0.2s ease;}
@keyframes mIn{from{opacity:0;transform:scale(0.96) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-title{font-family:var(--font-display);font-size:1.4rem;letter-spacing:1px;margin-bottom:4px;}
.modal-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:0.5px;margin-bottom:20px;}
.form-group{margin-bottom:14px;}
.fg-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;display:block;}
.fg-input{width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:10px 14px;color:var(--text);font-family:var(--font-mono);font-size:0.82rem;outline:none;transition:border-color 0.15s;letter-spacing:0.3px;}
.fg-input:focus{border-color:var(--accent);}
.fg-input::placeholder{color:var(--text3);}
.fg-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.search-results{max-height:200px;overflow-y:auto;margin-top:8px;display:flex;flex-direction:column;gap:4px;}
.sr-item{display:flex;align-items:center;gap:10px;padding:8px 10px;background:var(--bg2);border:1px solid var(--border);border-radius:6px;cursor:pointer;transition:all 0.12s;}
.sr-item:hover{border-color:var(--accent);}
.sr-thumb{width:28px;height:38px;object-fit:contain;border-radius:3px;}
.sr-name{font-size:0.8rem;font-weight:600;margin-bottom:1px;}
.sr-set{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);}
.sr-price{font-family:var(--font-display);font-size:0.9rem;color:var(--accent);margin-left:auto;flex-shrink:0;}
.modal-btns{display:flex;gap:8px;margin-top:20px;}
.btn-cancel{flex:1;padding:10px;border:1px solid var(--border);border-radius:6px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;cursor:pointer;text-transform:uppercase;letter-spacing:0.5px;transition:all 0.15s;}
.btn-cancel:hover{border-color:var(--border2);color:var(--text2);}
.btn-add{flex:2;padding:10px;border:none;border-radius:6px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:1px;transition:all 0.15s;}
.btn-add:hover{box-shadow:0 0 16px var(--accent-glow);}
.btn-add:disabled{opacity:0.4;cursor:not-allowed;box-shadow:none;}

@media(max-width:900px){
  nav{padding:0 18px;}
  .nav-pills{display:none;}
  .main{padding:20px 18px 60px;}
  .page-header{padding:24px 18px 20px;}
  .kpi-row{grid-template-columns:repeat(3,1fr);}
  .cards-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));}
}
</style>
</head>
<body>

<nav>
  <div class="logo" onclick="window.location.href='pple-tcg.html'">PPLE<span class="dot">.</span>TCG</div>
  <div class="nav-pills">
    <button class="nav-tab" onclick="window.location.href='pple-tcg.html'">Mercado</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-vender.html'">Vender</button>
    <button class="nav-tab active">Portfolio</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-mensajes.html'">Mensajes</button>
  </div>
  <div class="nav-right">
    <button class="btn-outline" onclick="openModal('raw')">+ A√±adir carta</button>
    <div class="nav-avatar">J</div>
  </div>
</nav>

<div class="page-header">
  <div class="ph-left">
    <div class="ph-eyebrow">Mi colecci√≥n ¬∑ Actualizado hoy</div>
    <div class="ph-title">PORTFOLIO</div>
    <div class="ph-user">@TrainerJuan ¬∑ Coleccionista desde 2021</div>
  </div>
  <div class="ph-right">
    <button class="btn-outline">Exportar CSV</button>
    <button class="btn-accent">+ A√±adir</button>
  </div>
</div>

<div class="main">

  <!-- KPI ROW -->
  <div class="kpi-row">
    <div class="kpi-card highlight">
      <div class="kc-label">Valor total</div>
      <div class="kc-val accent" id="totalValue">‚Ç¨0</div>
      <div class="kc-sub kc-up" id="totalChg">‚Äî</div>
    </div>
    <div class="kpi-card">
      <div class="kc-label">RAW</div>
      <div class="kc-val" id="rawValue">‚Ç¨0</div>
      <div class="kc-sub kc-flat" id="rawCount">0 cartas</div>
    </div>
    <div class="kpi-card">
      <div class="kc-label">Slabs PSA</div>
      <div class="kc-val" id="slabValue">‚Ç¨0</div>
      <div class="kc-sub kc-flat" id="slabCount">0 cartas</div>
    </div>
    <div class="kpi-card">
      <div class="kc-label">Sellado</div>
      <div class="kc-val" id="sealedValue">‚Ç¨0</div>
      <div class="kc-sub kc-flat" id="sealedCount">0 items</div>
    </div>
    <div class="kpi-card">
      <div class="kc-label">En venta</div>
      <div class="kc-val" id="forSaleVal">‚Ç¨0</div>
      <div class="kc-sub kc-flat" id="forSaleCount">0 anuncios</div>
    </div>
    <div class="kpi-card">
      <div class="kc-label">Coste total</div>
      <div class="kc-val" id="costVal">‚Ç¨0</div>
      <div class="kc-sub" id="pnlVal">‚Äî</div>
    </div>
  </div>

  <!-- CHART -->
  <div class="chart-section">
    <div class="cs-header">
      <div>
        <div class="cs-title">EVOLUCI√ìN DEL PORTFOLIO</div>
        <div class="cs-sub">Valor total estimado basado en precios de Cardmarket</div>
      </div>
      <div class="period-tabs">
        <button class="pt-btn" onclick="switchPeriod('1m',this)">1M</button>
        <button class="pt-btn active" onclick="switchPeriod('3m',this)">3M</button>
        <button class="pt-btn" onclick="switchPeriod('6m',this)">6M</button>
        <button class="pt-btn" onclick="switchPeriod('1y',this)">1A</button>
      </div>
    </div>
    <div class="chart-wrap">
      <svg class="portfolio-chart" id="portfolioChart" viewBox="0 0 1000 180"></svg>
      <div class="chart-tooltip" id="chartTooltip">
        <div class="ct-date" id="ttDate">‚Äî</div>
        <div class="ct-val" id="ttVal">‚Äî</div>
      </div>
    </div>
    <div class="chart-labels" id="chartLabels"></div>
  </div>

  <!-- RAW SECTION -->
  <div class="section">
    <div class="section-header">
      <div class="sh-left">
        <div class="sh-icon raw">üÉè</div>
        <div>
          <div class="sh-title">RAW</div>
          <div class="sh-count" id="rawSectionCount">0 cartas</div>
        </div>
      </div>
      <div class="sh-right">
        <div class="sh-value" id="rawSectionVal">‚Ç¨0</div>
        <button class="add-btn" onclick="openModal('raw')">+ A√±adir</button>
      </div>
    </div>
    <div class="cards-grid" id="rawGrid"></div>
  </div>

  <!-- PSA SECTION -->
  <div class="section">
    <div class="section-header">
      <div class="sh-left">
        <div class="sh-icon psa">üèÜ</div>
        <div>
          <div class="sh-title">SLABS PSA</div>
          <div class="sh-count" id="psaSectionCount">0 cartas</div>
        </div>
      </div>
      <div class="sh-right">
        <div class="sh-value" id="psaSectionVal">‚Ç¨0</div>
        <button class="add-btn" onclick="openModal('psa')">+ A√±adir</button>
      </div>
    </div>
    <div class="cards-grid" id="psaGrid"></div>
  </div>

  <!-- SEALED SECTION -->
  <div class="section">
    <div class="section-header">
      <div class="sh-left">
        <div class="sh-icon sealed">üì¶</div>
        <div>
          <div class="sh-title">PRODUCTO SELLADO</div>
          <div class="sh-count" id="sealedSectionCount">0 items</div>
        </div>
      </div>
      <div class="sh-right">
        <div class="sh-value" id="sealedSectionVal">‚Ç¨0</div>
        <button class="add-btn" onclick="openModal('sealed')">+ A√±adir</button>
      </div>
    </div>
    <div class="sealed-grid" id="sealedGrid"></div>
  </div>

  <!-- WISHLIST -->
  <div class="section">
    <div class="section-header">
      <div class="sh-left">
        <div class="sh-icon wish">‚ù§Ô∏è</div>
        <div>
          <div class="sh-title">WISHLIST</div>
          <div class="sh-count" id="wishCount">0 cartas buscadas</div>
        </div>
      </div>
      <div class="sh-right">
        <button class="add-btn" onclick="openModal('wish')">+ A√±adir</button>
      </div>
    </div>
    <div class="wish-grid" id="wishGrid"></div>
  </div>

</div>

<!-- ADD MODAL -->
<div class="modal-overlay" id="addModal" onclick="closeModalOverlay(event)">
  <div class="modal">
    <div class="modal-title" id="modalTitle">A√ëADIR CARTA</div>
    <div class="modal-sub" id="modalSub">Busca la carta en el cat√°logo</div>
    <div class="form-group">
      <label class="fg-label">Buscar carta</label>
      <input class="fg-input" type="text" id="modalSearch" placeholder="Nombre de la carta..." oninput="modalSearchCards(this.value)">
      <div class="search-results" id="modalResults"></div>
    </div>
    <div id="modalExtraFields" style="display:none">
      <div class="fg-row" id="modalCondRow">
        <div class="form-group">
          <label class="fg-label" id="modalCondLabel">Estado</label>
          <select class="fg-input" id="modalCond">
            <option value="NM">NM ‚Äî Near Mint</option>
            <option value="LP">LP ‚Äî Lightly Played</option>
            <option value="MP">MP ‚Äî Moderately Played</option>
          </select>
        </div>
        <div class="form-group">
          <label class="fg-label">Precio pagado (‚Ç¨)</label>
          <input class="fg-input" type="number" id="modalPaid" placeholder="0.00" step="0.01">
        </div>
      </div>
      <div class="form-group" id="modalSaleRow" style="display:none">
        <label class="fg-label">¬øPoner en venta?</label>
        <select class="fg-input" id="modalSale">
          <option value="no">No, solo en portfolio</option>
          <option value="yes">S√≠, publicar anuncio</option>
        </select>
      </div>
    </div>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="document.getElementById('addModal').classList.remove('open')">Cancelar</button>
      <button class="btn-add" id="btnModalAdd" onclick="addToPortfolio()" disabled>A√±adir al portfolio</button>
    </div>
  </div>
</div>

<script>
const BASE = 'https://api.tcgdex.net/v2/en';
let modalMode = 'raw';
let selectedModalCard = null;
let searchTimer = null;

// ---- PORTFOLIO DATA ----
const portfolio = {
  raw: [
    { id:'sv3-3',    name:'Charizard ex',    set:'Obsidian Flames',   img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',   cond:'NM', price:124.50, paid:89.00,  forSale:true  },
    { id:'sv2-83',   name:'Pikachu ex',      set:'Paldea Evolved',    img:'https://assets.tcgdex.net/univ/sv/sv02/83/high.png',  cond:'NM', price:84.20,  paid:60.00,  forSale:false },
    { id:'sv5-95',   name:'Umbreon ex',      set:'Temporal Forces',   img:'https://assets.tcgdex.net/univ/sv/sv05/95/high.png',  cond:'LP', price:67.30,  paid:55.00,  forSale:false },
    { id:'sv4-84',   name:'Gardevoir ex',    set:'Paradox Rift',      img:'https://assets.tcgdex.net/univ/sv/sv04/84/high.png',  cond:'NM', price:45.80,  paid:32.00,  forSale:false },
    { id:'sv6-210',  name:'Iron Valiant ex', set:'Twilight Masquerade',img:'https://assets.tcgdex.net/univ/sv/sv06/210/high.png',cond:'NM', price:38.20,  paid:28.00,  forSale:true  },
    { id:'sv1-198',  name:'Miraidon ex',     set:'Scarlet & Violet',  img:'https://assets.tcgdex.net/univ/sv/sv01/198/high.png', cond:'NM', price:52.40,  paid:44.00,  forSale:false },
  ],
  psa: [
    { id:'sv3pt5-11',name:'Mewtwo ex',       set:'151',               img:'https://assets.tcgdex.net/univ/sv/sv3pt5/11/high.png',grade:'PSA10',price:210.00,paid:145.00,forSale:false,cert:'45821937' },
    { id:'sv03-125', name:'Tyranitar ex',    set:'Obsidian Flames',   img:'https://assets.tcgdex.net/univ/sv/sv03/125/high.png', grade:'PSA9', price:89.00, paid:65.00, forSale:true, cert:'45821938' },
    { id:'sv02-201', name:'Sylveon ex',      set:'Paldea Evolved',    img:'https://assets.tcgdex.net/univ/sv/sv02/201/high.png', grade:'PSA9', price:55.00, paid:38.00, forSale:false,cert:'45821939' },
  ],
  sealed: [
    { name:'Booster Box Obsidian Flames',  set:'Obsidian Flames',  type:'Booster Box', price:185.00, paid:130.00, trend:'+42%', qty:1,   img:'üì¶' },
    { name:'Elite Trainer Box 151',        set:'Scarlet & Violet 151',type:'ETB',      price:89.00,  paid:65.00,  trend:'+37%', qty:2,   img:'üéÅ' },
    { name:'Booster Bundle Temporal Forces',set:'Temporal Forces', type:'Bundle',      price:38.00,  paid:28.00,  trend:'+36%', qty:3,   img:'üì¶' },
    { name:'Charizard ex Premium Collection',set:'Promos',         type:'Collection', price:62.00,  paid:49.99,  trend:'+24%', qty:1,   img:'‚≠ê' },
  ],
  wishlist: [
    { id:'sv06-191', name:'Pecharunt ex',    set:'Twilight Masquerade',img:'https://assets.tcgdex.net/univ/sv/sv06/191/high.png', price:28.70, target:24.00 },
    { id:'sv3pt5-205',name:'Mew ex',         set:'151',               img:'https://assets.tcgdex.net/univ/sv/sv3pt5/205/high.png',price:32.10, target:25.00 },
    { id:'sv05-176', name:'Terapagos ex',    set:'Temporal Forces',   img:'https://assets.tcgdex.net/univ/sv/sv05/176/high.png',  price:41.50, target:35.00 },
    { id:'sv04-197', name:'Walking Wake ex', set:'Paradox Rift',      img:'https://assets.tcgdex.net/univ/sv/sv04/197/high.png',  price:19.80, target:15.00 },
  ]
};

// ---- COMPUTE TOTALS ----
function computeTotals() {
  const rawVal   = portfolio.raw.reduce((s,c) => s+c.price, 0);
  const slabVal  = portfolio.psa.reduce((s,c) => s+c.price, 0);
  const sealVal  = portfolio.sealed.reduce((s,c) => s+c.price*c.qty, 0);
  const totalVal = rawVal + slabVal + sealVal;
  const totalCost= [...portfolio.raw,...portfolio.psa].reduce((s,c)=>s+c.paid,0)
                 + portfolio.sealed.reduce((s,c)=>s+c.paid*c.qty,0);
  const forSaleItems = [...portfolio.raw,...portfolio.psa].filter(c=>c.forSale);
  const forSaleVal = forSaleItems.reduce((s,c)=>s+c.price,0);
  const pnl = totalVal - totalCost;

  document.getElementById('totalValue').textContent  = fmt(totalVal);
  document.getElementById('totalChg').textContent    = `‚ñ≤ +${((pnl/totalCost)*100).toFixed(1)}% desde coste`;
  document.getElementById('rawValue').textContent    = fmt(rawVal);
  document.getElementById('rawCount').textContent    = `${portfolio.raw.length} cartas`;
  document.getElementById('slabValue').textContent   = fmt(slabVal);
  document.getElementById('slabCount').textContent   = `${portfolio.psa.length} slabs`;
  document.getElementById('sealedValue').textContent = fmt(sealVal);
  document.getElementById('sealedCount').textContent = `${portfolio.sealed.reduce((s,c)=>s+c.qty,0)} items`;
  document.getElementById('forSaleVal').textContent  = fmt(forSaleVal);
  document.getElementById('forSaleCount').textContent= `${forSaleItems.length} anuncios`;
  document.getElementById('costVal').textContent     = fmt(totalCost);
  const pnlEl = document.getElementById('pnlVal');
  pnlEl.textContent = `${pnl>=0?'‚ñ≤ +':'‚ñº '}${fmt(pnl)} P&L`;
  pnlEl.className = 'kc-sub ' + (pnl>=0?'kc-up':'kc-down');

  document.getElementById('rawSectionCount').textContent  = `${portfolio.raw.length} cartas`;
  document.getElementById('rawSectionVal').textContent    = fmt(rawVal);
  document.getElementById('psaSectionCount').textContent  = `${portfolio.psa.length} cartas`;
  document.getElementById('psaSectionVal').textContent    = fmt(slabVal);
  document.getElementById('sealedSectionCount').textContent = `${portfolio.sealed.reduce((s,c)=>s+c.qty,0)} items`;
  document.getElementById('sealedSectionVal').textContent   = fmt(sealVal);
  document.getElementById('wishCount').textContent = `${portfolio.wishlist.length} cartas buscadas`;

  return totalVal;
}

function fmt(v) { return `‚Ç¨${parseFloat(v).toFixed(2)}`; }

// ---- RENDER GRIDS ----
function renderGrids() {
  // RAW
  document.getElementById('rawGrid').innerHTML = portfolio.raw.length
    ? portfolio.raw.map(c => `
      <div class="pcard ${c.forSale?'for-sale':''}">
        <div class="pcard-img">
          <img src="${c.img}" alt="${c.name}" onerror="this.parentNode.innerHTML='üé¥'">
          <div class="cond-raw raw-${c.cond.toLowerCase()}">${c.cond}</div>
        </div>
        <div class="pcard-body">
          <div class="pc-name">${c.name}</div>
          <div class="pc-set">${c.set}</div>
          <div class="pc-footer">
            <div class="pc-price">${fmt(c.price)}</div>
            <div class="pc-chg ${c.price>c.paid?'chg-up':'chg-down'}">${c.price>c.paid?'‚ñ≤':'‚ñº'} ${Math.abs(((c.price-c.paid)/c.paid)*100).toFixed(0)}%</div>
          </div>
          <div class="pc-paid">Coste: ${fmt(c.paid)}</div>
        </div>
      </div>`).join('')
    : emptyState('A√±ade tu primera carta RAW','Escanea o busca manualmente','raw');

  // PSA
  document.getElementById('psaGrid').innerHTML = portfolio.psa.length
    ? portfolio.psa.map(c => {
        const gc = c.grade==='PSA10'?'grade-10':c.grade==='PSA9'?'grade-9':'grade-8';
        return `
      <div class="pcard is-slab ${c.forSale?'for-sale':''}">
        <div class="pcard-img">
          <img src="${c.img}" alt="${c.name}" onerror="this.parentNode.innerHTML='üèÜ'">
          <div class="pc-grade ${gc}">${c.grade.replace('PSA','PSA ')}</div>
        </div>
        <div class="pcard-body">
          <div class="pc-name">${c.name}</div>
          <div class="pc-set">${c.set} ¬∑ #${c.cert}</div>
          <div class="pc-footer">
            <div class="pc-price">${fmt(c.price)}</div>
            <div class="pc-chg ${c.price>c.paid?'chg-up':'chg-down'}">${c.price>c.paid?'‚ñ≤':'‚ñº'} ${Math.abs(((c.price-c.paid)/c.paid)*100).toFixed(0)}%</div>
          </div>
          <div class="pc-paid">Coste: ${fmt(c.paid)}</div>
        </div>
      </div>`}).join('')
    : emptyState('A√±ade tu primera slab PSA','Declara el grado y n√∫mero de certificado','psa');

  // SEALED
  document.getElementById('sealedGrid').innerHTML = portfolio.sealed.length
    ? portfolio.sealed.map(p => `
      <div class="sealed-card">
        <div class="sc-img"><span style="font-size:3rem">${p.img}</span></div>
        <div class="sc-body">
          <div class="sc-type"><span class="sealed-badge">üì¶ ${p.type}</span></div>
          <div class="sc-name">${p.name}</div>
          <div class="sc-set">${p.set}</div>
          <div class="sc-footer">
            <div class="sc-price">${fmt(p.price*p.qty)}</div>
            <div class="sc-trend chg-up">‚ñ≤ ${p.trend}</div>
          </div>
          <div class="sc-qty">x${p.qty} ¬∑ Coste: ${fmt(p.paid*p.qty)}</div>
        </div>
      </div>`).join('')
    : emptyState('A√±ade producto sellado','Displays, ETBs, Booster Boxes...','sealed');

  // WISHLIST
  document.getElementById('wishGrid').innerHTML = portfolio.wishlist.length
    ? portfolio.wishlist.map(w => {
        const diff = w.price - w.target;
        const isClose = diff <= w.target * 0.1;
        return `
      <div class="wish-item">
        <img class="wi-img" src="${w.img}" onerror="this.style.display='none'" alt="">
        <div class="wi-info">
          <div class="wi-name">${w.name}</div>
          <div class="wi-set">${w.set}</div>
          <div class="wi-target">Objetivo: <span>${fmt(w.target)}</span></div>
        </div>
        <div class="wi-price">
          <div class="wi-current">${fmt(w.price)}</div>
          <div class="wi-diff ${isClose?'chg-up':'chg-down'}">${isClose?'‚úì Cerca!':'‚ñ≤ '+fmt(diff)+' lejos'}</div>
        </div>
        <div class="wi-alert active" title="Alerta de precio activada">üîî</div>
      </div>`}).join('')
    : emptyState('Tu wishlist est√° vac√≠a','A√±ade cartas que est√©s buscando a buen precio','wish');
}

function emptyState(title, sub, mode) {
  return `<div class="empty-state" onclick="openModal('${mode}')">
    <div class="es-icon">+</div>
    <div class="es-title">${title}</div>
    <div class="es-sub">${sub}</div>
  </div>`;
}

// ---- CHART ----
const PERIODS = {
  '1m': { points:30, label:'√öltimo mes',   labels:['1 Feb','8 Feb','15 Feb','22 Feb','Hoy'] },
  '3m': { points:90, label:'3 meses',      labels:['Nov','Dic','Ene','Feb','Hoy'] },
  '6m': { points:180,label:'6 meses',      labels:['Ago','Sep','Oct','Nov','Dic','Hoy'] },
  '1y': { points:365,label:'Este a√±o',     labels:['Mar','May','Jul','Sep','Nov','Hoy'] },
};
let currentPeriod = '3m';

function buildChartData(period, endVal) {
  const n = PERIODS[period].points;
  const points = [];
  // Start lower, trend upward with some noise
  const startVal = endVal * (period==='1m'?0.88:period==='3m'?0.72:period==='6m'?0.58:0.42);
  for (let i=0;i<n;i++) {
    const t = i/(n-1);
    const trend = startVal + (endVal-startVal)*Math.pow(t,0.8);
    const noise = trend*(0.97+Math.random()*0.06);
    points.push(i===n-1?endVal:noise);
  }
  return points;
}

function drawPortfolioChart(period, totalVal) {
  const svg = document.getElementById('portfolioChart');
  const W=1000, H=180, padX=8, padY=16;
  const points = buildChartData(period, totalVal);
  const mn=Math.min(...points)*0.97, mx=Math.max(...points)*1.03;
  const range=mx-mn||1;
  const x = i => padX + (i/(points.length-1))*(W-padX*2);
  const y = v => H-padY-((v-mn)/range)*(H-padY*2);
  const trend = points[points.length-1]-points[0];
  const col = trend>=0?'var(--nm)':'var(--mp)';
  const line = points.map((p,i)=>`${i===0?'M':'L'}${x(i).toFixed(1)},${y(p).toFixed(1)}`).join(' ');
  const area = line+` L${x(points.length-1).toFixed(1)},${H} L${x(0).toFixed(1)},${H} Z`;
  // Grid lines
  let grid='';
  for(let i=0;i<4;i++){
    const yg=(padY + i*(H-padY*2)/3).toFixed(1);
    const val=(mn+range*(1-i/3)).toFixed(0);
    grid+=`<line x1="${padX}" y1="${yg}" x2="${W-padX}" y2="${yg}" stroke="rgba(255,255,255,0.04)" stroke-width="1"/>`;
    grid+=`<text x="${padX+4}" y="${parseFloat(yg)-4}" font-family="DM Mono" font-size="11" fill="rgba(255,255,255,0.2)">‚Ç¨${val}</text>`;
  }
  svg.innerHTML=`<defs>
    <linearGradient id="cg" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="${col}" stop-opacity="0.18"/>
      <stop offset="100%" stop-color="${col}" stop-opacity="0.01"/>
    </linearGradient>
  </defs>
  ${grid}
  <path d="${area}" fill="url(#cg)"/>
  <path d="${line}" stroke="${col}" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
  <circle cx="${x(points.length-1).toFixed(1)}" cy="${y(points[points.length-1]).toFixed(1)}" r="5" fill="${col}" stroke="var(--bg2)" stroke-width="2.5"/>`;

  document.getElementById('chartLabels').innerHTML =
    PERIODS[period].labels.map(l=>`<span class="chart-lbl">${l}</span>`).join('');
}

function switchPeriod(p, btn) {
  currentPeriod=p;
  document.querySelectorAll('.pt-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const total=computeTotals();
  drawPortfolioChart(p, total);
}

// ---- MODAL ----
function openModal(mode) {
  modalMode=mode; selectedModalCard=null;
  document.getElementById('addModal').classList.add('open');
  document.getElementById('modalSearch').value='';
  document.getElementById('modalResults').innerHTML='';
  document.getElementById('modalExtraFields').style.display='none';
  document.getElementById('btnModalAdd').disabled=true;

  const titles={raw:'A√ëADIR CARTA RAW',psa:'A√ëADIR SLAB PSA',sealed:'A√ëADIR PRODUCTO SELLADO',wish:'A√ëADIR A WISHLIST'};
  const subs={raw:'Busca en el cat√°logo y declara el estado',psa:'Busca la carta y a√±ade el grado PSA',sealed:'A√±ade un producto sellado a tu colecci√≥n',wish:'Cartas que quieres comprar a un precio objetivo'};
  document.getElementById('modalTitle').textContent=titles[mode]||'A√ëADIR';
  document.getElementById('modalSub').textContent=subs[mode]||'';

  // Adapt fields for PSA
  if(mode==='psa') {
    document.getElementById('modalCondLabel').textContent='Grado PSA';
    document.getElementById('modalCond').innerHTML=`<option value="PSA10">PSA 10</option><option value="PSA9">PSA 9</option><option value="PSA8">PSA 8</option>`;
  } else {
    document.getElementById('modalCondLabel').textContent='Estado';
    document.getElementById('modalCond').innerHTML=`<option value="NM">NM ‚Äî Near Mint</option><option value="LP">LP ‚Äî Lightly Played</option><option value="MP">MP ‚Äî Moderately Played</option>`;
  }
}

function closeModalOverlay(e) {
  if(e.target===document.getElementById('addModal'))
    document.getElementById('addModal').classList.remove('open');
}

let mTimer=null;
async function modalSearchCards(q) {
  clearTimeout(mTimer);
  if(q.length<2){document.getElementById('modalResults').innerHTML='';return;}
  mTimer=setTimeout(async()=>{
    try {
      const r=await fetch(`${BASE}/cards?name=${encodeURIComponent(q)}`);
      const cards=await r.json();
      if(!Array.isArray(cards)||!cards.length){
        document.getElementById('modalResults').innerHTML='<div style="padding:8px;font-family:var(--font-mono);font-size:0.7rem;color:var(--text3)">Sin resultados</div>';
        return;
      }
      document.getElementById('modalResults').innerHTML=cards.slice(0,6).map(c=>`
        <div class="sr-item" onclick="selectModalCard(${JSON.stringify(c).replace(/"/g,'&quot;')})">
          <img class="sr-thumb" src="${c.image?c.image+'/low.png':''}" onerror="this.style.display='none'">
          <div>
            <div class="sr-name">${c.name}</div>
            <div class="sr-set">${c.set?.name||'‚Äî'} ¬∑ #${c.localId}</div>
          </div>
          <div class="sr-price" id="mp-${c.id}">‚Äî</div>
        </div>`).join('');
      cards.slice(0,6).forEach(async c=>{
        try{
          const dr=await fetch(`${BASE}/cards/${c.id}`);
          const d=await dr.json();
          const p=d.pricing?.cardmarket?.trend;
          const el=document.getElementById(`mp-${c.id}`);
          if(el)el.textContent=p?`‚Ç¨${parseFloat(p).toFixed(2)}`:'‚Äî';
        }catch(e){}
      });
    } catch(e){}
  },350);
}

function selectModalCard(card) {
  selectedModalCard=card;
  document.getElementById('modalSearch').value=card.name;
  document.getElementById('modalResults').innerHTML=`
    <div style="display:flex;align-items:center;gap:10px;padding:8px 10px;background:var(--accent-dim);border:1px solid rgba(212,245,60,0.2);border-radius:6px;">
      <img class="sr-thumb" src="${card.image?card.image+'/low.png':''}" onerror="this.style.display='none'">
      <div style="flex:1"><div class="sr-name">${card.name}</div><div class="sr-set">${card.set?.name||'‚Äî'} ¬∑ #${card.localId}</div></div>
      <div style="color:var(--nm);font-family:var(--font-mono);font-size:0.7rem">‚úì Seleccionada</div>
    </div>`;
  document.getElementById('modalExtraFields').style.display='block';
  document.getElementById('btnModalAdd').disabled=false;
}

function addToPortfolio() {
  if(!selectedModalCard)return;
  const cond=document.getElementById('modalCond').value;
  const paid=parseFloat(document.getElementById('modalPaid').value)||0;
  const entry={
    id:selectedModalCard.id, name:selectedModalCard.name,
    set:selectedModalCard.set?.name||'‚Äî',
    img:selectedModalCard.image?selectedModalCard.image+'/high.png':null,
    price:paid||20, paid:paid, forSale:false
  };
  if(modalMode==='raw'){entry.cond=cond;portfolio.raw.push(entry);}
  else if(modalMode==='psa'){entry.grade=cond;entry.cert='‚Äî';portfolio.psa.push(entry);}
  else if(modalMode==='wish'){entry.target=paid;portfolio.wishlist.push(entry);}
  document.getElementById('addModal').classList.remove('open');
  const total=computeTotals();
  renderGrids();
  drawPortfolioChart(currentPeriod,total);
}

// ---- INIT ----
const total=computeTotals();
renderGrids();
drawPortfolioChart(currentPeriod,total);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg ¬∑ Seguimiento</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#08080d; --bg2:#0e0e16; --surface:#11111c; --surface2:#181825;
  --border:#22223a; --border2:#2d2d4a;
  --accent:#d4f53c; --accent-glow:rgba(212,245,60,0.15); --accent-dim:rgba(212,245,60,0.06);
  --text:#eeeef8; --text2:#9898b8; --text3:#55556a;
  --nm:#2ed573; --lp:#ffa502; --mp:#ff4757;
  --font-display:'Bebas Neue',sans-serif;
  --font-mono:'DM Mono',monospace;
  --font-body:'Plus Jakarta Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay;}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* NAV */
nav{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:60px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(8,8,13,0.96);backdrop-filter:blur(24px);z-index:100;}
.logo{font-family:var(--font-display);font-size:1.8rem;letter-spacing:3px;cursor:pointer;}
.logo .dot{color:var(--accent);}
.nav-pills{display:flex;gap:0;border:1px solid var(--border);border-radius:6px;overflow:hidden;}
.nav-tab{padding:7px 22px;font-family:var(--font-mono);font-size:0.72rem;font-weight:500;letter-spacing:1px;text-transform:uppercase;color:var(--text2);cursor:pointer;border:none;background:none;border-right:1px solid var(--border);transition:all 0.15s;}
.nav-tab:last-child{border-right:none;}
.nav-tab:hover{background:var(--surface);color:var(--text);}
.nav-tab.active{background:var(--accent);color:#08080d;font-weight:700;}
.nav-right{display:flex;gap:10px;align-items:center;}
.nav-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#3d2a6e,#d4f53c);display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;color:#08080d;cursor:pointer;}

/* PAGE HEADER */
.page-header{padding:28px 40px 24px;border-bottom:1px solid var(--border);background:var(--bg2);display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;}
.ph-eyebrow{font-family:var(--font-mono);font-size:0.62rem;color:var(--accent);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;}
.ph-title{font-family:var(--font-display);font-size:2.2rem;letter-spacing:2px;}




.tracking-input::placeholder{color:var(--text3);}

.tracking-btn:hover{box-shadow:inset 0 0 12px rgba(0,0,0,0.1);}

/* MAIN LAYOUT */
.main{max-width:1300px;margin:0 auto;padding:28px 40px 80px;display:grid;grid-template-columns:1fr 380px;gap:24px;}

/* LEFT */
.left-col{}

/* Status hero card */
.status-hero{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;margin-bottom:20px;position:relative;overflow:hidden;}
.sh-glow{position:absolute;top:-60px;right:-60px;width:250px;height:250px;border-radius:50%;background:radial-gradient(circle,rgba(212,245,60,0.08) 0%,transparent 70%);pointer-events:none;}
.sh-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:20px;gap:16px;flex-wrap:wrap;}
.sh-left{}
.sh-status-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;}
.sh-status{font-family:var(--font-display);font-size:2.2rem;letter-spacing:1px;display:flex;align-items:center;gap:12px;}
.status-dot{width:12px;height:12px;border-radius:50%;flex-shrink:0;}
.dot-transit{background:var(--lp);box-shadow:0 0 10px rgba(255,165,2,0.4);animation:pulse-dot 2s infinite;}
.dot-delivered{background:var(--nm);box-shadow:0 0 10px rgba(46,213,115,0.4);}
.dot-pending{background:var(--text3);}
@keyframes pulse-dot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.6;transform:scale(1.2)}}
.sh-eta{text-align:right;}
.sh-eta-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:4px;}
.sh-eta-val{font-family:var(--font-display);font-size:1.6rem;letter-spacing:1px;color:var(--accent);}
.sh-eta-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);}

/* Route bar */
.route-bar{display:flex;align-items:center;gap:0;background:var(--bg2);border:1px solid var(--border);border-radius:10px;overflow:hidden;}
.rb-point{flex:1;padding:14px 16px;}
.rb-point.origin{border-right:1px solid var(--border);}
.rb-point.dest{border-left:1px solid var(--border);}
.rb-point.mid{flex:0 0 auto;padding:14px 20px;display:flex;flex-direction:column;align-items:center;}
.rbp-label{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:4px;}
.rbp-city{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;}
.rbp-addr{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);margin-top:2px;letter-spacing:0.3px;}
.rb-arrow{font-size:1.2rem;color:var(--text3);}
.rb-progress{width:120px;height:4px;background:var(--border);border-radius:2px;margin-top:6px;overflow:hidden;}
.rbp-fill{height:100%;background:var(--accent);border-radius:2px;transition:width 0.5s ease;}

/* MAP */
.map-section{background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:20px;}
.map-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.map-title{font-family:var(--font-display);font-size:1rem;letter-spacing:1px;}
.map-carrier{display:flex;align-items:center;gap:8px;font-family:var(--font-mono);font-size:0.68rem;color:var(--text3);}
.carrier-logo{width:24px;height:24px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:700;color:#fff;}
.map-canvas{width:100%;height:280px;background:linear-gradient(135deg,#0a0a14 0%,#0e0e1e 50%,#0a0a14 100%);position:relative;overflow:hidden;}
/* Spain SVG map */
.map-canvas svg{width:100%;height:100%;}
.map-pin{position:absolute;transform:translate(-50%,-100%);display:flex;flex-direction:column;align-items:center;cursor:pointer;}
.pin-dot{width:14px;height:14px;border-radius:50%;border:2px solid var(--bg);position:relative;}
.pin-dot.origin{background:var(--text3);}
.pin-dot.current{background:var(--lp);box-shadow:0 0 12px rgba(255,165,2,0.6);animation:pulse-dot 1.5s infinite;}
.pin-dot.dest{background:var(--nm);}
.pin-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text);background:rgba(8,8,13,0.9);border:1px solid var(--border2);border-radius:4px;padding:2px 7px;margin-top:4px;white-space:nowrap;letter-spacing:0.3px;}
.route-line{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;}

/* TIMELINE */
.timeline-section{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;}
.tl-title{font-family:var(--font-display);font-size:1rem;letter-spacing:1px;margin-bottom:20px;}
.timeline{display:flex;flex-direction:column;gap:0;}
.tl-item{display:flex;gap:16px;position:relative;}
.tl-item:not(:last-child) .tl-line{position:absolute;left:15px;top:32px;bottom:-8px;width:2px;background:var(--border);}
.tl-item.done:not(:last-child) .tl-line{background:var(--accent);}
.tl-item.current:not(:last-child) .tl-line{background:linear-gradient(to bottom,var(--accent),var(--border));}
.tl-icon-wrap{flex-shrink:0;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.85rem;border:2px solid;position:relative;z-index:1;margin-bottom:20px;}
.tl-icon-wrap.done{background:var(--accent);border-color:var(--accent);}
.tl-icon-wrap.current{background:rgba(255,165,2,0.15);border-color:var(--lp);box-shadow:0 0 12px rgba(255,165,2,0.3);}
.tl-icon-wrap.pending{background:var(--surface2);border-color:var(--border2);}
.tl-content{flex:1;padding-bottom:20px;}
.tl-item:last-child .tl-content{padding-bottom:0;}
.tl-event{font-size:0.85rem;font-weight:600;margin-bottom:3px;}
.tl-item.pending .tl-event{color:var(--text3);}
.tl-item.current .tl-event{color:var(--lp);}
.tl-detail{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:0.3px;margin-bottom:2px;}
.tl-time{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);letter-spacing:0.3px;}

/* RIGHT SIDEBAR */
.right-col{}
.sidebar-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;}
.sc-title{font-family:var(--font-display);font-size:1rem;letter-spacing:1px;margin-bottom:14px;}

/* Package info */
.pkg-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);}
.pkg-row:last-child{border-bottom:none;}
.pkg-label{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:0.5px;}
.pkg-val{font-family:var(--font-mono);font-size:0.72rem;font-weight:500;}
.pkg-val.accent{color:var(--accent);}
.pkg-val.green{color:var(--nm);}




/* Card preview */
.card-preview{display:flex;align-items:center;gap:12px;padding:12px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;}
.cp-img{width:40px;height:55px;object-fit:contain;border-radius:4px;background:var(--surface2);}
.cp-info{}
.cp-name{font-size:0.85rem;font-weight:600;margin-bottom:2px;}
.cp-set{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);}
.cp-price{font-family:var(--font-display);font-size:1rem;color:var(--accent);margin-top:4px;letter-spacing:0.5px;}
.cp-cond{font-family:var(--font-mono);font-size:0.6rem;padding:1px 6px;background:rgba(46,213,115,0.1);border:1px solid rgba(46,213,115,0.2);color:var(--nm);border-radius:3px;display:inline-block;margin-top:3px;}

/* Parties */
.party-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);}
.party-row:last-child{border-bottom:none;}
.party-av{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;color:#08080d;flex-shrink:0;}
.party-info{flex:1;}
.party-role{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:1px;}
.party-name{font-size:0.82rem;font-weight:600;}
.party-rating{font-family:var(--font-mono);font-size:0.65rem;color:var(--accent);}

/* Actions */
.action-btn{width:100%;padding:10px;border-radius:6px;font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;margin-bottom:8px;display:flex;align-items:center;justify-content:center;gap:8px;}
.action-btn:last-child{margin-bottom:0;}
.ab-primary{border:none;background:var(--accent);color:#08080d;}
.ab-primary:hover{box-shadow:0 0 16px var(--accent-glow);}
.ab-secondary{border:1px solid var(--border2);background:none;color:var(--text2);}
.ab-secondary:hover{border-color:var(--accent);color:var(--accent);}
.ab-danger{border:1px solid rgba(255,71,87,0.2);background:none;color:var(--mp);}
.ab-danger:hover{background:rgba(255,71,87,0.07);}

/* Other shipments list */
.shipments-list{display:flex;flex-direction:column;gap:8px;}
.shipment-item{display:flex;align-items:center;gap:12px;padding:10px 12px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all 0.15s;}
.shipment-item:hover{border-color:var(--border2);}
.shipment-item.active{border-color:rgba(212,245,60,0.3);background:var(--accent-dim);}
.si-thumb{width:30px;height:40px;object-fit:contain;border-radius:3px;background:var(--surface);flex-shrink:0;}
.si-info{flex:1;min-width:0;}
.si-name{font-size:0.78rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px;}
.si-meta{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);}
.si-status{font-family:var(--font-mono);font-size:0.6rem;padding:2px 7px;border-radius:3px;flex-shrink:0;}
.sis-transit{background:rgba(255,165,2,0.1);color:var(--lp);}
.sis-delivered{background:rgba(46,213,115,0.1);color:var(--nm);}
.sis-pending{background:var(--surface2);color:var(--text3);}

/* Confirm delivery modal */
.modal-overlay{position:fixed;inset:0;background:rgba(4,4,8,0.9);backdrop-filter:blur(16px);z-index:500;display:none;align-items:center;justify-content:center;padding:20px;}
.modal-overlay.open{display:flex;}
.modal{background:var(--surface);border:1px solid var(--border2);border-radius:14px;width:100%;max-width:440px;padding:28px;animation:mIn 0.2s ease;}
@keyframes mIn{from{opacity:0;transform:scale(0.96)}to{opacity:1;transform:scale(1)}}
.modal-icon{font-size:3rem;margin-bottom:12px;text-align:center;}
.modal-title{font-family:var(--font-display);font-size:1.6rem;letter-spacing:1px;margin-bottom:6px;text-align:center;}
.modal-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);text-align:center;line-height:1.6;letter-spacing:0.3px;margin-bottom:20px;}
.modal-btns{display:flex;gap:8px;}
.btn-cancel{flex:1;padding:11px;border:1px solid var(--border);border-radius:6px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;cursor:pointer;text-transform:uppercase;letter-spacing:0.5px;transition:all 0.15s;}
.btn-cancel:hover{border-color:var(--border2);color:var(--text2);}
.btn-confirm{flex:2;padding:11px;border:none;border-radius:6px;background:var(--nm);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:1px;transition:all 0.15s;}
.btn-confirm:hover{box-shadow:0 0 16px rgba(46,213,115,0.3);}

@media(max-width:960px){
  nav{padding:0 18px;}
  .nav-pills{display:none;}
  .page-header{padding:20px 18px 18px;flex-direction:column;align-items:flex-start;}
  
  .main{grid-template-columns:1fr;padding:20px 18px 60px;}
  .right-col{order:-1;}
  .map-canvas{height:220px;}
}
</style>
</head>
<body>

<nav>
  <div class="logo" onclick="window.location.href='pple-tcg.html'">PPLE<span class="dot">.</span>TCG</div>
  <div class="nav-pills">
    <button class="nav-tab" onclick="window.location.href='pple-tcg.html'">Mercado</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-vender.html'">Vender</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-verificacion.html'">Verificaci√≥n</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-portfolio.html'">Portfolio</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-mensajes.html'">Mensajes</button>
  </div>
  <div class="nav-right">
    <div class="nav-avatar">J</div>
  </div>
</nav>

<!-- PAGE HEADER -->
<div class="page-header">
  <div>
    <div class="ph-eyebrow">Mis env√≠os ¬∑ 3 activos</div>
    <div class="ph-title">SEGUIMIENTO</div>
  </div>

</div>

<div class="main">
  <div class="left-col">

    <!-- STATUS HERO -->
    <div class="status-hero">
      <div class="sh-glow"></div>
      <div class="sh-top">
        <div class="sh-left">
          <div class="sh-status-label">Estado actual</div>
          <div class="sh-status">
            <div class="status-dot dot-transit"></div>
            EN TR√ÅNSITO
          </div>
          <div style="font-family:var(--font-mono);font-size:0.68rem;color:var(--text3);margin-top:6px;letter-spacing:0.3px;">
            Centro log√≠stico Madrid ¬∑ Actualizado hace 2h
          </div>
        </div>
        <div class="sh-eta">
          <div class="sh-eta-label">Entrega estimada</div>
          <div class="sh-eta-val">Ma√±ana</div>
          <div class="sh-eta-sub">28 Feb ¬∑ 9:00‚Äì14:00h</div>
        </div>
      </div>
      <div class="route-bar">
        <div class="rb-point origin">
          <div class="rbp-label">Origen</div>
          <div class="rbp-city">Madrid</div>
          <div class="rbp-addr">@TrainerRed99</div>
        </div>
        <div class="rb-point mid">
          <div class="rb-arrow">‚Üí</div>
          <div class="rb-progress" style="margin-top:6px"><div class="rbp-fill" style="width:65%"></div></div>
          <div style="font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-top:4px;">65%</div>
        </div>
        <div class="rb-point dest">
          <div class="rbp-label">Destino</div>
          <div class="rbp-city">Barcelona</div>
          <div class="rbp-addr">@TrainerJuan</div>
        </div>
      </div>
    </div>

    <!-- MAP -->
    <div class="map-section">
      <div class="map-header">
        <div class="map-title">UBICACI√ìN DEL PAQUETE</div>
        <div class="map-carrier">
          <div class="carrier-logo" style="background:#e60000;">C</div>
          Correos Express ¬∑ ES123456789ES
        </div>
      </div>
      <div class="map-canvas" id="mapCanvas">
        <!-- Spain map SVG -->
        <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg" id="spainMap"></svg>
        <!-- Route line canvas -->
        <canvas class="route-line" id="routeCanvas" width="800" height="600"></canvas>
        <!-- Pins -->
        <div class="map-pin" style="left:48%;top:55%">
          <div class="pin-dot origin"></div>
          <div class="pin-label">Madrid ¬∑ Origen</div>
        </div>
        <div class="map-pin" style="left:52%;top:44%" id="currentPin">
          <div class="pin-dot current"></div>
          <div class="pin-label">üì¶ Aqu√≠ ahora</div>
        </div>
        <div class="map-pin" style="left:70%;top:32%">
          <div class="pin-dot dest"></div>
          <div class="pin-label">Barcelona ¬∑ Destino</div>
        </div>
      </div>
    </div>

    <!-- TIMELINE -->
    <div class="timeline-section">
      <div class="tl-title">HISTORIAL DE EVENTOS</div>
      <div class="timeline" id="timeline"></div>
    </div>

  </div>

  <!-- RIGHT -->
  <div class="right-col">

    <!-- Card info -->
    <div class="sidebar-card">
      <div class="sc-title">ART√çCULO</div>
      <div class="card-preview">
        <img class="cp-img" src="https://assets.tcgdex.net/univ/sv/sv03/3/high.png" onerror="this.style.background='var(--surface2)'" alt="">
        <div class="cp-info">
          <div class="cp-name">Charizard ex</div>
          <div class="cp-set">Obsidian Flames ¬∑ #003</div>
          <div class="cp-price">‚Ç¨124.50</div>
          <div class="cp-cond">NM</div>
        </div>
      </div>
    </div>

    <!-- Package details -->
    <div class="sidebar-card">
      <div class="sc-title">DATOS DEL ENV√çO</div>
      <div class="pkg-row">
        <span class="pkg-label">Transportista</span>
        <span class="pkg-val">Correos Express</span>
      </div>

      <div class="pkg-row">
        <span class="pkg-label">Servicio</span>
        <span class="pkg-val">24h Certificado</span>
      </div>
      <div class="pkg-row">
        <span class="pkg-label">Enviado</span>
        <span class="pkg-val">26 Feb 2026</span>
      </div>
      <div class="pkg-row">
        <span class="pkg-label">Entrega estimada</span>
        <span class="pkg-val accent">28 Feb 2026</span>
      </div>
      <div class="pkg-row">
        <span class="pkg-label">Estado</span>
        <span class="pkg-val green">En tr√°nsito</span>
      </div>
    </div>

    <!-- Parties -->
    <div class="sidebar-card">
      <div class="sc-title">PARTES</div>
      <div class="party-row">
        <div class="party-av" style="background:linear-gradient(135deg,#1a1a2e,#e94560)">T</div>
        <div class="party-info">
          <div class="party-role">Vendedor</div>
          <div class="party-name">@TrainerRed99</div>
          <div class="party-rating">‚òÖ 4.9</div>
        </div>
        <button style="padding:5px 10px;border:1px solid var(--border2);border-radius:5px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.62rem;cursor:pointer;transition:all 0.15s;" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)'" onmouseout="this.style.borderColor='var(--border2)';this.style.color='var(--text3)'" onclick="window.location.href='pple-tcg-mensajes.html'">üí¨</button>
      </div>
      <div class="party-row">
        <div class="party-av" style="background:linear-gradient(135deg,#3d2a6e,#d4f53c)">J</div>
        <div class="party-info">
          <div class="party-role">Comprador (t√∫)</div>
          <div class="party-name">@TrainerJuan</div>
          <div class="party-rating">Barcelona, Espa√±a</div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="sidebar-card">
      <div class="sc-title">ACCIONES</div>
      <button class="action-btn ab-primary" onclick="openConfirmModal()">‚úì Confirmar recepci√≥n</button>
      <div style="padding:10px 12px;background:var(--accent-dim);border:1px solid rgba(212,245,60,0.15);border-radius:6px;font-family:var(--font-mono);font-size:0.65rem;color:var(--text2);line-height:1.6;letter-spacing:0.3px;">üìß El n√∫mero de seguimiento te fue enviado por email al confirmar la compra</div>
      <button class="action-btn ab-secondary" onclick="window.location.href='pple-tcg-mensajes.html'">üí¨ Contactar al vendedor</button>
      <button class="action-btn ab-danger">‚öë Reportar problema</button>
    </div>

    <!-- Other shipments -->
    <div class="sidebar-card">
      <div class="sc-title">MIS ENV√çOS</div>
      <div class="shipments-list" id="shipmentsList"></div>
    </div>

  </div>
</div>

<!-- CONFIRM DELIVERY MODAL -->
<div class="modal-overlay" id="confirmModal" onclick="closeModal(event)">
  <div class="modal">
    <div class="modal-icon">üì¶</div>
    <div class="modal-title">¬øHAS RECIBIDO EL PAQUETE?</div>
    <div class="modal-sub">Al confirmar la recepci√≥n, los fondos se liberar√°n al vendedor y podr√°s dejar una valoraci√≥n. Esta acci√≥n no se puede deshacer.</div>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="document.getElementById('confirmModal').classList.remove('open')">Cancelar</button>
      <button class="btn-confirm" onclick="confirmDelivery()">‚úì S√≠, lo he recibido</button>
    </div>
  </div>
</div>

<script>
// ---- TIMELINE DATA ----
const EVENTS = [
  { status:'done',    icon:'‚úì', event:'Enviado',       detail:'El vendedor ha entregado el paquete al transportista',  time:'26 Feb ¬∑ 09:22h' },
  { status:'current', icon:'‚Üí', event:'En tr√°nsito',   detail:'Correos Express ¬∑ En camino hacia Barcelona',           time:'27 Feb ¬∑ 06:40h' },
  { status:'pending', icon:'‚óã', event:'Entregado',     detail:'Confirma la recepci√≥n cuando llegue',                   time:'Estimado: 28 Feb' },
];

const SHIPMENTS = [
  { name:'Charizard ex',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',    status:'transit',   statusLabel:'En tr√°nsito', role:'Comprando', tracking:'ES123456789ES' },
  { name:'Pikachu ex',      img:'https://assets.tcgdex.net/univ/sv/sv02/83/high.png',   status:'delivered', statusLabel:'Entregado',   role:'Comprando', tracking:'ES987654321ES' },
  { name:'Mewtwo ex PSA 10',img:'https://assets.tcgdex.net/univ/sv/sv3pt5/11/high.png', status:'pending',   statusLabel:'Pendiente',   role:'Vendiendo', tracking:'‚Äî' },
];

// ---- RENDER TIMELINE ----
function renderTimeline() {
  document.getElementById('timeline').innerHTML = EVENTS.map((e, i) => `
    <div class="tl-item ${e.status}">
      <div class="tl-line"></div>
      <div class="tl-icon-wrap ${e.status}">${e.icon}</div>
      <div class="tl-content">
        <div class="tl-event">${e.event}</div>
        <div class="tl-detail">${e.detail}</div>
        <div class="tl-time">${e.time}</div>
      </div>
    </div>`).join('');
}

// ---- RENDER OTHER SHIPMENTS ----
function renderShipments() {
  document.getElementById('shipmentsList').innerHTML = SHIPMENTS.map((s, i) => `
    <div class="shipment-item ${i===0?'active':''}" onclick="selectShipment(${i})">
      <img class="si-thumb" src="${s.img}" onerror="this.style.display='none'" alt="">
      <div class="si-info">
        <div class="si-name">${s.name}</div>
        <div class="si-meta">${s.role} ¬∑ ${s.tracking}</div>
      </div>
      <div class="si-status sis-${s.status}">${s.statusLabel}</div>
    </div>`).join('');
}

function selectShipment(i) {
  document.querySelectorAll('.shipment-item').forEach((el, idx) => {
    el.classList.toggle('active', idx === i);
  });
}

// ---- MAP ----
function drawMap() {
  const canvas = document.getElementById('spainMap');
  // Simple Spain outline as SVG path
  canvas.innerHTML = `
    <defs>
      <radialGradient id="mapGlow" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#1a1a30" stop-opacity="1"/>
        <stop offset="100%" stop-color="#08080d" stop-opacity="1"/>
      </radialGradient>
      <filter id="blur">
        <feGaussianBlur stdDeviation="1"/>
      </filter>
    </defs>
    <rect width="800" height="600" fill="url(#mapGlow)"/>
    <!-- Grid lines -->
    ${Array.from({length:8},(_,i)=>`<line x1="${i*100+50}" y1="0" x2="${i*100+50}" y2="600" stroke="rgba(255,255,255,0.03)" stroke-width="1"/>`).join('')}
    ${Array.from({length:6},(_,i)=>`<line x1="0" y1="${i*100+50}" x2="800" y2="${i*100+50}" stroke="rgba(255,255,255,0.03)" stroke-width="1"/>`).join('')}
    <!-- Spain outline (simplified) -->
    <path d="M 120,200 L 100,240 L 80,280 L 90,320 L 130,360 L 160,400 L 200,430 L 260,440 L 320,450 L 380,445 L 440,430 L 500,400 L 540,370 L 580,330 L 600,290 L 610,250 L 590,210 L 560,180 L 520,160 L 480,150 L 440,145 L 400,140 L 360,138 L 320,140 L 280,148 L 240,160 L 200,175 L 160,188 Z"
          fill="rgba(212,245,60,0.04)" stroke="rgba(212,245,60,0.15)" stroke-width="1.5"/>
    <!-- Route SVG line -->
    <path d="M 395,315 Q 450,270 555,225" stroke="rgba(212,245,60,0.3)" stroke-width="2" stroke-dasharray="8,4" fill="none"/>
    <!-- Current position glow -->
    <circle cx="468" cy="270" r="18" fill="rgba(255,165,2,0.08)"/>
    <circle cx="468" cy="270" r="8" fill="rgba(255,165,2,0.15)"/>
  `;
}

// ---- ACTIONS ----
function openConfirmModal() {
  document.getElementById('confirmModal').classList.add('open');
}

function closeModal(e) {
  if (e.target === document.getElementById('confirmModal'))
    document.getElementById('confirmModal').classList.remove('open');
}

function confirmDelivery() {
  document.getElementById('confirmModal').classList.remove('open');
  // Update status
  const dot = document.querySelector('.status-dot');
  dot.className = 'status-dot dot-delivered';
  document.querySelector('.sh-status').innerHTML = '<div class="status-dot dot-delivered"></div> ENTREGADO';
  document.querySelector('.sh-eta-val').textContent = '‚úì Recibido';
  document.querySelector('.sh-eta-sub').textContent = '27 Feb ¬∑ Hoy';
  // Update last timeline item
  const items = document.querySelectorAll('.tl-item');
  items.forEach(el => {
    el.classList.remove('current','pending');
    el.classList.add('done');
    el.querySelector('.tl-icon-wrap').className = 'tl-icon-wrap done';
    el.querySelector('.tl-icon-wrap').textContent = '‚úì';
  });
}




function openCarrierWeb() {
  const urls = {
    correos: 'https://www.correos.es/es/es/herramientas/localizador/envios/index.html',
    correos_express: 'https://www.correosexpress.com/web/correosexpress/home',
    seur: 'https://www.seur.com/seguimiento-online.do',
    inpost: 'https://inpost.es/seguimiento',
  };
  // Default to Correos Express for this demo
  window.open(urls['correos_express'], '_blank');
}

// ---- INIT ----
renderTimeline();
renderShipments();
drawMap();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg ¬∑ Vender</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#08080d; --bg2:#0e0e16; --surface:#11111c; --surface2:#181825;
  --border:#22223a; --border2:#2d2d4a;
  --accent:#d4f53c; --accent-glow:rgba(212,245,60,0.15); --accent-dim:rgba(212,245,60,0.06);
  --red:#ff4757; --green:#2ed573; --yellow:#ffa502;
  --text:#eeeef8; --text2:#9898b8; --text3:#55556a;
  --nm:#2ed573; --lp:#ffa502; --mp:#ff4757;
  --nm-bg:rgba(46,213,115,0.08); --lp-bg:rgba(255,165,2,0.08); --mp-bg:rgba(255,71,87,0.08);
  --font-display:'Bebas Neue',sans-serif;
  --font-mono:'DM Mono',monospace;
  --font-body:'Plus Jakarta Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay;}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* NAV */
nav{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:60px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(8,8,13,0.95);backdrop-filter:blur(24px);z-index:100;}
.logo{font-family:var(--font-display);font-size:1.8rem;letter-spacing:3px;color:var(--text);line-height:1;cursor:pointer;}
.logo .dot{color:var(--accent);}
.nav-pills{display:flex;gap:0;border:1px solid var(--border);border-radius:6px;overflow:hidden;}
.nav-tab{padding:7px 22px;font-family:var(--font-mono);font-size:0.72rem;font-weight:500;letter-spacing:1px;text-transform:uppercase;color:var(--text2);cursor:pointer;border:none;background:none;border-right:1px solid var(--border);transition:all 0.15s;}
.nav-tab:last-child{border-right:none;}
.nav-tab:hover{background:var(--surface);color:var(--text);}
.nav-tab.active{background:var(--accent);color:#08080d;font-weight:700;}
.nav-right{display:flex;gap:10px;align-items:center;}
.btn-outline{padding:7px 16px;border:1px solid var(--border2);border-radius:5px;background:none;color:var(--text2);font-family:var(--font-mono);font-size:0.72rem;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;}
.btn-outline:hover{border-color:var(--accent);color:var(--accent);}
.btn-accent{padding:7px 18px;border:none;border-radius:5px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all 0.15s;}
.btn-accent:hover{box-shadow:0 0 20px var(--accent-glow);transform:translateY(-1px);}
.btn-accent:disabled{opacity:0.4;cursor:not-allowed;transform:none;box-shadow:none;}

/* PAGE HEADER */
.page-header{padding:32px 40px 0;border-bottom:1px solid var(--border);background:var(--bg2);}
.ph-eyebrow{font-family:var(--font-mono);font-size:0.65rem;color:var(--accent);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;}
.ph-title{font-family:var(--font-display);font-size:3rem;letter-spacing:2px;margin-bottom:6px;}
.ph-sub{font-size:0.88rem;color:var(--text2);font-weight:300;margin-bottom:24px;}
.ph-steps{display:flex;gap:0;margin-bottom:-1px;}
.step-tab{padding:10px 24px;font-family:var(--font-mono);font-size:0.7rem;letter-spacing:1px;text-transform:uppercase;color:var(--text3);border:1px solid transparent;border-bottom:none;border-radius:6px 6px 0 0;cursor:default;display:flex;align-items:center;gap:8px;}
.step-tab.done{color:var(--nm);}
.step-tab.active{background:var(--bg);border-color:var(--border);color:var(--text);border-bottom:1px solid var(--bg);}
.step-num{width:18px;height:18px;border-radius:50%;background:var(--border);display:flex;align-items:center;justify-content:center;font-size:0.6rem;font-weight:700;flex-shrink:0;}
.step-tab.active .step-num{background:var(--accent);color:#08080d;}
.step-tab.done .step-num{background:var(--nm);color:#08080d;}

/* MAIN */
.main{max-width:900px;margin:0 auto;padding:32px 40px 80px;}

/* STEP PANELS */
.step-panel{display:none;}
.step-panel.active{display:block;animation:fadeIn 0.25s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* STEP 1 ‚Äî SCAN */
.scan-options{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:28px;}
.scan-opt{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:28px;cursor:pointer;transition:all 0.2s;text-align:center;}
.scan-opt:hover{border-color:var(--border2);background:var(--surface2);}
.scan-opt.selected{border-color:var(--accent);background:var(--accent-dim);}
.so-icon{font-size:2.5rem;margin-bottom:12px;}
.so-title{font-family:var(--font-display);font-size:1.2rem;letter-spacing:1px;margin-bottom:6px;}
.so-desc{font-size:0.8rem;color:var(--text2);line-height:1.5;font-weight:300;}
.so-badge{display:inline-block;margin-top:10px;padding:3px 10px;border-radius:3px;font-family:var(--font-mono);font-size:0.6rem;letter-spacing:1px;text-transform:uppercase;}
.badge-ai{background:var(--accent-dim);border:1px solid rgba(212,245,60,0.2);color:var(--accent);}
.badge-manual{background:var(--surface2);border:1px solid var(--border);color:var(--text3);}

/* SCAN AREA */
.scan-area{display:none;}
.scan-area.active{display:block;}

.camera-zone{
  border:2px dashed var(--border2);
  border-radius:12px;
  background:var(--surface);
  padding:40px;
  text-align:center;
  position:relative;
  overflow:hidden;
  transition:all 0.2s;
  cursor:pointer;
}
.camera-zone:hover,.camera-zone.dragover{border-color:var(--accent);background:var(--accent-dim);}
.camera-zone input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.cz-icon{font-size:3rem;margin-bottom:14px;}
.cz-title{font-family:var(--font-display);font-size:1.4rem;letter-spacing:1px;margin-bottom:6px;}
.cz-sub{font-size:0.82rem;color:var(--text2);font-weight:300;}
.cz-hint{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:1px;margin-top:12px;}

/* Preview + AI result */
.scan-result{display:none;margin-top:20px;}
.scan-result.active{display:grid;grid-template-columns:200px 1fr;gap:20px;}
.sr-img-wrap{border-radius:10px;overflow:hidden;border:1px solid var(--border);aspect-ratio:3/4;background:var(--surface);display:flex;align-items:center;justify-content:center;}
.sr-img-wrap img{width:100%;height:100%;object-fit:cover;}
.sr-info{}
.sr-status{display:flex;align-items:center;gap:8px;margin-bottom:14px;padding:10px 14px;border-radius:6px;font-family:var(--font-mono);font-size:0.75rem;}
.sr-analyzing{background:var(--accent-dim);border:1px solid rgba(212,245,60,0.2);color:var(--accent);}
.sr-found{background:var(--nm-bg);border:1px solid rgba(46,213,115,0.2);color:var(--nm);}
.sr-notfound{background:var(--mp-bg);border:1px solid rgba(255,71,87,0.2);color:var(--mp);}
.spin{animation:spin 1s linear infinite;display:inline-block;}
@keyframes spin{to{transform:rotate(360deg)}}

.sr-card-info{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:14px;}
.sci-name{font-family:var(--font-display);font-size:1.5rem;letter-spacing:1px;margin-bottom:4px;}
.sci-set{font-family:var(--font-mono);font-size:0.68rem;color:var(--text3);letter-spacing:0.5px;margin-bottom:12px;}
.sci-price-row{display:flex;gap:10px;align-items:baseline;}
.sci-price{font-family:var(--font-display);font-size:1.8rem;letter-spacing:1px;color:var(--accent);}
.sci-label{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:1px;}

.sr-actions{display:flex;gap:10px;}
.btn-portfolio{padding:10px 20px;border:1px solid var(--border2);border-radius:6px;background:none;color:var(--text2);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-portfolio:hover{border-color:var(--accent);color:var(--accent);}
.btn-sell-now{padding:10px 20px;border:none;border-radius:6px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-sell-now:hover{box-shadow:0 0 16px var(--accent-glow);}

/* Manual search */
.manual-search{margin-top:20px;}
.ms-label{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;}
.ms-row{display:flex;gap:8px;}
.ms-input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:11px 16px;color:var(--text);font-family:var(--font-mono);font-size:0.82rem;outline:none;transition:border-color 0.15s;letter-spacing:0.3px;}
.ms-input:focus{border-color:var(--accent);}
.ms-input::placeholder{color:var(--text3);}
.ms-results{margin-top:12px;display:flex;flex-direction:column;gap:6px;max-height:300px;overflow-y:auto;}
.ms-item{display:flex;align-items:center;gap:12px;padding:10px 12px;background:var(--surface);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all 0.15s;}
.ms-item:hover{border-color:var(--accent);background:var(--accent-dim);}
.ms-thumb{width:36px;height:50px;object-fit:contain;border-radius:4px;background:var(--surface2);}
.ms-item-info{flex:1;}
.ms-item-name{font-size:0.85rem;font-weight:600;margin-bottom:2px;}
.ms-item-set{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);}
.ms-item-price{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;color:var(--accent);}

/* STEP 2 ‚Äî LISTING FORM */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px;}
.form-group{display:flex;flex-direction:column;gap:7px;}
.form-group.full{grid-column:1/-1;}
.fg-label{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;}
.fg-input{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:11px 14px;color:var(--text);font-family:var(--font-mono);font-size:0.85rem;outline:none;transition:border-color 0.15s;letter-spacing:0.3px;}
.fg-input:focus{border-color:var(--accent);}
.fg-input::placeholder{color:var(--text3);}
.fg-textarea{resize:vertical;min-height:80px;font-family:var(--font-body);font-size:0.85rem;line-height:1.5;}

/* Selected card preview in step 2 */
.selected-card-bar{display:flex;align-items:center;gap:14px;padding:14px 16px;background:var(--surface);border:1px solid var(--border);border-radius:8px;margin-bottom:24px;}
.scb-img{width:44px;height:62px;object-fit:contain;border-radius:5px;background:var(--surface2);}
.scb-info{flex:1;}
.scb-name{font-family:var(--font-display);font-size:1.1rem;letter-spacing:0.5px;}
.scb-set{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);margin-top:2px;}
.scb-price{font-family:var(--font-display);font-size:1.3rem;letter-spacing:0.5px;color:var(--accent);}
.scb-price-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);}
.btn-change{padding:6px 12px;border:1px solid var(--border);border-radius:5px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.65rem;cursor:pointer;transition:all 0.15s;letter-spacing:0.3px;}
.btn-change:hover{border-color:var(--border2);color:var(--text2);}

/* Condition selector */
.cond-selector{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.cond-opt{padding:12px;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all 0.15s;text-align:center;}
.cond-opt:hover{border-color:var(--border2);}
.cond-opt.selected-nm{border-color:var(--nm);background:var(--nm-bg);}
.cond-opt.selected-lp{border-color:var(--lp);background:var(--lp-bg);}
.cond-opt.selected-mp{border-color:var(--mp);background:var(--mp-bg);}
.co-badge{font-family:var(--font-mono);font-size:0.8rem;font-weight:700;letter-spacing:1px;margin-bottom:5px;}
.co-nm .co-badge{color:var(--nm);}
.co-lp .co-badge{color:var(--lp);}
.co-mp .co-badge{color:var(--mp);}
.co-desc{font-size:0.72rem;color:var(--text2);line-height:1.4;}

/* Price input with suggestion */
.price-input-wrap{position:relative;}
.price-input-wrap .fg-input{padding-left:28px;font-family:var(--font-display);font-size:1.1rem;letter-spacing:1px;}
.price-euro{position:absolute;left:12px;top:50%;transform:translateY(-50%);font-family:var(--font-display);font-size:1.1rem;color:var(--text3);pointer-events:none;}
.price-suggestion{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);margin-top:5px;letter-spacing:0.3px;}
.price-suggestion span{color:var(--accent);cursor:pointer;text-decoration:underline;}

/* Shipping selector */
.shipping-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;}
.ship-opt{display:flex;align-items:center;gap:10px;padding:12px 14px;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all 0.15s;}
.ship-opt:hover{border-color:var(--border2);}
.ship-opt.selected{border-color:var(--accent);background:var(--accent-dim);}
.ship-icon{font-size:1.3rem;flex-shrink:0;}
.ship-info{}
.ship-name{font-size:0.82rem;font-weight:600;margin-bottom:1px;}
.ship-price{font-family:var(--font-mono);font-size:0.68rem;color:var(--text3);}

/* Photos upload */
.photos-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
.photo-slot{aspect-ratio:1;border:1.5px dashed var(--border2);border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.15s;position:relative;overflow:hidden;background:var(--surface);}
.photo-slot:hover{border-color:var(--accent);}
.photo-slot.filled{border-style:solid;border-color:var(--border2);}
.photo-slot input{position:absolute;inset:0;opacity:0;cursor:pointer;}
.photo-slot img{width:100%;height:100%;object-fit:cover;border-radius:7px;}
.ps-icon{font-size:1.3rem;color:var(--text3);margin-bottom:4px;}
.ps-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:1px;}
.photo-slot.main-slot{border-color:var(--border2);}
.photo-slot.main-slot::after{content:'PRINCIPAL';position:absolute;bottom:0;left:0;right:0;background:rgba(212,245,60,0.85);color:#08080d;font-family:var(--font-mono);font-size:0.55rem;font-weight:700;letter-spacing:1px;text-align:center;padding:2px;}

/* STEP 3 ‚Äî PREVIEW */
.preview-layout{display:grid;grid-template-columns:240px 1fr;gap:24px;}
.preview-card{background:var(--surface);border:1px solid var(--border2);border-radius:12px;overflow:hidden;box-shadow:0 20px 40px rgba(0,0,0,0.5);}
.preview-card-img{width:100%;height:190px;background:linear-gradient(135deg,#13132a,#1a1a35,#131328);display:flex;align-items:center;justify-content:center;font-size:3rem;overflow:hidden;}
.preview-card-img img{width:100%;height:100%;object-fit:contain;padding:6px;}
.preview-card-body{padding:14px;}
.pcb-name{font-family:var(--font-display);font-size:1.1rem;letter-spacing:1px;margin-bottom:2px;}
.pcb-set{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);margin-bottom:10px;}
.unverified-badge{display:inline-flex;align-items:center;gap:5px;background:rgba(255,165,2,0.1);border:1px solid rgba(255,165,2,0.25);border-radius:4px;padding:3px 9px;font-family:var(--font-mono);font-size:0.62rem;color:var(--lp);letter-spacing:0.5px;margin-bottom:10px;}
.pcb-price{font-family:var(--font-display);font-size:1.8rem;letter-spacing:1px;color:var(--accent);}
.pcb-ship{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);margin-top:4px;}

.preview-details{}
.pd-section{margin-bottom:20px;}
.pds-title{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);}
.pds-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border);}
.pds-row:last-child{border-bottom:none;}
.pdr-label{font-family:var(--font-mono);font-size:0.72rem;color:var(--text3);}
.pdr-val{font-family:var(--font-mono);font-size:0.72rem;font-weight:500;}
.pdr-val.accent{color:var(--accent);}
.pdr-val.green{color:var(--nm);}



.verify-banner{display:flex;align-items:flex-start;gap:12px;padding:14px;background:rgba(255,165,2,0.06);border:1px solid rgba(255,165,2,0.2);border-radius:8px;margin-top:16px;}
.vb-icon{font-size:1.3rem;flex-shrink:0;margin-top:2px;}
.vb-title{font-size:0.82rem;font-weight:600;margin-bottom:3px;color:var(--lp);}
.vb-desc{font-size:0.78rem;color:var(--text2);line-height:1.5;font-weight:300;}
.btn-verify{margin-top:8px;padding:7px 14px;border:1px solid var(--lp);border-radius:5px;background:none;color:var(--lp);font-family:var(--font-mono);font-size:0.68rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-verify:hover{background:var(--lp-bg);}

/* Nav buttons */
.step-nav{display:flex;justify-content:space-between;align-items:center;margin-top:28px;padding-top:20px;border-top:1px solid var(--border);}
.btn-back{padding:10px 20px;border:1px solid var(--border);border-radius:6px;background:none;color:var(--text2);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-back:hover{border-color:var(--border2);color:var(--text);}
.btn-next{padding:11px 28px;border:none;border-radius:6px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-next:hover{box-shadow:0 0 20px var(--accent-glow);transform:translateY(-1px);}
.btn-next:disabled{opacity:0.4;cursor:not-allowed;transform:none;box-shadow:none;}

/* Success screen */
.success-screen{display:none;text-align:center;padding:60px 20px;}
.success-screen.active{display:block;animation:fadeIn 0.4s ease;}
.ss-icon{font-size:4rem;margin-bottom:20px;}
.ss-title{font-family:var(--font-display);font-size:3rem;letter-spacing:2px;margin-bottom:10px;}
.ss-sub{font-size:0.92rem;color:var(--text2);font-weight:300;margin-bottom:32px;line-height:1.6;}
.ss-actions{display:flex;gap:12px;justify-content:center;}

/* DIVIDER */
.divider{display:flex;align-items:center;gap:12px;margin:20px 0;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border);}
.divider span{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:1px;text-transform:uppercase;}

@media(max-width:700px){
  nav{padding:0 18px;}
  .nav-pills{display:none;}
  .page-header{padding:24px 18px 0;}
  .main{padding:24px 18px 60px;}
  .scan-options{grid-template-columns:1fr;}
  .form-grid{grid-template-columns:1fr;}
  .preview-layout{grid-template-columns:1fr;}
  .photos-grid{grid-template-columns:repeat(3,1fr);}
  .shipping-grid{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<nav>
  <div class="logo" onclick="window.location.href='pple-tcg.html'">PPLE<span class="dot">.</span>TCG</div>
  <div class="nav-pills">
    <button class="nav-tab" onclick="window.location.href='pple-tcg.html'">Mercado</button>
    <button class="nav-tab active">Vender</button>
    <button class="nav-tab">Verificaci√≥n</button>
    <button class="nav-tab">Portfolio</button>
  </div>
  <div class="nav-right">
    <button class="btn-outline">Entrar</button>
    <button class="btn-accent">Registrarse</button>
  </div>
</nav>

<div class="page-header">
  <div class="ph-eyebrow">Marketplace ¬∑ Pok√©mon TCG</div>
  <div class="ph-title">PUBLICAR CARTA</div>
  <div class="ph-sub">Escanea tu carta o b√∫scala manualmente, fija tu precio y empieza a vender.</div>
  <div class="ph-steps">
    <div class="step-tab active" id="stab1"><div class="step-num">1</div>Identificar carta</div>
    <div class="step-tab" id="stab2"><div class="step-num">2</div>Detalles del anuncio</div>
    <div class="step-tab" id="stab3"><div class="step-num">3</div>Confirmar y publicar</div>
  </div>
</div>

<div class="main">

  <!-- STEP 1 -->
  <div class="step-panel active" id="step1">
    <div class="scan-options">
      <div class="scan-opt" id="optScan" onclick="selectScanMethod('scan')">
        <div class="so-icon">üì∑</div>
        <div class="so-title">ESCANEAR CARTA</div>
        <div class="so-desc">Sube una foto de tu carta y la IA la identificar√° autom√°ticamente con nombre, colecci√≥n y precio de mercado.</div>
        <div class="so-badge badge-ai">‚ú¶ IA ¬∑ Claude Vision</div>
      </div>
      <div class="scan-opt" id="optManual" onclick="selectScanMethod('manual')">
        <div class="so-icon">üîç</div>
        <div class="so-title">BUSCAR MANUALMENTE</div>
        <div class="so-desc">Escribe el nombre de la carta o navega por colecci√≥n para encontrarla en el cat√°logo.</div>
        <div class="so-badge badge-manual">B√∫squeda manual</div>
      </div>
    </div>

    <!-- SCAN METHOD -->
    <div class="scan-area" id="scanArea">
      <div class="camera-zone" id="cameraZone">
        <input type="file" accept="image/*" capture="environment" id="cardPhoto" onchange="handlePhoto(this)">
        <div class="cz-icon">üì∏</div>
        <div class="cz-title">SUBE O ARRASTRA TU CARTA</div>
        <div class="cz-sub">Captura con la c√°mara del m√≥vil o sube una foto desde la galer√≠a</div>
        <div class="cz-hint">JPG ¬∑ PNG ¬∑ WEBP ¬∑ M√°x. 10MB</div>
      </div>

      <div class="scan-result" id="scanResult">
        <div class="sr-img-wrap">
          <img id="cardPreviewImg" src="" alt="">
        </div>
        <div class="sr-info">
          <div class="sr-status sr-analyzing" id="srStatus">
            <span class="spin">‚ü≥</span> Analizando carta con IA...
          </div>
          <div class="sr-card-info" id="srCardInfo" style="display:none">
            <div class="sci-name" id="srName">‚Äî</div>
            <div class="sci-set" id="srSet">‚Äî</div>
            <div class="sci-price-row">
              <div>
                <div class="sci-label">PRECIO CARDMARKET</div>
                <div class="sci-price" id="srPrice">‚Äî</div>
              </div>
            </div>
          </div>
          <div id="srActions" class="sr-actions" style="display:none">
            <button class="btn-portfolio" onclick="addToPortfolio()">+ Portfolio</button>
            <button class="btn-sell-now" onclick="goToStep2()">Poner a la venta ‚Üí</button>
          </div>
          <div id="srError" style="display:none;padding:12px;background:var(--mp-bg);border:1px solid rgba(255,71,87,0.2);border-radius:6px;font-family:var(--font-mono);font-size:0.72rem;color:var(--mp);">
            ‚ö† No se pudo identificar la carta. Intenta con una foto m√°s n√≠tida o usa la b√∫squeda manual.
          </div>
        </div>
      </div>
    </div>

    <!-- MANUAL METHOD -->
    <div class="scan-area" id="manualArea">
      <div class="manual-search">
        <div class="ms-label">Nombre de la carta</div>
        <div class="ms-row">
          <input class="ms-input" type="text" placeholder="Ej: Charizard ex, Pikachu, Mewtwo..." id="manualSearch" oninput="searchCards(this.value)">
        </div>
        <div class="ms-results" id="manualResults"></div>
      </div>
    </div>
  </div>

  <!-- STEP 2 -->
  <div class="step-panel" id="step2">
    <div class="selected-card-bar" id="selectedCardBar">
      <img class="scb-img" id="scbImg" src="" alt="">
      <div class="scb-info">
        <div class="scb-name" id="scbName">‚Äî</div>
        <div class="scb-set" id="scbSet">‚Äî</div>
      </div>
      <div>
        <div class="scb-price-label">PRECIO MERCADO</div>
        <div class="scb-price" id="scbPrice">‚Äî</div>
      </div>
      <button class="btn-change" onclick="goToStep1()">Cambiar</button>
    </div>

    <div class="form-grid">

      <!-- CONDITION -->
      <div class="form-group full">
        <div class="fg-label">Estado de la carta</div>
        <div class="cond-selector">
          <div class="cond-opt co-nm" onclick="selectCond('NM',this)">
            <div class="co-badge">NM</div>
            <div class="co-desc">Near Mint ‚Äî Sin marcas visibles. Como nueva.</div>
          </div>
          <div class="cond-opt co-lp" onclick="selectCond('LP',this)">
            <div class="co-badge">LP</div>
            <div class="co-desc">Lightly Played ‚Äî Alguna marca leve o ara√±azo menor.</div>
          </div>
          <div class="cond-opt co-mp" onclick="selectCond('MP',this)">
            <div class="co-badge">MP</div>
            <div class="co-desc">Moderately Played ‚Äî Desgaste visible, dobleces leves.</div>
          </div>
        </div>
      </div>

      <!-- PRICE -->
      <div class="form-group">
        <div class="fg-label">Tu precio de venta</div>
        <div class="price-input-wrap">
          <span class="price-euro">‚Ç¨</span>
          <input class="fg-input" type="number" step="0.01" min="0.01" id="sellPrice" placeholder="0.00" oninput="validateStep2()">
        </div>
        <div class="price-suggestion" id="priceSuggestion">Cardmarket: ‚Äî ¬∑ <span onclick="useSuggestedPrice()">Usar precio sugerido</span></div>
      </div>

      <!-- PHOTOS -->
      <div class="form-group">
        <div class="fg-label">Fotos de tu carta (obligatorio)</div>
        <div class="photos-grid">
          <div class="photo-slot main-slot" id="ps0" onclick="triggerPhoto(0)">
            <input type="file" accept="image/*" id="pf0" onchange="handleSlotPhoto(0,this)" style="display:none">
            <div class="ps-icon">üì∑</div>
            <div class="ps-label">Principal</div>
          </div>
          <div class="photo-slot" id="ps1" onclick="triggerPhoto(1)">
            <input type="file" accept="image/*" id="pf1" onchange="handleSlotPhoto(1,this)" style="display:none">
            <div class="ps-icon">+</div>
          </div>
          <div class="photo-slot" id="ps2" onclick="triggerPhoto(2)">
            <input type="file" accept="image/*" id="pf2" onchange="handleSlotPhoto(2,this)" style="display:none">
            <div class="ps-icon">+</div>
          </div>
          <div class="photo-slot" id="ps3" onclick="triggerPhoto(3)">
            <input type="file" accept="image/*" id="pf3" onchange="handleSlotPhoto(3,this)" style="display:none">
            <div class="ps-icon">+</div>
          </div>
        </div>
      </div>

      <!-- SHIPPING -->
      <div class="form-group full">
        <div class="fg-label">Tipo de env√≠o</div>
        <div class="shipping-grid">
          <div class="ship-opt" onclick="selectShipping('letter',this)">
            <div class="ship-icon">‚úâÔ∏è</div>
            <div class="ship-info">
              <div class="ship-name">Carta certificada</div>
              <div class="ship-price">‚Ç¨1.80 ¬∑ Solo cartas sueltas ¬∑ hasta 50g</div>
            </div>
          </div>
          <div class="ship-opt" onclick="selectShipping('small',this)">
            <div class="ship-icon">üì¶</div>
            <div class="ship-info">
              <div class="ship-name">Paquete peque√±o</div>
              <div class="ship-price">‚Ç¨3.50 ¬∑ hasta 500g ¬∑ con seguimiento</div>
            </div>
          </div>
          <div class="ship-opt" onclick="selectShipping('medium',this)">
            <div class="ship-icon">üóÉÔ∏è</div>
            <div class="ship-info">
              <div class="ship-name">Paquete mediano</div>
              <div class="ship-price">‚Ç¨5.90 ¬∑ hasta 2kg ¬∑ sobres/displays</div>
            </div>
          </div>
          <div class="ship-opt" onclick="selectShipping('large',this)">
            <div class="ship-icon">üì´</div>
            <div class="ship-info">
              <div class="ship-name">Paquete grande</div>
              <div class="ship-price">‚Ç¨9.90 ¬∑ hasta 10kg ¬∑ cajas selladas</div>
            </div>
          </div>
        </div>
      </div>

      <!-- NOTES -->
      <div class="form-group full">
        <div class="fg-label">Notas adicionales (opcional)</div>
        <textarea class="fg-input fg-textarea" id="sellNotes" placeholder="Describe el estado con m√°s detalle, si viene con sleeve, etc..."></textarea>
      </div>

    </div>

    <div class="step-nav">
      <button class="btn-back" onclick="goToStep1()">‚Üê Atr√°s</button>
      <button class="btn-next" id="btnStep2Next" onclick="goToStep3()" disabled>Previsualizar ‚Üí</button>
    </div>
  </div>

  <!-- STEP 3 ‚Äî PREVIEW -->
  <div class="step-panel" id="step3">
    <div class="preview-layout">
      <div>
        <div class="preview-card">
          <div class="preview-card-img" id="previewImg">üé¥</div>
          <div class="preview-card-body">
            <div class="pcb-name" id="previewName">‚Äî</div>
            <div class="pcb-set" id="previewSet">‚Äî</div>
            <div class="unverified-badge">‚ö† No verificada</div>
            <div class="pcb-price" id="previewPrice">‚Äî</div>
            <div class="pcb-ship" id="previewShip">‚Äî</div>
          </div>
        </div>
      </div>
      <div class="preview-details">
        <div class="pd-section">
          <div class="pds-title">Detalles del anuncio</div>
          <div class="pds-row"><span class="pdr-label">Estado</span><span class="pdr-val" id="pvCond">‚Äî</span></div>
          <div class="pds-row"><span class="pdr-label">Precio vendedor</span><span class="pdr-val accent" id="pvPrice">‚Äî</span></div>
          <div class="pds-row"><span class="pdr-label">Precio referencia Cardmarket</span><span class="pdr-val" id="pvRef">‚Äî</span></div>
          <div class="pds-row"><span class="pdr-label">Env√≠o</span><span class="pdr-val" id="pvShip">‚Äî</span></div>
        </div>



        <div class="verify-banner">
          <div class="vb-icon">üîç</div>
          <div>
            <div class="vb-title">¬øQuieres verificar la autenticidad?</div>
            <div class="vb-desc">Env√≠a la carta a nuestro verificador en Guadalajara. El servicio incluye pre-grading y da m√°s confianza a los compradores. Coste: env√≠o + 3-20‚Ç¨ seg√∫n carta. Lo paga el comprador.</div>
            <button class="btn-verify">Solicitar verificaci√≥n</button>
          </div>
        </div>
      </div>
    </div>

    <div class="step-nav">
      <button class="btn-back" onclick="goToStep2()">‚Üê Atr√°s</button>
      <button class="btn-next" onclick="publishListing()">Publicar anuncio ‚úì</button>
    </div>
  </div>

  <!-- SUCCESS -->
  <div class="success-screen" id="successScreen">
    <div class="ss-icon">‚úÖ</div>
    <div class="ss-title">¬°PUBLICADO!</div>
    <div class="ss-sub">Tu carta ya est√° visible en el mercado con badge de "No verificada".<br>Te avisaremos cuando alguien haga una oferta.</div>
    <div class="ss-actions">
      <button class="btn-outline" onclick="resetForm()">Publicar otra carta</button>
      <button class="btn-accent" onclick="window.location.href='pple-tcg.html'">Ver marketplace</button>
    </div>
  </div>

</div>

<script>
const BASE = 'https://api.tcgdex.net/v2/en';
let selectedCard = null;
let selectedCond = null;
let selectedShipping = null;
let uploadedPhoto = null;
let currentStep = 1;

const SHIPPING_PRICES = { letter:1.80, small:3.50, medium:5.90, large:9.90 };
const SHIPPING_NAMES = { letter:'Carta certificada', small:'Paquete peque√±o', medium:'Paquete mediano', large:'Paquete grande' };

// ---- STEP NAVIGATION ----
function setStep(n) {
  currentStep = n;
  [1,2,3].forEach(i => {
    document.getElementById(`step${i}`).classList.toggle('active', i===n);
    const tab = document.getElementById(`stab${i}`);
    tab.classList.remove('active','done');
    if (i < n) tab.classList.add('done');
    if (i === n) tab.classList.add('active');
  });
  document.getElementById('successScreen').classList.remove('active');
  window.scrollTo({top:0,behavior:'smooth'});
}

function goToStep1() { setStep(1); }
function goToStep2() {
  if (!selectedCard) return;
  populateStep2();
  setStep(2);
}
function goToStep3() {
  if (!validateStep2()) return;
  populateStep3();
  setStep(3);
}

// ---- SCAN METHOD ----
function selectScanMethod(method) {
  document.getElementById('optScan').classList.toggle('selected', method==='scan');
  document.getElementById('optManual').classList.toggle('selected', method==='manual');
  document.getElementById('scanArea').classList.toggle('active', method==='scan');
  document.getElementById('manualArea').classList.toggle('active', method==='manual');
}

// ---- PHOTO HANDLING (for scan) ----
async function handlePhoto(input) {
  if (!input.files[0]) return;
  const file = input.files[0];
  uploadedPhoto = file;

  // Show preview
  const url = URL.createObjectURL(file);
  document.getElementById('cardPreviewImg').src = url;
  document.getElementById('scanResult').classList.add('active');
  document.getElementById('srStatus').className = 'sr-status sr-analyzing';
  document.getElementById('srStatus').innerHTML = '<span class="spin">‚ü≥</span> Analizando carta con IA...';
  document.getElementById('srCardInfo').style.display = 'none';
  document.getElementById('srActions').style.display = 'none';
  document.getElementById('srError').style.display = 'none';

  try {
    const identified = await analyzeCardWithAI(file);
    if (identified) {
      await fetchCardFromTCGdex(identified);
    } else {
      showScanError();
    }
  } catch(e) {
    showScanError();
  }
}

async function analyzeCardWithAI(file) {
  // Convert to base64
  const base64 = await fileToBase64(file);
  const mediaType = file.type || 'image/jpeg';

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        messages: [{
          role: 'user',
          content: [
            {
              type: 'image',
              source: { type: 'base64', media_type: mediaType, data: base64 }
            },
            {
              type: 'text',
              text: `Analyze this Pok√©mon TCG card image. Respond ONLY with a JSON object, no other text:
{
  "name": "exact card name in English",
  "set": "exact set/expansion name",
  "number": "card number like 025/197",
  "language": "en or jp",
  "identified": true
}
If this is not a Pok√©mon card or you cannot identify it clearly, respond with: {"identified": false}`
            }
          ]
        }]
      })
    });

    const data = await response.json();
    const text = data.content?.[0]?.text || '';
    const clean = text.replace(/```json|```/g, '').trim();
    const parsed = JSON.parse(clean);
    return parsed.identified ? parsed : null;
  } catch(e) {
    return null;
  }
}

function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result.split(',')[1]);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

async function fetchCardFromTCGdex(identified) {
  try {
    // Search by name in TCGdex
    const res = await fetch(`${BASE}/cards?name=${encodeURIComponent(identified.name)}`);
    const cards = await res.json();

    let match = null;
    if (Array.isArray(cards) && cards.length > 0) {
      match = cards[0];
      // Try to find a better match by set name if we have it
      if (identified.set) {
        const better = cards.find(c =>
          c.set?.name?.toLowerCase().includes(identified.set.toLowerCase().substring(0,5))
        );
        if (better) match = better;
      }
    }

    if (match) {
      // Fetch full card details
      const detailRes = await fetch(`${BASE}/cards/${match.id}`);
      const card = await detailRes.json();
      const price = card.pricing?.cardmarket?.trend || card.pricing?.cardmarket?.avg || null;

      selectedCard = { ...card, _imageUrl: card.image ? card.image+'/high.png' : null };

      document.getElementById('srStatus').className = 'sr-status sr-found';
      document.getElementById('srStatus').innerHTML = '‚úì Carta identificada correctamente';
      document.getElementById('srName').textContent = card.name;
      document.getElementById('srSet').textContent = `${card.set?.name || identified.set} ¬∑ #${card.localId}`;
      document.getElementById('srPrice').textContent = price ? `‚Ç¨${parseFloat(price).toFixed(2)}` : 'Sin precio en Cardmarket';
      document.getElementById('srCardInfo').style.display = 'block';
      document.getElementById('srActions').style.display = 'flex';
    } else {
      // Card not in TCGdex but AI identified it ‚Äî create a minimal entry
      selectedCard = {
        id: 'custom-' + Date.now(),
        name: identified.name,
        localId: identified.number || '‚Äî',
        set: { name: identified.set || '‚Äî' },
        pricing: null,
        _imageUrl: null,
        _custom: true
      };
      document.getElementById('srStatus').className = 'sr-status sr-found';
      document.getElementById('srStatus').innerHTML = `‚úì Identificada: ${identified.name}`;
      document.getElementById('srName').textContent = identified.name;
      document.getElementById('srSet').textContent = `${identified.set || '‚Äî'} ¬∑ ${identified.number || '‚Äî'}`;
      document.getElementById('srPrice').textContent = 'Sin precio en Cardmarket';
      document.getElementById('srCardInfo').style.display = 'block';
      document.getElementById('srActions').style.display = 'flex';
    }
  } catch(e) {
    showScanError();
  }
}

function showScanError() {
  document.getElementById('srStatus').style.display = 'none';
  document.getElementById('srError').style.display = 'block';
}

function addToPortfolio() {
  if (!selectedCard) return;
  // Would save to user's portfolio in real app
  const btn = document.querySelector('.btn-portfolio');
  btn.textContent = '‚úì A√±adido';
  btn.style.color = 'var(--nm)';
  btn.style.borderColor = 'var(--nm)';
  setTimeout(() => {
    btn.textContent = '+ Portfolio';
    btn.style.color = '';
    btn.style.borderColor = '';
  }, 2000);
}

// ---- MANUAL SEARCH ----
let searchTimer = null;
async function searchCards(query) {
  clearTimeout(searchTimer);
  if (query.length < 2) { document.getElementById('manualResults').innerHTML=''; return; }
  searchTimer = setTimeout(async () => {
    try {
      const res = await fetch(`${BASE}/cards?name=${encodeURIComponent(query)}`);
      const cards = await res.json();
      if (!Array.isArray(cards) || !cards.length) {
        document.getElementById('manualResults').innerHTML = '<div style="padding:10px;font-family:var(--font-mono);font-size:0.72rem;color:var(--text3)">Sin resultados</div>';
        return;
      }
      document.getElementById('manualResults').innerHTML = cards.slice(0,8).map(c => `
        <div class="ms-item" onclick="selectManualCard('${c.id}')">
          <img class="ms-thumb" src="${c.image ? c.image+'/low.png' : ''}" onerror="this.style.display='none'" alt="">
          <div class="ms-item-info">
            <div class="ms-item-name">${c.name}</div>
            <div class="ms-item-set">${c.set?.name || '‚Äî'} ¬∑ #${c.localId}</div>
          </div>
          <div class="ms-item-price" id="mip-${c.id}">‚Äî</div>
        </div>`).join('');
      // Load prices async
      cards.slice(0,8).forEach(async c => {
        try {
          const dr = await fetch(`${BASE}/cards/${c.id}`);
          const d = await dr.json();
          const p = d.pricing?.cardmarket?.trend;
          const el = document.getElementById(`mip-${c.id}`);
          if (el) el.textContent = p ? `‚Ç¨${parseFloat(p).toFixed(2)}` : '‚Äî';
        } catch(e){}
      });
    } catch(e) {}
  }, 350);
}

async function selectManualCard(id) {
  try {
    const res = await fetch(`${BASE}/cards/${id}`);
    const card = await res.json();
    selectedCard = { ...card, _imageUrl: card.image ? card.image+'/high.png' : null };
    document.getElementById('manualSearch').value = card.name;
    document.getElementById('manualResults').innerHTML = `
      <div style="display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--accent-dim);border:1px solid rgba(212,245,60,0.2);border-radius:8px;">
        <img style="width:36px;height:50px;object-fit:contain" src="${card.image ? card.image+'/low.png' : ''}" onerror="this.style.display='none'">
        <div style="flex:1">
          <div style="font-weight:600;font-size:0.85rem">${card.name}</div>
          <div style="font-family:var(--font-mono);font-size:0.65rem;color:var(--text3)">${card.set?.name||'‚Äî'} ¬∑ #${card.localId}</div>
        </div>
        <div style="font-family:var(--font-display);font-size:1rem;color:var(--accent)">${card.pricing?.cardmarket?.trend ? '‚Ç¨'+parseFloat(card.pricing.cardmarket.trend).toFixed(2) : '‚Äî'}</div>
        <button class="btn-sell-now" onclick="goToStep2()" style="padding:8px 14px;font-size:0.68rem">Vender ‚Üí</button>
      </div>`;
  } catch(e) {}
}

// ---- STEP 2 ----
function populateStep2() {
  if (!selectedCard) return;
  const price = selectedCard.pricing?.cardmarket?.trend;
  const imgUrl = selectedCard._imageUrl || (selectedCard.image ? selectedCard.image+'/low.png' : null);
  document.getElementById('scbImg').src = imgUrl || '';
  document.getElementById('scbImg').style.display = imgUrl ? 'block' : 'none';
  document.getElementById('scbName').textContent = selectedCard.name;
  document.getElementById('scbSet').textContent = `${selectedCard.set?.name||'‚Äî'} ¬∑ #${selectedCard.localId}`;
  document.getElementById('scbPrice').textContent = price ? `‚Ç¨${parseFloat(price).toFixed(2)}` : '‚Äî';
  const sug = document.getElementById('priceSuggestion');
  if (price) {
    sug.innerHTML = `Cardmarket: <strong style="color:var(--text2)">‚Ç¨${parseFloat(price).toFixed(2)}</strong> ¬∑ <span onclick="useSuggestedPrice()">Usar precio sugerido</span>`;
  } else {
    sug.textContent = 'Sin precio de referencia en Cardmarket';
  }
  // If we have a scanned photo use it as first slot
  if (uploadedPhoto) {
    const url = URL.createObjectURL(uploadedPhoto);
    const slot = document.getElementById('ps0');
    slot.innerHTML = `<img src="${url}">`;
    slot.classList.add('filled');
    slot.onclick = null;
  }
}

function selectCond(cond, el) {
  selectedCond = cond;
  document.querySelectorAll('.cond-opt').forEach(e => e.classList.remove('selected-nm','selected-lp','selected-mp'));
  el.classList.add(`selected-${cond.toLowerCase()}`);
  validateStep2();
}

function selectShipping(type, el) {
  selectedShipping = type;
  document.querySelectorAll('.ship-opt').forEach(e => e.classList.remove('selected'));
  el.classList.add('selected');
  validateStep2();
}

function validateStep2() {
  const price = parseFloat(document.getElementById('sellPrice').value);
  const valid = selectedCond && selectedShipping && price > 0;
  document.getElementById('btnStep2Next').disabled = !valid;
  return valid;
}


function useSuggestedPrice() {
  const price = selectedCard?.pricing?.cardmarket?.trend;
  if (price) {
    document.getElementById('sellPrice').value = parseFloat(price).toFixed(2);
    validateStep2();
  }
}

function triggerPhoto(slot) {
  document.getElementById(`pf${slot}`).click();
}
function handleSlotPhoto(slot, input) {
  if (!input.files[0]) return;
  const url = URL.createObjectURL(input.files[0]);
  const el = document.getElementById(`ps${slot}`);
  el.innerHTML = `<img src="${url}">`;
  el.classList.add('filled');
  el.onclick = null;
}

// ---- STEP 3 ----
function populateStep3() {
  const price = parseFloat(document.getElementById('sellPrice').value);
  const imgUrl = selectedCard._imageUrl || (selectedCard.image ? selectedCard.image+'/low.png' : null);
  const refPrice = selectedCard.pricing?.cardmarket?.trend;

  // Preview card
  document.getElementById('previewImg').innerHTML = imgUrl
    ? `<img src="${imgUrl}" alt="${selectedCard.name}" onerror="this.parentNode.innerHTML='üé¥'">`
    : 'üé¥';
  document.getElementById('previewName').textContent = selectedCard.name;
  document.getElementById('previewSet').textContent = `${selectedCard.set?.name||'‚Äî'} ¬∑ #${selectedCard.localId}`;
  document.getElementById('previewPrice').textContent = `‚Ç¨${price.toFixed(2)}`;
  document.getElementById('previewShip').textContent = `Env√≠o: ${SHIPPING_NAMES[selectedShipping]} ¬∑ ‚Ç¨${SHIPPING_PRICES[selectedShipping].toFixed(2)}`;

  // Details
  const condLabels = {NM:'Near Mint üü¢', LP:'Lightly Played üü°', MP:'Moderately Played üî¥'};
  document.getElementById('pvCond').textContent = condLabels[selectedCond] || selectedCond;
  document.getElementById('pvPrice').textContent = `‚Ç¨${price.toFixed(2)}`;
  document.getElementById('pvRef').textContent = refPrice ? `‚Ç¨${parseFloat(refPrice).toFixed(2)}` : 'Sin referencia';
  document.getElementById('pvShip').textContent = `${SHIPPING_NAMES[selectedShipping]} ¬∑ ‚Ç¨${SHIPPING_PRICES[selectedShipping].toFixed(2)}`;


}

function publishListing() {
  // In real app: save to DB, navigate to listing
  document.getElementById('step3').classList.remove('active');
  [1,2,3].forEach(i => document.getElementById(`stab${i}`).classList.remove('active','done'));
  document.getElementById('successScreen').classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
}

function resetForm() {
  selectedCard=null; selectedCond=null; selectedShipping=null; uploadedPhoto=null;
  document.getElementById('scanResult').classList.remove('active');
  document.getElementById('manualResults').innerHTML='';
  document.getElementById('manualSearch').value='';
  document.getElementById('sellPrice').value='';
  document.getElementById('sellNotes').value='';
  document.querySelectorAll('.cond-opt').forEach(e=>e.classList.remove('selected-nm','selected-lp','selected-mp'));
  document.querySelectorAll('.ship-opt').forEach(e=>e.classList.remove('selected'));
  document.getElementById('optScan').classList.remove('selected');
  document.getElementById('optManual').classList.remove('selected');
  document.getElementById('scanArea').classList.remove('active');
  document.getElementById('manualArea').classList.remove('active');
  [0,1,2,3].forEach(i=>{
    const slot=document.getElementById(`ps${i}`);
    slot.innerHTML = i===0
      ? `<input type="file" accept="image/*" id="pf${i}" onchange="handleSlotPhoto(${i},this)" style="display:none"><div class="ps-icon">üì∑</div><div class="ps-label">Principal</div>`
      : `<input type="file" accept="image/*" id="pf${i}" onchange="handleSlotPhoto(${i},this)" style="display:none"><div class="ps-icon">+</div>`;
    slot.classList.remove('filled');
    if(i===0) slot.onclick=()=>triggerPhoto(0);
    else slot.onclick=()=>triggerPhoto(i);
  });
  setStep(1);
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg ¬∑ Verificaci√≥n</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#08080d; --bg2:#0e0e16; --surface:#11111c; --surface2:#181825;
  --border:#22223a; --border2:#2d2d4a;
  --accent:#d4f53c; --accent-glow:rgba(212,245,60,0.15); --accent-dim:rgba(212,245,60,0.06);
  --text:#eeeef8; --text2:#9898b8; --text3:#55556a;
  --nm:#2ed573; --lp:#ffa502; --mp:#ff4757;
  --ai-col:#38bdf8; --ai-bg:rgba(56,189,248,0.07); --ai-border:rgba(56,189,248,0.2);
  --manual-col:#a78bfa; --manual-bg:rgba(167,139,250,0.07); --manual-border:rgba(167,139,250,0.2);
  --pre-col:#d4f53c; --pre-bg:rgba(212,245,60,0.07); --pre-border:rgba(212,245,60,0.2);
  --beckett-col:#f59e0b; --beckett-bg:rgba(245,158,11,0.07); --beckett-border:rgba(245,158,11,0.2);
  --font-display:'Bebas Neue',sans-serif;
  --font-mono:'DM Mono',monospace;
  --font-body:'Plus Jakarta Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay;}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* NAV */
nav{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:60px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(8,8,13,0.96);backdrop-filter:blur(24px);z-index:100;}
.logo{font-family:var(--font-display);font-size:1.8rem;letter-spacing:3px;cursor:pointer;}
.logo .dot{color:var(--accent);}
.nav-pills{display:flex;gap:0;border:1px solid var(--border);border-radius:6px;overflow:hidden;}
.nav-tab{padding:7px 22px;font-family:var(--font-mono);font-size:0.72rem;font-weight:500;letter-spacing:1px;text-transform:uppercase;color:var(--text2);cursor:pointer;border:none;background:none;border-right:1px solid var(--border);transition:all 0.15s;}
.nav-tab:last-child{border-right:none;}
.nav-tab:hover{background:var(--surface);color:var(--text);}
.nav-tab.active{background:var(--accent);color:#08080d;font-weight:700;}
.nav-right{display:flex;gap:10px;}
.btn-accent{padding:7px 18px;border:none;border-radius:5px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all 0.15s;}
.btn-accent:hover{box-shadow:0 0 20px var(--accent-glow);transform:translateY(-1px);}

/* HERO */
.hero{padding:56px 40px 48px;background:var(--bg2);border-bottom:1px solid var(--border);position:relative;overflow:hidden;}
.hero-glow{position:absolute;top:-120px;right:-80px;width:500px;height:500px;background:radial-gradient(circle,rgba(56,189,248,0.06) 0%,transparent 70%);pointer-events:none;}
.hero-glow2{position:absolute;bottom:-100px;left:-60px;width:400px;height:400px;background:radial-gradient(circle,rgba(212,245,60,0.05) 0%,transparent 70%);pointer-events:none;}
.hero-eyebrow{font-family:var(--font-mono);font-size:0.65rem;color:var(--accent);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px;}
.hero-title{font-family:var(--font-display);font-size:4rem;letter-spacing:2px;line-height:0.95;margin-bottom:14px;}
.hero-title .blue{color:var(--ai-col);}
.hero-sub{font-size:0.95rem;color:var(--text2);max-width:580px;line-height:1.7;font-weight:300;margin-bottom:28px;}
.hero-badges{display:flex;gap:10px;flex-wrap:wrap;}
.hb{display:flex;align-items:center;gap:6px;padding:6px 14px;border-radius:5px;font-family:var(--font-mono);font-size:0.68rem;letter-spacing:0.5px;border:1px solid;}
.hb-ai{background:var(--ai-bg);border-color:var(--ai-border);color:var(--ai-col);}
.hb-manual{background:var(--manual-bg);border-color:var(--manual-border);color:var(--manual-col);}
.hb-pre{background:var(--pre-bg);border-color:var(--pre-border);color:var(--pre-col);}
.hb-beckett{background:var(--beckett-bg);border-color:var(--beckett-border);color:var(--beckett-col);}

/* MAIN */
.main{max-width:1200px;margin:0 auto;padding:40px 40px 80px;}

/* HOW IT WORKS */
.how-section{margin-bottom:48px;}
.section-eyebrow{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;}
.section-title{font-family:var(--font-display);font-size:1.8rem;letter-spacing:1px;margin-bottom:20px;}
.steps-row{display:grid;grid-template-columns:repeat(4,1fr);gap:0;position:relative;}
.steps-row::before{content:'';position:absolute;top:28px;left:calc(12.5%);right:calc(12.5%);height:1px;background:var(--border2);z-index:0;}
.step-item{text-align:center;padding:0 12px;position:relative;z-index:1;}
.step-num{width:56px;height:56px;border-radius:50%;background:var(--surface);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-size:1.4rem;letter-spacing:1px;margin:0 auto 14px;color:var(--text2);transition:all 0.2s;}
.step-item.active .step-num{background:var(--accent);color:#08080d;border-color:var(--accent);box-shadow:0 0 20px var(--accent-glow);}
.step-label{font-size:0.82rem;font-weight:600;margin-bottom:4px;}
.step-desc{font-size:0.75rem;color:var(--text3);line-height:1.4;font-weight:300;}

/* SERVICES */
.services-section{margin-bottom:48px;}
.services-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;}

.service-card{border-radius:14px;padding:28px;border:1px solid;transition:all 0.2s;cursor:pointer;position:relative;overflow:hidden;}
.service-card::before{content:'';position:absolute;top:-60px;right:-60px;width:200px;height:200px;border-radius:50%;opacity:0.06;pointer-events:none;}
.service-card:hover{transform:translateY(-2px);}

.sc-ai{background:var(--ai-bg);border-color:var(--ai-border);}
.sc-ai::before{background:var(--ai-col);}
.sc-ai:hover{border-color:rgba(56,189,248,0.5);box-shadow:0 16px 32px rgba(56,189,248,0.06);}

.sc-manual{background:var(--manual-bg);border-color:var(--manual-border);}
.sc-manual::before{background:var(--manual-col);}
.sc-manual:hover{border-color:rgba(167,139,250,0.5);box-shadow:0 16px 32px rgba(167,139,250,0.06);}

.sc-pre{background:var(--pre-bg);border-color:var(--pre-border);}
.sc-pre::before{background:var(--pre-col);}
.sc-pre:hover{border-color:rgba(212,245,60,0.5);box-shadow:0 16px 32px rgba(212,245,60,0.06);}

.sc-beckett{background:var(--beckett-bg);border-color:var(--beckett-border);opacity:0.75;cursor:default;}
.sc-beckett:hover{transform:none;}

.svc-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;}
.svc-icon{font-size:2rem;}
.svc-badge{font-family:var(--font-mono);font-size:0.6rem;font-weight:700;letter-spacing:1px;padding:3px 10px;border-radius:3px;text-transform:uppercase;}
.badge-ai{background:var(--ai-bg);border:1px solid var(--ai-border);color:var(--ai-col);}
.badge-manual{background:var(--manual-bg);border:1px solid var(--manual-border);color:var(--manual-col);}
.badge-pre{background:var(--pre-bg);border:1px solid var(--pre-border);color:var(--pre-col);}
.badge-soon{background:var(--beckett-bg);border:1px solid var(--beckett-border);color:var(--beckett-col);}

.svc-title{font-family:var(--font-display);font-size:1.5rem;letter-spacing:1px;margin-bottom:6px;}
.svc-sub{font-size:0.82rem;color:var(--text2);line-height:1.6;font-weight:300;margin-bottom:20px;}

.svc-includes{margin-bottom:20px;}
.si-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px;}
.si-row{display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:0.8rem;color:var(--text2);}
.si-row::before{content:'‚úì';font-family:var(--font-mono);font-size:0.65rem;font-weight:700;flex-shrink:0;}
.sc-ai .si-row::before{color:var(--ai-col);}
.sc-manual .si-row::before{color:var(--manual-col);}
.sc-pre .si-row::before{color:var(--pre-col);}

.svc-pricing{border-top:1px solid;padding-top:16px;}
.sc-ai .svc-pricing{border-color:var(--ai-border);}
.sc-manual .svc-pricing{border-color:var(--manual-border);}
.sc-pre .svc-pricing{border-color:var(--pre-border);}
.sc-beckett .svc-pricing{border-color:var(--beckett-border);}

.price-rows{display:flex;flex-direction:column;gap:6px;margin-bottom:14px;}
.price-row{display:flex;justify-content:space-between;align-items:center;}
.pr-label{font-family:var(--font-mono);font-size:0.7rem;color:var(--text3);}
.pr-val{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;}
.sc-ai .pr-val{color:var(--ai-col);}
.sc-manual .pr-val{color:var(--manual-col);}
.sc-pre .pr-val{color:var(--pre-col);}
.sc-beckett .pr-val{color:var(--beckett-col);}
.pr-total{border-top:1px dashed;padding-top:6px;margin-top:4px;}
.sc-ai .pr-total{border-color:var(--ai-border);}
.sc-manual .pr-total{border-color:var(--manual-border);}
.sc-pre .pr-total{border-color:var(--pre-border);}
.pr-total .pr-label{color:var(--text);}
.pr-total .pr-val{font-size:1.4rem;}

.svc-delivery{display:flex;align-items:center;gap:6px;font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);margin-bottom:14px;letter-spacing:0.3px;}

.btn-svc{width:100%;padding:11px;border-radius:7px;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all 0.15s;border:1px solid;}
.btn-ai{background:var(--ai-col);border-color:var(--ai-col);color:#08080d;}
.btn-ai:hover{box-shadow:0 0 20px rgba(56,189,248,0.3);}
.btn-manual{background:var(--manual-col);border-color:var(--manual-col);color:#08080d;}
.btn-manual:hover{box-shadow:0 0 20px rgba(167,139,250,0.3);}
.btn-pre{background:var(--accent);border-color:var(--accent);color:#08080d;}
.btn-pre:hover{box-shadow:0 0 20px var(--accent-glow);}
.btn-soon{background:none;border-color:var(--beckett-border);color:var(--beckett-col);cursor:default;opacity:0.7;}

/* COMPARISON TABLE */
.compare-section{margin-bottom:48px;}
.compare-table{width:100%;border-collapse:collapse;background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;}
.compare-table th{padding:14px 18px;font-family:var(--font-mono);font-size:0.65rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;border-bottom:1px solid var(--border);}
.compare-table th:first-child{text-align:left;color:var(--text3);}
.compare-table th.th-ai{color:var(--ai-col);}
.compare-table th.th-manual{color:var(--manual-col);}
.compare-table th.th-pre{color:var(--pre-col);}
.compare-table th.th-beckett{color:var(--beckett-col);}
.compare-table td{padding:12px 18px;font-size:0.8rem;border-bottom:1px solid var(--border);text-align:center;font-family:var(--font-mono);}
.compare-table td:first-child{text-align:left;color:var(--text2);font-size:0.78rem;}
.compare-table tr:last-child td{border-bottom:none;}
.compare-table tr:hover td{background:var(--surface2);}
.ct-yes{color:var(--nm);}
.ct-no{color:var(--text3);}
.ct-soon{color:var(--beckett-col);font-size:0.65rem;}
.ct-val{color:var(--text);}

/* ADDRESS SECTION */
.address-section{margin-bottom:48px;}
.address-box{background:var(--surface);border:1px solid var(--border2);border-radius:12px;padding:28px;display:grid;grid-template-columns:1fr 1fr;gap:24px;}
.ab-left{}
.ab-eyebrow{font-family:var(--font-mono);font-size:0.62rem;color:var(--accent);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;}
.ab-title{font-family:var(--font-display);font-size:1.3rem;letter-spacing:1px;margin-bottom:12px;}
.ab-steps{display:flex;flex-direction:column;gap:10px;}
.abs-item{display:flex;align-items:flex-start;gap:12px;}
.abs-num{width:22px;height:22px;border-radius:50%;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.65rem;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;}
.abs-text{font-size:0.8rem;color:var(--text2);line-height:1.5;font-weight:300;}
.abs-text strong{color:var(--text);font-weight:600;}

.ab-right{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:22px;}
.addr-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;}
.addr-line{font-family:var(--font-mono);font-size:0.8rem;color:var(--text2);margin-bottom:4px;letter-spacing:0.3px;}
.addr-line strong{color:var(--text);font-size:0.88rem;}
.addr-note{margin-top:14px;padding:10px 12px;background:rgba(212,245,60,0.05);border:1px solid rgba(212,245,60,0.15);border-radius:6px;font-family:var(--font-mono);font-size:0.65rem;color:var(--accent);line-height:1.5;letter-spacing:0.3px;}
.btn-copy{margin-top:14px;width:100%;padding:9px;border:1px solid var(--border2);border-radius:6px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.68rem;font-weight:600;cursor:pointer;transition:all 0.15s;letter-spacing:0.5px;text-transform:uppercase;}
.btn-copy:hover{border-color:var(--accent);color:var(--accent);}
.btn-copy.copied{border-color:var(--nm);color:var(--nm);}

/* HISTORY */
.history-section{}
.history-table{width:100%;border-collapse:collapse;}
.ht-head th{padding:10px 14px;font-family:var(--font-mono);font-size:0.6rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);border-bottom:1px solid var(--border);text-align:left;}
.ht-row td{padding:12px 14px;font-size:0.8rem;border-bottom:1px solid var(--border);vertical-align:middle;}
.ht-row:last-child td{border-bottom:none;}
.ht-row:hover td{background:var(--surface);}
.ht-card{display:flex;align-items:center;gap:10px;}
.ht-thumb{width:28px;height:38px;object-fit:contain;border-radius:3px;background:var(--surface2);}
.ht-name{font-weight:600;font-size:0.82rem;}
.ht-set{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);margin-top:1px;}
.status-pill{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-family:var(--font-mono);font-size:0.62rem;font-weight:600;letter-spacing:0.5px;}
.status-ok{background:var(--nm-bg);border:1px solid rgba(46,213,115,0.2);color:var(--nm);}
.status-pending{background:var(--lp-bg);border:1px solid rgba(255,165,2,0.2);color:var(--lp);}
.status-transit{background:var(--ai-bg);border:1px solid var(--ai-border);color:var(--ai-col);}
.svc-tag{font-family:var(--font-mono);font-size:0.62rem;padding:2px 8px;border-radius:3px;}
.tag-ai{background:var(--ai-bg);color:var(--ai-col);}
.tag-manual{background:var(--manual-bg);color:var(--manual-col);}
.tag-pre{background:var(--pre-bg);color:var(--pre-col);}
.result-grade{font-family:var(--font-display);font-size:0.95rem;letter-spacing:0.5px;}
.rg-10{color:var(--accent);}
.rg-9{color:var(--ai-col);}
.rg-auth{color:var(--nm);}

/* Order modal */
.modal-overlay{position:fixed;inset:0;background:rgba(4,4,8,0.9);backdrop-filter:blur(16px);z-index:500;display:none;align-items:center;justify-content:center;padding:20px;}
.modal-overlay.open{display:flex;}
.modal{background:var(--surface);border:1px solid var(--border2);border-radius:14px;width:100%;max-width:500px;max-height:90vh;overflow-y:auto;animation:mIn 0.2s ease;}
@keyframes mIn{from{opacity:0;transform:scale(0.96)}to{opacity:1;transform:scale(1)}}
.modal-header{padding:24px 28px 0;}
.m-service-tag{display:inline-block;margin-bottom:10px;padding:3px 10px;border-radius:3px;font-family:var(--font-mono);font-size:0.62rem;font-weight:700;letter-spacing:1px;}
.modal-title{font-family:var(--font-display);font-size:1.6rem;letter-spacing:1px;margin-bottom:4px;}
.modal-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);margin-bottom:20px;}
.modal-body{padding:0 28px 28px;}
.form-group{margin-bottom:14px;}
.fg-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;display:block;}
.fg-input{width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:10px 14px;color:var(--text);font-family:var(--font-mono);font-size:0.82rem;outline:none;transition:border-color 0.15s;}
.fg-input:focus{border-color:var(--accent);}
.fg-input::placeholder{color:var(--text3);}
.fg-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.order-summary{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:16px;margin:16px 0;}
.os-title{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px;}
.os-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:0.72rem;}
.os-row:last-child{border-bottom:none;}
.os-label{color:var(--text3);}
.os-val{font-weight:500;}
.os-total .os-label{color:var(--text);font-weight:700;}
.os-total .os-val{color:var(--accent);font-size:0.88rem;}
.modal-btns{display:flex;gap:8px;margin-top:4px;}
.btn-cancel{flex:1;padding:11px;border:1px solid var(--border);border-radius:6px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;cursor:pointer;text-transform:uppercase;letter-spacing:0.5px;transition:all 0.15s;}
.btn-cancel:hover{border-color:var(--border2);color:var(--text2);}
.btn-confirm{flex:2;padding:11px;border:none;border-radius:6px;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:1px;transition:all 0.15s;}
.btn-confirm.ai{background:var(--ai-col);color:#08080d;}
.btn-confirm.manual{background:var(--manual-col);color:#08080d;}
.btn-confirm.pre{background:var(--accent);color:#08080d;}
.btn-confirm:hover{box-shadow:0 0 16px var(--accent-glow);}

/* Success */
.order-success{text-align:center;padding:20px 0 8px;}
.os-icon{font-size:3rem;margin-bottom:14px;}
.os-title2{font-family:var(--font-display);font-size:1.8rem;letter-spacing:2px;margin-bottom:8px;}
.os-sub{font-size:0.82rem;color:var(--text2);line-height:1.6;font-weight:300;}
.order-id{font-family:var(--font-mono);font-size:0.75rem;color:var(--accent);margin-top:10px;padding:6px 14px;background:var(--accent-dim);border:1px solid rgba(212,245,60,0.2);border-radius:4px;display:inline-block;}

@media(max-width:900px){
  nav{padding:0 18px;}
  .nav-pills{display:none;}
  .hero{padding:32px 18px 28px;}
  .main{padding:24px 18px 60px;}
  .services-grid{grid-template-columns:1fr;}
  .address-box{grid-template-columns:1fr;}
  .steps-row{grid-template-columns:repeat(2,1fr);gap:16px;}
  .steps-row::before{display:none;}
}
</style>
</head>
<body>

<nav>
  <div class="logo" onclick="window.location.href='pple-tcg.html'">PPLE<span class="dot">.</span>TCG</div>
  <div class="nav-pills">
    <button class="nav-tab" onclick="window.location.href='pple-tcg.html'">Mercado</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-vender.html'">Vender</button>
    <button class="nav-tab active">Verificaci√≥n</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-portfolio.html'">Portfolio</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-mensajes.html'">Mensajes</button>
  </div>
  <div class="nav-right">
    <button class="btn-accent" onclick="openOrderModal('ai')">Verificar carta</button>
  </div>
</nav>

<!-- HERO -->
<div class="hero">
  <div class="hero-glow"></div>
  <div class="hero-glow2"></div>
  <div class="hero-eyebrow">Autenticidad ¬∑ Pre-grading ¬∑ Gradeo</div>
  <div class="hero-title">VERIFICA.<br><span class="blue">CONF√çA.</span><br>VENDE M√ÅS.</div>
  <div class="hero-sub">Las cartas verificadas generan m√°s confianza y se venden m√°s r√°pido. Ofrecemos tres niveles de verificaci√≥n para cada necesidad, siempre pagado por el comprador.</div>
  <div class="hero-badges">
    <div class="hb hb-ai">ü§ñ Verificaci√≥n IA</div>
    <div class="hb hb-manual">üî¨ Verificaci√≥n Manual</div>
    <div class="hb hb-pre">üìä Pre-grading</div>
    <div class="hb hb-beckett">üèÖ Beckett ‚Äî Pr√≥ximamente</div>
  </div>
</div>

<div class="main">

  <!-- HOW IT WORKS -->
  <div class="how-section">
    <div class="section-eyebrow">Proceso</div>
    <div class="section-title">¬øC√ìMO FUNCIONA?</div>
    <div class="steps-row">
      <div class="step-item active">
        <div class="step-num">1</div>
        <div class="step-label">El comprador elige</div>
        <div class="step-desc">Al comprar una carta, el comprador selecciona el nivel de verificaci√≥n que quiere contrataci√≥n.</div>
      </div>
      <div class="step-item active">
        <div class="step-num">2</div>
        <div class="step-label">La carta llega a Pple.tcg</div>
        <div class="step-desc">El vendedor la env√≠a a nuestra direcci√≥n en Guadalajara. Acusamos recibo al recibir.</div>
      </div>
      <div class="step-item active">
        <div class="step-num">3</div>
        <div class="step-label">Verificamos</div>
        <div class="step-desc">IA autom√°tica o revisi√≥n manual seg√∫n el servicio. Resultado en 24-72h.</div>
      </div>
      <div class="step-item active">
        <div class="step-num">4</div>
        <div class="step-label">Enviamos al comprador</div>
        <div class="step-desc">La carta verificada se reenv√≠a al comprador con certificado digital incluido.</div>
      </div>
    </div>
  </div>

  <!-- SERVICES -->
  <div class="services-section">
    <div class="section-eyebrow">Servicios</div>
    <div class="section-title">ELIGE TU NIVEL</div>
    <div class="services-grid">

      <!-- AI -->
      <div class="service-card sc-ai" onclick="openOrderModal('ai')">
        <div class="svc-top">
          <div class="svc-icon">ü§ñ</div>
          <div class="svc-badge badge-ai">IA ¬∑ Autom√°tico</div>
        </div>
        <div class="svc-title">VERIFICACI√ìN IA</div>
        <div class="svc-sub">An√°lisis autom√°tico mediante inteligencia artificial. Detecta falsificaciones comparando con base de datos de referencia. El m√©todo m√°s r√°pido y econ√≥mico.</div>
        <div class="svc-includes">
          <div class="si-label">Incluye</div>
          <div class="si-row">An√°lisis IA de autenticidad</div>
          <div class="si-row">Certificado digital de autenticidad</div>
          <div class="si-row">Badge verificado en el anuncio</div>
          <div class="si-row">Resultado en 24h desde recepci√≥n</div>
        </div>
        <div class="svc-pricing">
          <div class="price-rows">
            <div class="price-row">
              <span class="pr-label">Servicio IA</span>
              <span class="pr-val">‚Ç¨X.XX</span>
            </div>
            <div class="price-row">
              <span class="pr-label">Env√≠o al comprador</span>
              <span class="pr-val">‚Ç¨X.XX</span>
            </div>
            <div class="price-row pr-total">
              <span class="pr-label">Total estimado</span>
              <span class="pr-val">Por definir</span>
            </div>
          </div>
          <div class="svc-delivery">‚è± Plazo estimado: 3‚Äì5 d√≠as h√°biles desde env√≠o</div>
          <button class="btn-svc btn-ai">Contratar verificaci√≥n IA ‚Üí</button>
        </div>
      </div>

      <!-- MANUAL -->
      <div class="service-card sc-manual" onclick="openOrderModal('manual')">
        <div class="svc-top">
          <div class="svc-icon">üî¨</div>
          <div class="svc-badge badge-manual">Manual ¬∑ Experto</div>
        </div>
        <div class="svc-title">VERIFICACI√ìN MANUAL</div>
        <div class="svc-sub">Revisi√≥n por un experto en TCG. Inspecci√≥n visual detallada de impresi√≥n, gramaje, textura y luminosidad. El est√°ndar m√°s fiable para cartas de alto valor.</div>
        <div class="svc-includes">
          <div class="si-label">Incluye</div>
          <div class="si-row">Revisi√≥n f√≠sica por experto certificado</div>
          <div class="si-row">Informe detallado de autenticidad</div>
          <div class="si-row">Certificado digital + f√≠sico</div>
          <div class="si-row">Badge verificado premium en el anuncio</div>
          <div class="si-row">Resultado en 48‚Äì72h desde recepci√≥n</div>
        </div>
        <div class="svc-pricing">
          <div class="price-rows">
            <div class="price-row">
              <span class="pr-label">Servicio manual</span>
              <span class="pr-val">‚Ç¨X.XX</span>
            </div>
            <div class="price-row">
              <span class="pr-label">Env√≠o al verificador</span>
              <span class="pr-val">‚Ç¨X.XX</span>
            </div>
            <div class="price-row">
              <span class="pr-label">Reenv√≠o al comprador</span>
              <span class="pr-val">‚Ç¨X.XX</span>
            </div>
            <div class="price-row pr-total">
              <span class="pr-label">Total estimado</span>
              <span class="pr-val">Por definir</span>
            </div>
          </div>
          <div class="svc-delivery">‚è± Plazo estimado: 5‚Äì8 d√≠as h√°biles desde env√≠o</div>
          <button class="btn-svc btn-manual">Contratar verificaci√≥n manual ‚Üí</button>
        </div>
      </div>

      <!-- PRE-GRADING -->
      <div class="service-card sc-pre" onclick="openOrderModal('pre')">
        <div class="svc-top">
          <div class="svc-icon">üìä</div>
          <div class="svc-badge badge-pre">Pre-grading ¬∑ An√°lisis</div>
        </div>
        <div class="svc-title">PRE-GRADING</div>
        <div class="svc-sub">Estimaci√≥n profesional del grado PSA antes de enviarla a gradear. Eval√∫a centering, esquinas, bordes y superficie. Evita enviar a PSA una carta que no llegar√° al grado esperado.</div>
        <div class="svc-includes">
          <div class="si-label">Incluye</div>
          <div class="si-row">Estimaci√≥n de grado PSA (8 / 9 / 10)</div>
          <div class="si-row">Informe de centering, esquinas, bordes y sup.</div>
          <div class="si-row">Recomendaci√≥n: enviar a PSA o no</div>
          <div class="si-row">Verificaci√≥n de autenticidad incluida</div>
          <div class="si-row">Resultado en 48h desde recepci√≥n</div>
        </div>
        <div class="svc-pricing">
          <div class="price-rows">
            <div class="price-row">
              <span class="pr-label">Pre-grading + autenticidad</span>
              <span class="pr-val">‚Ç¨X.XX</span>
            </div>
            <div class="price-row">
              <span class="pr-label">Env√≠o al comprador</span>
              <span class="pr-val">‚Ç¨X.XX</span>
            </div>
            <div class="price-row pr-total">
              <span class="pr-label">Total estimado</span>
              <span class="pr-val">Por definir</span>
            </div>
          </div>
          <div class="svc-delivery">‚è± Plazo estimado: 5‚Äì7 d√≠as h√°biles desde env√≠o</div>
          <button class="btn-svc btn-pre">Contratar pre-grading ‚Üí</button>
        </div>
      </div>

      <!-- BECKETT -->
      <div class="service-card sc-beckett">
        <div class="svc-top">
          <div class="svc-icon">üèÖ</div>
          <div class="svc-badge badge-soon">Pr√≥ximamente</div>
        </div>
        <div class="svc-title">GRADEO BECKETT</div>
        <div class="svc-sub">Gesti√≥n completa del env√≠o a Beckett Grading Services (BGS), la √∫nica empresa de gradeo con presencia en Europa. Pple.tcg se encarga de todo el proceso log√≠stico.</div>
        <div class="svc-includes">
          <div class="si-label">Incluir√°</div>
          <div class="si-row">Gesti√≥n completa del env√≠o a BGS Europa</div>
          <div class="si-row">Seguimiento en tiempo real</div>
          <div class="si-row">Seguro de env√≠o incluido</div>
          <div class="si-row">Subida autom√°tica al portfolio al recibir</div>
          <div class="si-row">Badge BGS en el anuncio de Pple.tcg</div>
        </div>
        <div class="svc-pricing">
          <div class="price-rows">
            <div class="price-row">
              <span class="pr-label">Gesti√≥n Pple.tcg</span>
              <span class="pr-val" style="color:var(--beckett-col)">Por definir</span>
            </div>
            <div class="price-row">
              <span class="pr-label">Tarifa BGS (no incluida)</span>
              <span class="pr-val" style="color:var(--beckett-col)">Seg√∫n servicio BGS</span>
            </div>
          </div>
          <div class="svc-delivery" style="color:var(--beckett-col);opacity:0.7">‚è± Disponible pr√≥ximamente</div>
          <button class="btn-svc btn-soon">Notificarme cuando est√© disponible</button>
        </div>
      </div>

    </div>
  </div>

  <!-- COMPARISON TABLE -->
  <div class="compare-section">
    <div class="section-eyebrow">Comparativa</div>
    <div class="section-title">¬øQU√â INCLUYE CADA SERVICIO?</div>
    <table class="compare-table">
      <thead>
        <tr>
          <th></th>
          <th class="th-ai">IA</th>
          <th class="th-manual">Manual</th>
          <th class="th-pre">Pre-grading</th>
          <th class="th-beckett">Beckett</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>Verificaci√≥n de autenticidad</td><td class="ct-yes">‚úì</td><td class="ct-yes">‚úì</td><td class="ct-yes">‚úì</td><td class="ct-soon">Pr√≥x.</td></tr>
        <tr><td>Revisi√≥n f√≠sica por experto</td><td class="ct-no">‚Äî</td><td class="ct-yes">‚úì</td><td class="ct-yes">‚úì</td><td class="ct-soon">Pr√≥x.</td></tr>
        <tr><td>Certificado digital</td><td class="ct-yes">‚úì</td><td class="ct-yes">‚úì</td><td class="ct-yes">‚úì</td><td class="ct-soon">Pr√≥x.</td></tr>
        <tr><td>Estimaci√≥n de grado PSA</td><td class="ct-no">‚Äî</td><td class="ct-no">‚Äî</td><td class="ct-yes">‚úì</td><td class="ct-soon">Pr√≥x.</td></tr>
        <tr><td>Informe centering / esquinas</td><td class="ct-no">‚Äî</td><td class="ct-no">‚Äî</td><td class="ct-yes">‚úì</td><td class="ct-soon">Pr√≥x.</td></tr>
        <tr><td>Gradeo oficial certificado</td><td class="ct-no">‚Äî</td><td class="ct-no">‚Äî</td><td class="ct-no">‚Äî</td><td class="ct-soon">Pr√≥x.</td></tr>
        <tr><td>Badge en el anuncio</td><td class="ct-yes">Verificado</td><td class="ct-yes">Verificado ‚òÖ</td><td class="ct-yes">Pre-graded</td><td class="ct-soon">BGS</td></tr>
        <tr><td>Plazo estimado</td><td class="ct-val">3‚Äì5 d√≠as</td><td class="ct-val">5‚Äì8 d√≠as</td><td class="ct-val">5‚Äì7 d√≠as</td><td class="ct-soon">Por definir</td></tr>
        <tr><td>Precio</td><td class="ct-val" style="color:var(--ai-col)">Por definir</td><td class="ct-val" style="color:var(--manual-col)">Por definir</td><td class="ct-val" style="color:var(--pre-col)">Por definir</td><td class="ct-soon">Por definir</td></tr>
      </tbody>
    </table>
  </div>

  <!-- ADDRESS & SENDING -->
  <div class="address-section">
    <div class="section-eyebrow">Log√≠stica</div>
    <div class="section-title">¬øC√ìMO ENVIAR TU CARTA?</div>
    <div class="address-box">
      <div class="ab-left">
        <div class="ab-eyebrow">Pasos para el vendedor</div>
        <div class="ab-title">PREPARAR EL ENV√çO</div>
        <div class="ab-steps">
          <div class="abs-item">
            <div class="abs-num">1</div>
            <div class="abs-text">Introduce la carta en un <strong>toploader r√≠gido</strong> y prot√©gela con pl√°stico de burbujas.</div>
          </div>
          <div class="abs-item">
            <div class="abs-num">2</div>
            <div class="abs-text">Incluye dentro del paquete una <strong>nota con tu n√∫mero de pedido</strong> ‚Äî lo recibir√°s al contratar el servicio.</div>
          </div>
          <div class="abs-item">
            <div class="abs-num">3</div>
            <div class="abs-text">Env√≠a por <strong>carta certificada o paquete con seguimiento</strong> a la direcci√≥n de Pple.tcg.</div>
          </div>
          <div class="abs-item">
            <div class="abs-num">4</div>
            <div class="abs-text">Cuando la recibamos te <strong>notificamos por email</strong> y empezamos el proceso.</div>
          </div>
        </div>
      </div>
      <div class="ab-right">
        <div class="addr-label">Direcci√≥n de env√≠o</div>
        <div class="addr-line"><strong>PPLE.TCG ‚Äî Verificaci√≥n</strong></div>
        <div class="addr-line">C/ [Por definir], [N¬∫]</div>
        <div class="addr-line">19XXX ‚Äî Guadalajara</div>
        <div class="addr-line">Castilla-La Mancha, Espa√±a</div>
        <div class="addr-note">‚ö† Incluye siempre tu n√∫mero de pedido en el interior del paquete. Sin √©l no podremos identificar tu carta.</div>
        <button class="btn-copy" id="btnCopy" onclick="copyAddress()">Copiar direcci√≥n</button>
      </div>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="history-section">
    <div class="section-eyebrow">Tu historial</div>
    <div class="section-title">VERIFICACIONES RECIENTES</div>
    <table class="history-table">
      <thead class="ht-head">
        <tr>
          <th>Carta</th>
          <th>Servicio</th>
          <th>Estado</th>
          <th>Resultado</th>
          <th>Fecha</th>
          <th>Pedido</th>
        </tr>
      </thead>
      <tbody>
        <tr class="ht-row">
          <td>
            <div class="ht-card">
              <img class="ht-thumb" src="https://assets.tcgdex.net/univ/sv/sv03/3/high.png" onerror="this.style.display='none'" alt="">
              <div><div class="ht-name">Charizard ex</div><div class="ht-set">Obsidian Flames</div></div>
            </div>
          </td>
          <td><span class="svc-tag tag-manual">Manual</span></td>
          <td><span class="status-pill status-ok">‚úì Completado</span></td>
          <td><span class="result-grade rg-auth">‚úì Aut√©ntica</span></td>
          <td><span style="font-family:var(--font-mono);font-size:0.72rem;color:var(--text3)">14 Feb 2026</span></td>
          <td><span style="font-family:var(--font-mono);font-size:0.65rem;color:var(--accent)">#VRF-00124</span></td>
        </tr>
        <tr class="ht-row">
          <td>
            <div class="ht-card">
              <img class="ht-thumb" src="https://assets.tcgdex.net/univ/sv/sv3pt5/11/high.png" onerror="this.style.display='none'" alt="">
              <div><div class="ht-name">Mewtwo ex</div><div class="ht-set">151</div></div>
            </div>
          </td>
          <td><span class="svc-tag tag-pre">Pre-grading</span></td>
          <td><span class="status-pill status-ok">‚úì Completado</span></td>
          <td><span class="result-grade rg-10">PSA 10 est.</span></td>
          <td><span style="font-family:var(--font-mono);font-size:0.72rem;color:var(--text3)">2 Feb 2026</span></td>
          <td><span style="font-family:var(--font-mono);font-size:0.65rem;color:var(--accent)">#VRF-00098</span></td>
        </tr>
        <tr class="ht-row">
          <td>
            <div class="ht-card">
              <img class="ht-thumb" src="https://assets.tcgdex.net/univ/sv/sv02/83/high.png" onerror="this.style.display='none'" alt="">
              <div><div class="ht-name">Pikachu ex</div><div class="ht-set">Paldea Evolved</div></div>
            </div>
          </td>
          <td><span class="svc-tag tag-ai">IA</span></td>
          <td><span class="status-pill status-transit">‚úà En tr√°nsito</span></td>
          <td><span style="font-family:var(--font-mono);font-size:0.65rem;color:var(--text3)">Pendiente</span></td>
          <td><span style="font-family:var(--font-mono);font-size:0.72rem;color:var(--text3)">25 Feb 2026</span></td>
          <td><span style="font-family:var(--font-mono);font-size:0.65rem;color:var(--accent)">#VRF-00201</span></td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

<!-- ORDER MODAL -->
<div class="modal-overlay" id="orderModal" onclick="closeModal(event)">
  <div class="modal">
    <div class="modal-header">
      <div class="m-service-tag" id="mServiceTag"></div>
      <div class="modal-title" id="mTitle">CONTRATAR SERVICIO</div>
      <div class="modal-sub" id="mSub">Rellena los datos para tramitar tu pedido</div>
    </div>
    <div class="modal-body" id="modalBody">
      <div id="orderForm">
        <div class="form-group">
          <label class="fg-label">Nombre de la carta</label>
          <input class="fg-input" type="text" id="mCardName" placeholder="Ej: Charizard ex ‚Äî Obsidian Flames">
        </div>
        <div class="fg-row">
          <div class="form-group">
            <label class="fg-label">Nombre completo</label>
            <input class="fg-input" type="text" id="mName" placeholder="Juan Garc√≠a">
          </div>
          <div class="form-group">
            <label class="fg-label">Email</label>
            <input class="fg-input" type="email" id="mEmail" placeholder="tu@email.com">
          </div>
        </div>
        <div class="form-group">
          <label class="fg-label">Direcci√≥n de reenv√≠o (para devolver la carta)</label>
          <input class="fg-input" type="text" id="mAddress" placeholder="Calle Mayor 42, 3¬∫A, 28001 Madrid">
        </div>
        <div class="order-summary" id="orderSummary"></div>
        <div class="modal-btns">
          <button class="btn-cancel" onclick="document.getElementById('orderModal').classList.remove('open')">Cancelar</button>
          <button class="btn-confirm" id="btnConfirm" onclick="confirmOrder()">Confirmar pedido ‚Üí</button>
        </div>
      </div>
      <div id="orderSuccess" style="display:none">
        <div class="order-success">
          <div class="os-icon">‚úÖ</div>
          <div class="os-title2">¬°PEDIDO RECIBIDO!</div>
          <div class="os-sub">Recibir√°s un email con la direcci√≥n de env√≠o y las instrucciones. En cuanto llegue tu carta, te notificamos.</div>
          <div class="order-id" id="orderId">#VRF-00000</div>
        </div>
        <div class="modal-btns" style="margin-top:20px">
          <button class="btn-cancel" onclick="document.getElementById('orderModal').classList.remove('open')">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const SERVICES = {
  ai:     { label:'IA ¬∑ Autom√°tico',  color:'var(--ai-col)',     tagClass:'badge-ai',     btnClass:'ai',     title:'VERIFICACI√ìN IA',     sub:'An√°lisis autom√°tico de autenticidad' },
  manual: { label:'Manual ¬∑ Experto', color:'var(--manual-col)', tagClass:'badge-manual', btnClass:'manual', title:'VERIFICACI√ìN MANUAL',  sub:'Revisi√≥n f√≠sica por experto certificado' },
  pre:    { label:'Pre-grading',      color:'var(--pre-col)',     tagClass:'badge-pre',    btnClass:'pre',    title:'PRE-GRADING',          sub:'Estimaci√≥n de grado PSA antes de enviar a gradear' },
};

let currentService = 'ai';

function openOrderModal(svc) {
  currentService = svc;
  const s = SERVICES[svc];
  document.getElementById('orderModal').classList.add('open');
  document.getElementById('orderForm').style.display = 'block';
  document.getElementById('orderSuccess').style.display = 'none';
  const tag = document.getElementById('mServiceTag');
  tag.textContent = s.label;
  tag.className = 'm-service-tag ' + s.tagClass;
  document.getElementById('mTitle').textContent = s.title;
  document.getElementById('mSub').textContent = s.sub;
  const btn = document.getElementById('btnConfirm');
  btn.className = 'btn-confirm ' + s.btnClass;
  buildOrderSummary(svc);
}

function buildOrderSummary(svc) {
  const rows = {
    ai:     [['Servicio IA','Por definir'],['Env√≠o al comprador','Por definir']],
    manual: [['Servicio manual','Por definir'],['Env√≠o al verificador','Por definir'],['Reenv√≠o al comprador','Por definir']],
    pre:    [['Pre-grading + autenticidad','Por definir'],['Env√≠o al comprador','Por definir']],
  };
  const r = rows[svc];
  document.getElementById('orderSummary').innerHTML = `
    <div class="os-title">Resumen del pedido</div>
    ${r.map(([l,v])=>`<div class="os-row"><span class="os-label">${l}</span><span class="os-val">${v}</span></div>`).join('')}
    <div class="os-row os-total"><span class="os-label">Total</span><span class="os-val">Por definir</span></div>`;
}

function closeModal(e) {
  if (e.target === document.getElementById('orderModal'))
    document.getElementById('orderModal').classList.remove('open');
}

function confirmOrder() {
  const name = document.getElementById('mName').value;
  const email = document.getElementById('mEmail').value;
  if (!name || !email) { alert('Rellena nombre y email para continuar.'); return; }
  document.getElementById('orderForm').style.display = 'none';
  document.getElementById('orderSuccess').style.display = 'block';
  const id = '#VRF-' + String(Math.floor(Math.random()*9000)+1000).padStart(5,'0');
  document.getElementById('orderId').textContent = id;
}

function copyAddress() {
  const addr = 'PPLE.TCG ‚Äî Verificaci√≥n\nC/ [Por definir]\n19XXX ‚Äî Guadalajara\nCastilla-La Mancha, Espa√±a';
  navigator.clipboard.writeText(addr).then(() => {
    const btn = document.getElementById('btnCopy');
    btn.textContent = '‚úì Copiado';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'Copiar direcci√≥n'; btn.classList.remove('copied'); }, 2000);
  });
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #08080d;
  --bg2: #0e0e16;
  --surface: #11111c;
  --surface2: #181825;
  --border: #22223a;
  --border2: #2d2d4a;
  --accent: #d4f53c;
  --accent-glow: rgba(212,245,60,0.15);
  --accent-dim: rgba(212,245,60,0.06);
  --red: #ff4757;
  --green: #2ed573;
  --yellow: #ffa502;
  --text: #eeeef8;
  --text2: #9898b8;
  --text3: #55556a;
  --nm: #2ed573;
  --lp: #ffa502;
  --mp: #ff4757;
  --nm-bg: rgba(46,213,115,0.08);
  --lp-bg: rgba(255,165,2,0.08);
  --mp-bg: rgba(255,71,87,0.08);
  --font-display: 'Bebas Neue', sans-serif;
  --font-mono: 'DM Mono', monospace;
  --font-body: 'Plus Jakarta Sans', sans-serif;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* GRAIN OVERLAY */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 9999;
  mix-blend-mode: overlay;
}

/* SCROLLBAR */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

/* ===== NAV ===== */
nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 40px;
  height: 60px;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  background: rgba(8,8,13,0.95);
  backdrop-filter: blur(24px);
  z-index: 100;
}

.logo {
  font-family: var(--font-display);
  font-size: 1.8rem;
  letter-spacing: 3px;
  color: var(--text);
  line-height: 1;
}
.logo .dot { color: var(--accent); }

.nav-center {
  display: flex;
  gap: 0;
  border: 1px solid var(--border);
  border-radius: 6px;
  overflow: hidden;
}
.nav-tab {
  padding: 7px 22px;
  font-family: var(--font-mono);
  font-size: 0.72rem;
  font-weight: 500;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--text2);
  cursor: pointer;
  border: none;
  background: none;
  border-right: 1px solid var(--border);
  transition: all 0.15s;
}
.nav-tab:last-child { border-right: none; }
.nav-tab:hover { background: var(--surface); color: var(--text); }
.nav-tab.active { background: var(--accent); color: #08080d; font-weight: 700; }

.nav-right { display: flex; gap: 10px; align-items: center; }

.live-dot {
  display: flex;
  align-items: center;
  gap: 6px;
  font-family: var(--font-mono);
  font-size: 0.68rem;
  color: var(--nm);
  letter-spacing: 0.5px;
}
.live-dot::before {
  content: '';
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--nm);
  animation: pulse 2s infinite;
  box-shadow: 0 0 6px var(--nm);
}
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

.btn-outline {
  padding: 7px 16px;
  border: 1px solid var(--border2);
  border-radius: 5px;
  background: none;
  color: var(--text2);
  font-family: var(--font-mono);
  font-size: 0.72rem;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 0.15s;
}
.btn-outline:hover { border-color: var(--accent); color: var(--accent); }

.btn-accent {
  padding: 7px 18px;
  border: none;
  border-radius: 5px;
  background: var(--accent);
  color: #08080d;
  font-family: var(--font-mono);
  font-size: 0.72rem;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
}
.btn-accent:hover { box-shadow: 0 0 20px var(--accent-glow); transform: translateY(-1px); }

/* ===== TICKER ===== */
.ticker-wrap {
  border-bottom: 1px solid var(--border);
  overflow: hidden;
  height: 34px;
  display: flex;
  align-items: center;
  background: var(--bg2);
}
.ticker-label {
  padding: 0 16px;
  font-family: var(--font-mono);
  font-size: 0.65rem;
  color: var(--accent);
  letter-spacing: 2px;
  text-transform: uppercase;
  border-right: 1px solid var(--border);
  white-space: nowrap;
  height: 100%;
  display: flex;
  align-items: center;
  flex-shrink: 0;
}
.ticker-scroll {
  display: flex;
  gap: 0;
  animation: ticker 30s linear infinite;
  white-space: nowrap;
}
@keyframes ticker { 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }
.ticker-item {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 0 24px;
  font-family: var(--font-mono);
  font-size: 0.68rem;
  border-right: 1px solid var(--border);
  height: 34px;
}
.ticker-name { color: var(--text2); }
.ticker-price { color: var(--text); font-weight: 500; }
.ticker-up { color: var(--nm); }
.ticker-down { color: var(--mp); }

/* ===== HERO ===== */
.hero {
  display: grid;
  grid-template-columns: 1fr 420px;
  min-height: 380px;
  border-bottom: 1px solid var(--border);
  max-width: 100%;
}

.hero-left {
  padding: 48px 48px 48px 40px;
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  position: relative;
  overflow: hidden;
}

/* Diagonal accent line */
.hero-left::before {
  content: '';
  position: absolute;
  top: -40px; right: -40px;
  width: 300px; height: 300px;
  background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
  pointer-events: none;
}

.hero-eyebrow {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}
.eyebrow-tag {
  font-family: var(--font-mono);
  font-size: 0.68rem;
  color: var(--accent);
  letter-spacing: 2px;
  text-transform: uppercase;
  border: 1px solid rgba(212,245,60,0.3);
  padding: 3px 10px;
  border-radius: 3px;
}
.eyebrow-tag2 {
  font-family: var(--font-mono);
  font-size: 0.68rem;
  color: var(--text3);
  letter-spacing: 1px;
}

.hero-headline {
  font-family: var(--font-display);
  font-size: 5.5rem;
  line-height: 0.92;
  letter-spacing: 2px;
  color: var(--text);
  margin-bottom: 24px;
}
.hero-headline .line2 { color: var(--accent); }

.hero-desc {
  font-size: 0.9rem;
  color: var(--text2);
  line-height: 1.7;
  max-width: 480px;
  margin-bottom: 32px;
  font-weight: 300;
}

.hero-kpis {
  display: flex;
  gap: 0;
  border: 1px solid var(--border);
  border-radius: 6px;
  overflow: hidden;
  width: fit-content;
}
.kpi {
  padding: 14px 24px;
  border-right: 1px solid var(--border);
  text-align: center;
}
.kpi:last-child { border-right: none; }
.kpi-val {
  font-family: var(--font-display);
  font-size: 2rem;
  letter-spacing: 1px;
  color: var(--accent);
  line-height: 1;
}
.kpi-label {
  font-family: var(--font-mono);
  font-size: 0.62rem;
  color: var(--text3);
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-top: 4px;
}

/* Hero right ‚Äî featured card */
.hero-right {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 32px;
  background: var(--bg2);
  position: relative;
  overflow: hidden;
}
.hero-right::before {
  content: '';
  position: absolute;
  bottom: -60px; left: -60px;
  width: 250px; height: 250px;
  background: radial-gradient(circle, rgba(212,245,60,0.06) 0%, transparent 70%);
}

.featured-card {
  width: 220px;
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 32px 64px rgba(0,0,0,0.6), 0 0 0 1px rgba(212,245,60,0.1);
  transition: transform 0.3s ease;
}
.featured-card:hover { transform: translateY(-6px) rotate(1deg); }

.fc-img {
  width: 100%; height: 175px;
  background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
  display: flex; align-items: center; justify-content: center;
  font-size: 2.5rem;
  overflow: hidden;
  position: relative;
}
.fc-img img { width:100%; height:100%; object-fit:contain; padding:6px; }
.fc-img::after {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(180deg, transparent 50%, rgba(17,17,28,0.8) 100%);
}

.fc-body { padding: 14px; }
.fc-name {
  font-family: var(--font-display);
  font-size: 1.1rem;
  letter-spacing: 1px;
  margin-bottom: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.fc-set {
  font-family: var(--font-mono);
  font-size: 0.62rem;
  color: var(--text3);
  margin-bottom: 12px;
  letter-spacing: 0.5px;
}
.fc-price-row { display: flex; justify-content: space-between; align-items: baseline; }
.fc-price {
  font-family: var(--font-display);
  font-size: 1.8rem;
  letter-spacing: 1px;
  color: var(--accent);
}
.fc-chg {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  font-weight: 500;
}

/* ===== MAIN LAYOUT ===== */
.layout {
  display: grid;
  grid-template-columns: 260px 1fr;
  min-height: calc(100vh - 60px - 34px - 380px);
}

/* ===== SIDEBAR ===== */
.sidebar {
  border-right: 1px solid var(--border);
  padding: 20px 0;
  position: sticky;
  top: 60px;
  height: calc(100vh - 60px);
  overflow-y: auto;
}

.sidebar-section {
  padding: 0 16px;
  margin-bottom: 24px;
}

.sidebar-title {
  font-family: var(--font-mono);
  font-size: 0.62rem;
  color: var(--text3);
  letter-spacing: 2px;
  text-transform: uppercase;
  padding: 0 4px;
  margin-bottom: 10px;
}

.col-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s;
  margin-bottom: 2px;
  border: 1px solid transparent;
}
.col-item:hover { background: var(--surface); border-color: var(--border); }
.col-item.active {
  background: var(--accent-dim);
  border-color: rgba(212,245,60,0.2);
}
.col-item.active .ci-name { color: var(--accent); }

.ci-logo {
  width: 28px; height: 28px;
  object-fit: contain;
  flex-shrink: 0;
  opacity: 0.8;
}
.ci-info { flex: 1; min-width: 0; }
.ci-name {
  font-size: 0.78rem;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-bottom: 1px;
}
.ci-count {
  font-family: var(--font-mono);
  font-size: 0.62rem;
  color: var(--text3);
}

/* STATUS bar in sidebar */
.status-pill {
  margin: 0 16px 20px;
  padding: 8px 12px;
  border-radius: 6px;
  font-family: var(--font-mono);
  font-size: 0.68rem;
  display: flex;
  align-items: center;
  gap: 8px;
  letter-spacing: 0.3px;
}
.s-loading { background: var(--accent-dim); border: 1px solid rgba(212,245,60,0.15); color: var(--accent); }
.s-ok { background: var(--nm-bg); border: 1px solid rgba(46,213,115,0.15); color: var(--nm); }
.s-err { background: var(--mp-bg); border: 1px solid rgba(255,71,87,0.15); color: var(--mp); }
.spin { animation: spin 1s linear infinite; display: inline-block; }
@keyframes spin { to { transform: rotate(360deg); } }

/* ===== CONTENT ===== */
.content { padding: 0; }

/* TOOLBAR */
.toolbar {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 14px 24px;
  border-bottom: 1px solid var(--border);
  background: var(--bg2);
  flex-wrap: wrap;
}

.toolbar-title {
  font-family: var(--font-display);
  font-size: 1.3rem;
  letter-spacing: 2px;
  margin-right: 4px;
}

.toolbar-count {
  font-family: var(--font-mono);
  font-size: 0.68rem;
  color: var(--text3);
  letter-spacing: 1px;
  margin-right: 8px;
}

.sep { width: 1px; height: 20px; background: var(--border); margin: 0 4px; }

.cond-btn {
  padding: 5px 12px;
  border-radius: 4px;
  border: 1px solid var(--border);
  background: none;
  font-family: var(--font-mono);
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.15s;
  color: var(--text3);
}
.cond-btn:hover { border-color: var(--border2); color: var(--text2); }
.c-all  { border-color: var(--border2); color: var(--text2); }
.c-nm   { border-color: var(--nm); color: var(--nm); background: var(--nm-bg); }
.c-lp   { border-color: var(--lp); color: var(--lp); background: var(--lp-bg); }
.c-mp   { border-color: var(--mp); color: var(--mp); background: var(--mp-bg); }

.search-wrap { margin-left: auto; position: relative; }
.search-wrap input {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 5px;
  padding: 7px 14px 7px 32px;
  color: var(--text);
  font-family: var(--font-mono);
  font-size: 0.75rem;
  width: 200px;
  outline: none;
  transition: border-color 0.15s;
  letter-spacing: 0.3px;
}
.search-wrap input:focus { border-color: var(--accent); }
.search-wrap input::placeholder { color: var(--text3); }
.search-icon {
  position: absolute;
  left: 10px; top: 50%;
  transform: translateY(-50%);
  color: var(--text3);
  font-size: 0.75rem;
  pointer-events: none;
}

/* ===== CARDS GRID ===== */
.cards-area { padding: 20px 24px; }

.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(185px, 1fr));
  gap: 12px;
}

.card-item {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}
.card-item:hover {
  border-color: var(--border2);
  transform: translateY(-3px);
  box-shadow: 0 16px 32px rgba(0,0,0,0.5), 0 0 0 1px rgba(212,245,60,0.08);
}

.card-img {
  width: 100%; height: 145px;
  background: linear-gradient(135deg, #13132a, #1a1a35, #131328);
  display: flex; align-items: center; justify-content: center;
  font-size: 2.5rem;
  overflow: hidden;
  position: relative;
}
.card-img img { width:100%; height:100%; object-fit:contain; padding:4px; }

/* rank badge top left */
.card-rank {
  position: absolute;
  top: 7px; left: 7px;
  background: rgba(8,8,13,0.85);
  border: 1px solid var(--border2);
  border-radius: 4px;
  padding: 2px 7px;
  font-family: var(--font-mono);
  font-size: 0.6rem;
  color: var(--text3);
  backdrop-filter: blur(8px);
}

.card-body { padding: 11px 12px; }
.card-name {
  font-family: var(--font-display);
  font-size: 0.95rem;
  letter-spacing: 0.5px;
  margin-bottom: 1px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.card-num {
  font-family: var(--font-mono);
  font-size: 0.62rem;
  color: var(--text3);
  margin-bottom: 9px;
  letter-spacing: 0.5px;
}
.card-footer { display: flex; justify-content: space-between; align-items: center; margin-bottom: 7px; }
.card-price {
  font-family: var(--font-display);
  font-size: 1.15rem;
  letter-spacing: 0.5px;
  color: var(--text);
}
.card-price.no-data {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: var(--text3);
}
.card-chg {
  font-family: var(--font-mono);
  font-size: 0.65rem;
  font-weight: 500;
  padding: 2px 6px;
  border-radius: 3px;
  letter-spacing: 0.3px;
}
.chg-up { background: var(--nm-bg); color: var(--nm); }
.chg-down { background: var(--mp-bg); color: var(--mp); }
.chg-flat { color: var(--text3); }

/* Display toggle */
.disp-active { border-color: var(--accent) !important; color: var(--accent) !important; background: var(--accent-dim) !important; }

/* PSA grade buttons */
.psa10 { border-color: #d4f53c; color: #d4f53c; background: rgba(212,245,60,0.07); }
.psa9  { border-color: #38bdf8; color: #38bdf8; background: rgba(56,189,248,0.07); }
.psa8  { border-color: #a78bfa; color: #a78bfa; background: rgba(167,139,250,0.07); }
.psa10.grade-active { background: rgba(212,245,60,0.18); }
.psa9.grade-active  { background: rgba(56,189,248,0.18); }
.psa8.grade-active  { background: rgba(167,139,250,0.18); }

/* Slab card badge */
.slab-badge {
  position: absolute; top: 7px; left: 7px;
  display: flex; align-items: center; gap: 4px;
  border-radius: 4px; padding: 3px 8px;
  font-family: var(--font-mono); font-size: 0.62rem; font-weight: 700; letter-spacing: 0.5px;
  backdrop-filter: blur(8px);
}
.slab-10 { background: rgba(212,245,60,0.18); border: 1px solid rgba(212,245,60,0.4); color: #d4f53c; }
.slab-9  { background: rgba(56,189,248,0.15); border: 1px solid rgba(56,189,248,0.35); color: #38bdf8; }
.slab-8  { background: rgba(167,139,250,0.15); border: 1px solid rgba(167,139,250,0.35); color: #a78bfa; }

/* RAW condition badge on card */
.raw-badge {
  position: absolute; top: 7px; left: 7px;
  border-radius: 4px; padding: 2px 7px;
  font-family: var(--font-mono); font-size: 0.62rem; font-weight: 700; letter-spacing: 0.5px;
  backdrop-filter: blur(8px);
}
.raw-nm { background: rgba(46,213,115,0.15); border: 1px solid rgba(46,213,115,0.3); color: var(--nm); }
.raw-lp { background: rgba(255,165,2,0.15); border: 1px solid rgba(255,165,2,0.3); color: var(--lp); }
.raw-mp { background: rgba(255,71,87,0.15); border: 1px solid rgba(255,71,87,0.3); color: var(--mp); }

/* Slab card shimmer gold frame effect */
.card-item.is-slab { border-color: rgba(212,245,60,0.15); }
.card-item.is-slab:hover { border-color: rgba(212,245,60,0.5); box-shadow: 0 16px 32px rgba(0,0,0,0.5), 0 0 20px rgba(212,245,60,0.08); }

/* price strip */
.price-strip {
  display: flex;
  gap: 4px;
  border-top: 1px solid var(--border);
  padding-top: 7px;
  margin-top: 2px;
}
.psi {
  flex: 1; text-align: center;
  background: var(--bg2);
  border-radius: 3px;
  padding: 4px 2px;
}
.psi-label {
  font-family: var(--font-mono);
  font-size: 0.55rem;
  color: var(--text3);
  letter-spacing: 1px;
  text-transform: uppercase;
}
.psi-val {
  font-family: var(--font-mono);
  font-size: 0.68rem;
  font-weight: 500;
  margin-top: 2px;
}

/* SHIMMER */
.shimmer {
  background: linear-gradient(90deg, var(--surface) 25%, var(--surface2) 50%, var(--surface) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 6px;
}
@keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

/* PAGINATION */
.pagination {
  display: flex;
  justify-content: center;
  gap: 5px;
  padding: 24px;
  flex-wrap: wrap;
}
.page-btn {
  padding: 6px 12px;
  border-radius: 4px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text3);
  font-family: var(--font-mono);
  font-size: 0.72rem;
  cursor: pointer;
  transition: all 0.15s;
  letter-spacing: 0.3px;
}
.page-btn:hover:not(:disabled), .page-btn.active {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-dim);
}
.page-btn:disabled { opacity: 0.3; cursor: not-allowed; }

/* ===== MODAL ===== */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(4,4,8,0.92);
  backdrop-filter: blur(16px);
  z-index: 500;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.modal-overlay.open { display: flex; }

.modal {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 14px;
  width: 100%;
  max-width: 900px;
  max-height: 92vh;
  overflow-y: auto;
  display: grid;
  grid-template-columns: 280px 1fr;
  box-shadow: 0 40px 80px rgba(0,0,0,0.7);
  animation: mIn 0.25s ease;
}
@keyframes mIn { from{opacity:0;transform:scale(0.96) translateY(12px)} to{opacity:1;transform:scale(1) translateY(0)} }

.modal-left {
  padding: 28px 22px;
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.m-card-img {
  width: 100%;
  aspect-ratio: 2.5/3.5;
  background: linear-gradient(135deg, #13132a, #1a1a35, #0f1628);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 4rem;
  overflow: hidden;
  border: 1px solid var(--border);
}
.m-card-img img { width:100%; height:100%; object-fit:contain; padding:10px; }

.m-card-name {
  font-family: var(--font-display);
  font-size: 1.3rem;
  letter-spacing: 1px;
  line-height: 1.1;
}
.m-card-set {
  font-family: var(--font-mono);
  font-size: 0.68rem;
  color: var(--text3);
  letter-spacing: 0.5px;
}

.cond-strip { display: flex; gap: 6px; }

/* price detail box */
.price-box {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 14px;
}
.price-box-title {
  font-family: var(--font-mono);
  font-size: 0.6rem;
  color: var(--text3);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 11px;
}
.pb-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 0;
  border-bottom: 1px solid var(--border);
}
.pb-row:last-child { border-bottom: none; }
.pb-label { font-family: var(--font-mono); font-size: 0.68rem; color: var(--text3); }
.pb-val { font-family: var(--font-mono); font-size: 0.75rem; font-weight: 500; }
.pb-val.up { color: var(--nm); }
.pb-val.down { color: var(--mp); }
.cm-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  border: 1px solid rgba(212,245,60,0.2);
  background: var(--accent-dim);
  border-radius: 3px;
  padding: 3px 8px;
  font-family: var(--font-mono);
  font-size: 0.6rem;
  color: var(--accent);
  letter-spacing: 0.5px;
  margin-top: 10px;
  width: fit-content;
}

/* modal right */
.modal-right { padding: 28px; }

.m-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--border);
}

.m-price-wrap {}
.m-price-label {
  font-family: var(--font-mono);
  font-size: 0.62rem;
  color: var(--text3);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 4px;
}
.m-price {
  font-family: var(--font-display);
  font-size: 3.2rem;
  letter-spacing: 2px;
  color: var(--text);
  line-height: 1;
  margin-bottom: 5px;
}
.m-price.no-data { font-size: 1.5rem; color: var(--text3); font-family: var(--font-mono); }
.m-chg { font-family: var(--font-mono); font-size: 0.75rem; font-weight: 500; }

.m-close {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 6px;
  width: 32px; height: 32px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  color: var(--text3);
  font-size: 0.9rem;
  transition: all 0.15s;
  flex-shrink: 0;
}
.m-close:hover { color: var(--text); border-color: var(--border2); }

/* chart */
.chart-wrap {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 20px;
}
.chart-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}
.chart-label {
  font-family: var(--font-mono);
  font-size: 0.65rem;
  color: var(--text3);
  letter-spacing: 1.5px;
  text-transform: uppercase;
}
.chart-period-btns { display: flex; gap: 3px; }
.cp-btn {
  padding: 3px 9px;
  border-radius: 3px;
  border: 1px solid var(--border);
  background: none;
  color: var(--text3);
  font-family: var(--font-mono);
  font-size: 0.65rem;
  cursor: pointer;
  transition: all 0.12s;
  letter-spacing: 0.3px;
}
.cp-btn.active { background: var(--accent); border-color: var(--accent); color: #08080d; font-weight: 700; }

svg.chart { width: 100%; height: 100px; }

.chart-datapoints {
  display: flex;
  gap: 10px;
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid var(--border);
}
.cdp { flex: 1; }
.cdp-label { font-family: var(--font-mono); font-size: 0.58rem; color: var(--text3); letter-spacing: 1px; text-transform: uppercase; }
.cdp-val { font-family: var(--font-mono); font-size: 0.8rem; font-weight: 500; margin-top: 3px; }

/* sellers */
.sellers-hd {
  font-family: var(--font-mono);
  font-size: 0.62rem;
  color: var(--text3);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 10px;
}

.seller-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: 7px;
  margin-bottom: 6px;
  cursor: pointer;
  transition: all 0.15s;
}
.seller-row:hover { border-color: var(--border2); background: var(--bg2); }

.s-av {
  width: 32px; height: 32px;
  border-radius: 50%;
  background: linear-gradient(135deg, #3d2a6e, #d4f53c);
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-mono);
  font-size: 0.75rem;
  font-weight: 700;
  color: #08080d;
  flex-shrink: 0;
}
.s-info { flex: 1; }
.s-name { font-size: 0.82rem; font-weight: 600; margin-bottom: 2px; }
.s-meta {
  display: flex; gap: 6px; align-items: center;
  font-family: var(--font-mono);
  font-size: 0.62rem;
  color: var(--text3);
}
.s-price { font-family: var(--font-display); font-size: 1.1rem; letter-spacing: 0.5px; }

.btn-buy {
  padding: 6px 14px;
  background: var(--accent);
  border: none;
  border-radius: 4px;
  color: #08080d;
  font-family: var(--font-mono);
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
}
.btn-buy:hover { box-shadow: 0 0 14px var(--accent-glow); transform: scale(1.03); }

/* offer bar */
.offer-bar {
  display: flex;
  gap: 8px;
  align-items: center;
  padding: 13px;
  border: 1px dashed var(--border2);
  border-radius: 7px;
  margin-top: 14px;
  background: var(--accent-dim);
}
.offer-label { font-family: var(--font-mono); font-size: 0.65rem; color: var(--text3); white-space: nowrap; letter-spacing: 0.3px; }
.offer-input {
  flex: 1;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 5px;
  padding: 8px 11px;
  color: var(--text);
  font-family: var(--font-display);
  font-size: 1rem;
  letter-spacing: 1px;
  outline: none;
}
.offer-input:focus { border-color: var(--accent); }

/* no price notice */
.no-price-notice {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 11px;
  font-family: var(--font-mono);
  font-size: 0.72rem;
  color: var(--text3);
  margin-bottom: 14px;
  letter-spacing: 0.3px;
}

/* Badge */
.badge {
  padding: 2px 8px;
  border-radius: 3px;
  font-family: var(--font-mono);
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 1px;
}
.badge-nm { background: var(--nm-bg); color: var(--nm); border: 1px solid rgba(46,213,115,0.25); }
.badge-lp { background: var(--lp-bg); color: var(--lp); border: 1px solid rgba(255,165,2,0.25); }
.badge-mp { background: var(--mp-bg); color: var(--mp); border: 1px solid rgba(255,71,87,0.25); }

@media(max-width:900px) {
  .layout { grid-template-columns: 1fr; }
  .sidebar { display: none; }
  .hero { grid-template-columns: 1fr; }
  .hero-right { display: none; }
  .hero-headline { font-size: 3.5rem; }
  nav { padding: 0 18px; }
  .nav-center { display: none; }
  .cards-area { padding: 14px; }
  .modal { grid-template-columns: 1fr; }
  .modal-left { border-right: none; border-bottom: 1px solid var(--border); }
}
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="logo">PPLE<span class="dot">.</span>TCG</div>
  <div class="nav-center">
    <button class="nav-tab active">Mercado</button>
    <button class="nav-tab">Vender</button>
    <button class="nav-tab">Verificaci√≥n</button>
    <button class="nav-tab">Portfolio</button>
  </div>
  <div class="nav-right">
    <div class="live-dot">EN VIVO</div>
    <button class="btn-outline">Entrar</button>
    <button class="btn-accent">Registrarse</button>
  </div>
</nav>

<!-- TICKER -->
<div class="ticker-wrap">
  <div class="ticker-label">LIVE</div>
  <div class="ticker-scroll" id="ticker">
    <!-- filled by JS -->
  </div>
</div>

<!-- HERO -->
<div class="hero">
  <div class="hero-left">
    <div>
      <div class="hero-eyebrow">
        <span class="eyebrow-tag">Pok√©mon TCG</span>
        <span class="eyebrow-tag2">PRECIOS CARDMARKET ¬∑ EUR</span>
      </div>
      <div class="hero-headline">
        TRADE<br>
        <span class="line2">SMARTER.</span>
      </div>
      <p class="hero-desc">
        El marketplace definitivo para cartas Pok√©mon. Precios en tiempo real, verificaci√≥n de autenticidad y env√≠o integrado. La nueva infraestructura del mercado TCG.
      </p>
    </div>
    <div class="hero-kpis">
      <div class="kpi">
        <div class="kpi-val" id="hCards">‚Äî</div>
        <div class="kpi-label">Cartas</div>
      </div>
      <div class="kpi">
        <div class="kpi-val" id="hSets">‚Äî</div>
        <div class="kpi-label">Sets</div>
      </div>
      <div class="kpi">
        <div class="kpi-val">5-8%</div>
        <div class="kpi-label">Comisi√≥n</div>
      </div>
      <div class="kpi">
        <div class="kpi-val">EUR</div>
        <div class="kpi-label">Divisa</div>
      </div>
    </div>
  </div>
  <div class="hero-right">
    <div class="featured-card">
      <div class="fc-img" id="heroImg">‚ö°</div>
      <div class="fc-body">
        <div class="fc-name" id="heroName">Cargando...</div>
        <div class="fc-set" id="heroSet">‚Äî</div>
        <div class="fc-price-row">
          <div class="fc-price" id="heroPrice">‚Ç¨‚Äî</div>
          <div class="fc-chg" id="heroChg"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- LAYOUT -->
<div class="layout">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="status-pill s-loading" id="statusBar">
      <span class="spin">‚ü≥</span> Conectando...
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">Colecciones</div>
      <div id="colGrid"></div>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="content">
    <div class="toolbar">
      <div class="toolbar-title" id="cardsTitle">CARTAS</div>
      <div class="toolbar-count" id="cardsSub">‚Äî</div>
      <div class="sep"></div>
      <!-- Display selector -->
      <button class="cond-btn disp-active" id="dispRaw" onclick="setDisplay('raw')">RAW</button>
      <button class="cond-btn" id="dispSlab" onclick="setDisplay('slab')">SLAB</button>
      <div class="sep"></div>
      <!-- RAW conditions -->
      <div id="rawFilters" style="display:flex;gap:6px;align-items:center">
        <button class="cond-btn c-all" onclick="setCond('all',this)">TODOS</button>
        <button class="cond-btn" onclick="setCond('NM',this)">NM</button>
        <button class="cond-btn" onclick="setCond('LP',this)">LP</button>
        <button class="cond-btn" onclick="setCond('MP',this)">MP</button>
      </div>
      <!-- SLAB grades -->
      <div id="slabFilters" style="display:none;gap:6px;align-items:center">
        <button class="cond-btn" onclick="setGrade('all',this)" style="border-color:var(--border2);color:var(--text2);background:var(--surface2)">TODOS</button>
        <button class="cond-btn psa10" onclick="setGrade('PSA10',this)">PSA 10</button>
        <button class="cond-btn psa9" onclick="setGrade('PSA9',this)">PSA 9</button>
        <button class="cond-btn psa8" onclick="setGrade('PSA8',this)">PSA 8</button>
      </div>
      <div class="search-wrap">
        <span class="search-icon">‚åï</span>
        <input type="text" placeholder="Buscar carta..." id="searchInput" oninput="filterCards()">
      </div>
    </div>
    <div class="cards-area">
      <div class="cards-grid" id="cardsGrid"></div>
      <div class="pagination" id="pagination"></div>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="overlay" onclick="overlayClick(event)">
  <div class="modal">
    <div class="modal-left">
      <div class="m-card-img" id="mImg">üé¥</div>
      <div>
        <div class="m-card-name" id="mName">‚Äî</div>
        <div class="m-card-set" id="mSet">‚Äî</div>
      </div>
      <div class="cond-strip">
        <span class="badge badge-nm">NM</span>
        <span class="badge badge-lp">LP</span>
        <span class="badge badge-mp">MP</span>
      </div>
      <div class="price-box">
        <div class="price-box-title">Cardmarket ¬∑ EUR</div>
        <div class="pb-row"><span class="pb-label">Tendencia</span><span class="pb-val" id="pdTrend">‚Äî</span></div>
        <div class="pb-row"><span class="pb-label">M√≠nimo</span><span class="pb-val" id="pdLow">‚Äî</span></div>
        <div class="pb-row"><span class="pb-label">Media 1D</span><span class="pb-val" id="pdAvg1">‚Äî</span></div>
        <div class="pb-row"><span class="pb-label">Media 7D</span><span class="pb-val" id="pdAvg7">‚Äî</span></div>
        <div class="pb-row"><span class="pb-label">Media 30D</span><span class="pb-val" id="pdAvg30">‚Äî</span></div>
        <div class="cm-badge">‚úì FUENTE: CARDMARKET</div>
      </div>
    </div>
    <div class="modal-right">
      <div class="m-header">
        <div class="m-price-wrap">
          <div class="m-price-label">PRECIO DE MERCADO</div>
          <div class="m-price" id="mPrice">‚Äî</div>
          <div class="m-chg" id="mChg">‚Äî</div>
        </div>
        <button class="m-close" onclick="closeModal()">‚úï</button>
      </div>
      <div class="chart-wrap">
        <div class="chart-head">
          <div class="chart-label">Historial de precio</div>
          <div class="chart-period-btns">
            <button class="cp-btn active" onclick="switchChart('1d',this)">1D</button>
            <button class="cp-btn" onclick="switchChart('7d',this)">7D</button>
            <button class="cp-btn" onclick="switchChart('30d',this)">30D</button>
          </div>
        </div>
        <svg class="chart" id="chart" viewBox="0 0 500 100"></svg>
        <div class="chart-datapoints" id="chartDatapoints"></div>
      </div>
      <div id="noPriceNotice" class="no-price-notice" style="display:none">
        ‚ö† Esta carta no tiene datos de precio en Cardmarket a√∫n.
      </div>
      <div class="sellers-hd">Vendedores</div>
      <div id="sellersList"></div>
      <div class="offer-bar">
        <div class="offer-label">OFERTA M√ÅX.</div>
        <input class="offer-input" type="text" placeholder="‚Ç¨0.00" id="offerInput">
        <button class="btn-accent" onclick="submitOffer()">Ofertar</button>
      </div>
    </div>
  </div>
</div>

<script>
const BASE = 'https://api.tcgdex.net/v2/en';
let cond = 'all', grade = 'all', displayMode = 'raw', allSets = [], curCards = [], curPage = 1;
const PER_PAGE = 20;
const cardCache = {};
let curPricing = null;

// ---- TICKER INIT ----
const TICKER_DATA = [
  {n:'Charizard ex', p:'‚Ç¨124.50', c:'+18.5%', up:true},
  {n:'Pikachu ex', p:'‚Ç¨84.20', c:'+12.3%', up:true},
  {n:'Mewtwo ex', p:'‚Ç¨210.00', c:'+5.8%', up:true},
  {n:'Umbreon ex', p:'‚Ç¨67.30', c:'-3.2%', up:false},
  {n:'Gardevoir ex', p:'‚Ç¨45.80', c:'+7.1%', up:true},
  {n:'Miraidon ex', p:'‚Ç¨52.40', c:'+9.3%', up:true},
  {n:'Sylveon ex', p:'‚Ç¨55.00', c:'+14.2%', up:true},
  {n:'Lugia VStar', p:'‚Ç¨31.60', c:'-2.1%', up:false},
  {n:'Iron Valiant ex', p:'‚Ç¨38.20', c:'-1.5%', up:false},
  {n:'Espeon ex', p:'‚Ç¨28.70', c:'+6.4%', up:true},
];
function buildTicker() {
  const items = [...TICKER_DATA, ...TICKER_DATA].map(d => `
    <div class="ticker-item">
      <span class="ticker-name">${d.n}</span>
      <span class="ticker-price">${d.p}</span>
      <span class="${d.up?'ticker-up':'ticker-down'}">${d.c}</span>
    </div>`).join('');
  document.getElementById('ticker').innerHTML = items;
}

function setStatus(type, msg) {
  const el = document.getElementById('statusBar');
  el.className = 'status-pill ' + type;
  el.innerHTML = msg;
}

function shimCards() {
  document.getElementById('cardsGrid').innerHTML = Array(8).fill(`
    <div class="card-item">
      <div class="card-img shimmer" style="height:145px"></div>
      <div class="card-body">
        <div class="shimmer" style="height:14px;margin-bottom:6px"></div>
        <div class="shimmer" style="height:10px;width:55%"></div>
      </div>
    </div>`).join('');
  document.getElementById('pagination').innerHTML = '';
}

function shimCols() {
  document.getElementById('colGrid').innerHTML = Array(5).fill(
    '<div class="col-item shimmer" style="height:46px;margin-bottom:2px"></div>').join('');
}

function fmtPrice(v) {
  if (!v || isNaN(v)) return null;
  return `‚Ç¨${parseFloat(v).toFixed(2)}`;
}
function getPrimaryPrice(pricing) {
  if (!pricing?.cardmarket) return null;
  return pricing.cardmarket.trend || pricing.cardmarket.avg || pricing.cardmarket.low || null;
}
function getChangePercent(pricing) {
  if (!pricing?.cardmarket) return null;
  const avg1 = pricing.cardmarket.avg1;
  const avg7 = pricing.cardmarket.avg7;
  if (avg1 && avg7 && avg7 !== 0) return ((avg1 - avg7) / avg7) * 100;
  return null;
}

async function init() {
  buildTicker();
  shimCols(); shimCards();
  try {
    const r = await fetch(`${BASE}/sets`);
    if (!r.ok) throw new Error(r.status);
    const data = await r.json();
    allSets = [...data].reverse();
    document.getElementById('hSets').textContent = allSets.length + '+';
    renderCols(allSets.slice(0, 15));
    setStatus('s-ok', `‚úÖ ${allSets.length} colecciones`);
    if (allSets[0]) loadSet(allSets[0]);
  } catch(e) {
    setStatus('s-err', '‚ö† Sin conexi√≥n');
    document.getElementById('colGrid').innerHTML = '';
    document.getElementById('cardsGrid').innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--text3);padding:40px;font-family:var(--font-mono);font-size:0.8rem">No se pudo conectar con la API</div>';
  }
}

function renderCols(sets) {
  document.getElementById('colGrid').innerHTML = sets.map(s => `
    <div class="col-item" id="c-${s.id}" onclick="loadSetEl(${JSON.stringify(s).replace(/"/g,'&quot;')}, this)">
      <img class="ci-logo" src="https://assets.tcgdex.net/univ/${s.serie?.id||'sv'}/${s.id}/logo.png"
        onerror="this.style.display='none'" alt="">
      <div class="ci-info">
        <div class="ci-name">${s.name}</div>
        <div class="ci-count">${s.cardCount?.total || '‚Äî'} cartas</div>
      </div>
    </div>`).join('');
}

async function loadSetEl(set, el) {
  document.querySelectorAll('.col-item').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  await loadSet(set);
}

async function loadSet(set) {
  curPage = 1;
  document.getElementById('cardsTitle').textContent = set.name.toUpperCase();
  document.getElementById('cardsSub').textContent = 'Cargando...';
  shimCards();
  try {
    const r = await fetch(`${BASE}/sets/${set.id}`);
    const data = await r.json();
    const rawCards = data.cards || [];
    document.getElementById('hCards').textContent = rawCards.length + '+';
    document.getElementById('cardsSub').textContent = `0 / ${rawCards.length}`;
    setStatus('s-loading', `<span class="spin">‚ü≥</span> Precios...`);
    let loaded = 0;
    const BATCH = 10;
    for (let i = 0; i < rawCards.length; i += BATCH) {
      const batch = rawCards.slice(i, i + BATCH);
      await Promise.all(batch.map(async card => {
        if (!cardCache[card.id]) {
          try {
            const cr = await fetch(`${BASE}/cards/${card.id}`);
            cardCache[card.id] = await cr.json();
          } catch(e) { cardCache[card.id] = { ...card, pricing: null }; }
        }
        loaded++;
        document.getElementById('cardsSub').textContent = `${loaded} / ${rawCards.length}`;
      }));
    }
    curCards = [...rawCards].sort((a, b) => {
      const pa = parseFloat(getPrimaryPrice(cardCache[a.id]?.pricing)) || 0;
      const pb = parseFloat(getPrimaryPrice(cardCache[b.id]?.pricing)) || 0;
      return pb - pa;
    });
    document.getElementById('cardsSub').textContent = `${curCards.length} cartas ¬∑ precio desc.`;
    setStatus('s-ok', `‚úÖ ${allSets.length} colecciones`);
    renderPage();
    if (curCards.length) fetchAndUpdateHero(curCards[0], set);
  } catch(e) {
    document.getElementById('cardsSub').textContent = 'Error';
    setStatus('s-err', '‚ö† Error');
    document.getElementById('cardsGrid').innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--text3);padding:40px;font-family:var(--font-mono);font-size:0.8rem">Error al cargar</div>';
  }
}

async function fetchAndUpdateHero(card, set) {
  try {
    const data = cardCache[card.id] || await fetch(`${BASE}/cards/${card.id}`).then(r=>r.json());
    const price = getPrimaryPrice(data.pricing);
    const change = getChangePercent(data.pricing);
    const url = data.image ? data.image + '/low.png' : null;
    document.getElementById('heroImg').innerHTML = url
      ? `<img src="${url}" alt="${data.name}" onerror="this.parentNode.innerHTML='‚ö°'">`
      : '‚ö°';
    document.getElementById('heroName').textContent = data.name;
    document.getElementById('heroSet').textContent = `${set.name.toUpperCase()} ¬∑ #${data.localId}`;
    document.getElementById('heroPrice').textContent = price ? `‚Ç¨${parseFloat(price).toFixed(2)}` : '‚Äî';
    if (change !== null) {
      const cel = document.getElementById('heroChg');
      cel.textContent = `${change>=0?'‚ñ≤':'‚ñº'} ${Math.abs(change).toFixed(1)}%`;
      cel.style.color = change >= 0 ? 'var(--nm)' : 'var(--mp)';
    }
  } catch(e) {}
}

function renderPage() {
  const q = document.getElementById('searchInput').value.toLowerCase();
  const isSlab = displayMode === 'slab';

  function getSlabGrade(id) {
    let h = 0; for (let ch of id) h = ((h << 5) - h) + ch.charCodeAt(0);
    const grades = ['PSA10','PSA9','PSA8','PSA8','PSA9','PSA10','PSA9','PSA8'];
    return grades[Math.abs(h) % grades.length];
  }
  function getCardCond(id) {
    let h = 0; for (let ch of id) h = ((h << 5) - h) + ch.charCodeAt(0);
    const conds = ['NM','LP','MP','NM','NM','LP','MP','NM'];
    return conds[Math.abs(h) % conds.length];
  }
  function slabMult(g) { return g==='PSA10'?4.5:g==='PSA9'?2.2:1.4; }

  let filtered = curCards.filter(card => {
    if (q && !card.name.toLowerCase().includes(q)) return false;
    if (!isSlab && cond !== 'all' && getCardCond(card.id) !== cond) return false;
    if (isSlab && grade !== 'all' && getSlabGrade(card.id) !== grade) return false;
    return true;
  });

  const total = filtered.length;
  const slice = filtered.slice((curPage-1)*PER_PAGE, curPage*PER_PAGE);

  if (!slice.length) {
    document.getElementById('cardsGrid').innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--text3);padding:40px;font-family:var(--font-mono);font-size:0.8rem">Sin resultados</div>';
    document.getElementById('pagination').innerHTML = '';
    return;
  }

  const globalOffset = (curPage-1)*PER_PAGE;
  document.getElementById('cardsGrid').innerHTML = slice.map((card, i) => {
    const rank = globalOffset + i + 1;
    const cached = cardCache[card.id];
    const basePrice = getPrimaryPrice(cached?.pricing);
    const change = getChangePercent(cached?.pricing);
    const cm = cached?.pricing?.cardmarket;
    const url = card.image ? card.image + '/low.png' : null;

    const cardCond = getCardCond(card.id);
    const slabGrade = getSlabGrade(card.id);
    const condClass = cardCond==='NM'?'raw-nm':cardCond==='LP'?'raw-lp':'raw-mp';
    const slabClass = slabGrade==='PSA10'?'slab-10':slabGrade==='PSA9'?'slab-9':'slab-8';

    const displayPrice = basePrice
      ? (isSlab ? parseFloat(basePrice)*slabMult(slabGrade) : parseFloat(basePrice))
      : null;

    const priceHtml = displayPrice
      ? `<div class="card-price">‚Ç¨${displayPrice.toFixed(2)}</div>`
      : `<div class="card-price no-data">SIN PRECIO</div>`;

    let chgHtml = `<div class="card-chg chg-flat"></div>`;
    if (change !== null) {
      const cc = change>=0?'chg-up':'chg-down';
      const cs = change>=0?'‚ñ≤':'‚ñº';
      chgHtml = `<div class="card-chg ${cc}">${cs}${Math.abs(change).toFixed(1)}%</div>`;
    }

    const badgeHtml = isSlab
      ? `<div class="slab-badge ${slabClass}">üèÜ ${slabGrade.replace('PSA','PSA ')}</div>`
      : `<div class="raw-badge ${condClass}">${cardCond}</div>`;

    let stripHtml = '';
    if (cm?.trend && !isSlab) {
      const nm=parseFloat(cm.trend).toFixed(2), lp=(cm.trend*0.75).toFixed(2), mp=(cm.trend*0.48).toFixed(2);
      stripHtml = `<div class="price-strip">
        <div class="psi"><div class="psi-label">NM</div><div class="psi-val" style="color:var(--nm)">‚Ç¨${nm}</div></div>
        <div class="psi"><div class="psi-label">LP</div><div class="psi-val" style="color:var(--lp)">‚Ç¨${lp}</div></div>
        <div class="psi"><div class="psi-label">MP</div><div class="psi-val" style="color:var(--mp)">‚Ç¨${mp}</div></div>
      </div>`;
    } else if (cm?.trend && isSlab) {
      const p10=(cm.trend*4.5).toFixed(2), p9=(cm.trend*2.2).toFixed(2), p8=(cm.trend*1.4).toFixed(2);
      stripHtml = `<div class="price-strip">
        <div class="psi"><div class="psi-label">PSA 10</div><div class="psi-val" style="color:#d4f53c">‚Ç¨${p10}</div></div>
        <div class="psi"><div class="psi-label">PSA 9</div><div class="psi-val" style="color:#38bdf8">‚Ç¨${p9}</div></div>
        <div class="psi"><div class="psi-label">PSA 8</div><div class="psi-val" style="color:#a78bfa">‚Ç¨${p8}</div></div>
      </div>`;
    }

    const slabClass2 = isSlab?' is-slab':'';
    return `
    <div class="card-item${slabClass2}" onclick="openCard('${card.id}','${card.name.replace(/'/g,"\\'")}')">
      <div class="card-img">
        ${url ? `<img src="${url}" alt="${card.name}" loading="lazy" onerror="this.parentNode.innerHTML='üé¥'">` : 'üé¥'}
        ${badgeHtml}
        <div class="card-rank">#${rank}</div>
      </div>
      <div class="card-body">
        <div class="card-name">${card.name}</div>
        <div class="card-num">${card.localId}</div>
        <div class="card-footer">${priceHtml}${chgHtml}</div>
        ${stripHtml}
      </div>
    </div>`;
  }).join('');

  renderPagination(total);
}


function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

function renderPagination(total) {
  const pages = Math.ceil(total/PER_PAGE);
  if (pages<=1) { document.getElementById('pagination').innerHTML=''; return; }
  let h=`<button class="page-btn" onclick="goPage(${curPage-1})" ${curPage===1?'disabled':''}>‚Üê</button>`;
  for(let i=1;i<=pages;i++) {
    if(i===1||i===pages||Math.abs(i-curPage)<=2) h+=`<button class="page-btn ${i===curPage?'active':''}" onclick="goPage(${i})">${i}</button>`;
    else if(Math.abs(i-curPage)===3) h+=`<span style="color:var(--text3);padding:0 4px;font-family:var(--font-mono);font-size:0.7rem">‚Ä¶</span>`;
  }
  h+=`<button class="page-btn" onclick="goPage(${curPage+1})" ${curPage===pages?'disabled':''}>‚Üí</button>`;
  document.getElementById('pagination').innerHTML=h;
}

function goPage(p) { curPage=p; renderPage(); window.scrollTo({top:document.getElementById('cardsGrid').offsetTop-80,behavior:'smooth'}); }
function filterCards() { curPage=1; renderPage(); }

function setCond(c, btn) {
  cond = c;
  document.querySelectorAll('#rawFilters .cond-btn').forEach(b => b.className='cond-btn');
  if(c==='all') btn.classList.add('c-all');
  else if(c==='NM') btn.classList.add('c-nm');
  else if(c==='LP') btn.classList.add('c-lp');
  else if(c==='MP') btn.classList.add('c-mp');
  curPage=1; renderPage();
}

function setGrade(g, btn) {
  grade = g;
  document.querySelectorAll('#slabFilters .cond-btn').forEach(b => b.classList.remove('grade-active'));
  btn.classList.add('grade-active');
  curPage=1; renderPage();
}

function setDisplay(mode) {
  displayMode = mode;
  const isRaw = mode === 'raw';
  document.getElementById('dispRaw').classList.toggle('disp-active', isRaw);
  document.getElementById('dispSlab').classList.toggle('disp-active', !isRaw);
  document.getElementById('rawFilters').style.display = isRaw ? 'flex' : 'none';
  document.getElementById('slabFilters').style.display = isRaw ? 'none' : 'flex';
  // reset filters
  cond = 'all'; grade = 'all';
  curPage = 1; renderPage();
}

async function openCard(id, name) {
  document.getElementById('mImg').innerHTML='üé¥';
  document.getElementById('mName').textContent=name;
  document.getElementById('mSet').textContent='Cargando...';
  document.getElementById('mPrice').textContent='‚Äî';
  document.getElementById('mPrice').className='m-price';
  document.getElementById('mChg').textContent='‚Äî';
  document.getElementById('sellersList').innerHTML='';
  document.getElementById('noPriceNotice').style.display='none';
  ['pdTrend','pdLow','pdAvg1','pdAvg7','pdAvg30'].forEach(id=>document.getElementById(id).textContent='‚Äî');
  document.getElementById('chartDatapoints').innerHTML='';
  curPricing=null;
  document.getElementById('overlay').classList.add('open');
  try {
    if(!cardCache[id]) { const r=await fetch(`${BASE}/cards/${id}`); cardCache[id]=await r.json(); }
    const card=cardCache[id];
    const cm=card.pricing?.cardmarket;
    const price=getPrimaryPrice(card.pricing);
    const change=getChangePercent(card.pricing);
    curPricing=cm;
    const url=card.image?card.image+'/high.png':null;
    document.getElementById('mImg').innerHTML=url?`<img src="${url}" alt="${card.name}" onerror="this.parentNode.innerHTML='üé¥'">`:'üé¥';
    document.getElementById('mName').textContent=card.name;
    document.getElementById('mSet').textContent=`${card.set?.name||''} ¬∑ #${card.localId}${card.rarity?' ¬∑ '+card.rarity:''}`;
    if(price) {
      document.getElementById('mPrice').textContent=`‚Ç¨${parseFloat(price).toFixed(2)}`;
      if(change!==null) {
        const cel=document.getElementById('mChg');
        cel.textContent=`${change>=0?'‚ñ≤':'‚ñº'} ${Math.abs(change).toFixed(1)}% (7D) ¬∑ Cardmarket`;
        cel.style.color=change>=0?'var(--nm)':'var(--mp)';
      } else { document.getElementById('mChg').textContent='Sin variaci√≥n reciente'; document.getElementById('mChg').style.color='var(--text3)'; }
    } else {
      document.getElementById('mPrice').textContent='Sin precio';
      document.getElementById('mPrice').className='m-price no-data';
      document.getElementById('mChg').textContent='';
      document.getElementById('noPriceNotice').style.display='block';
    }
    if(cm) {
      const t=cm.trend,lo=cm.low,a1=cm.avg1,a7=cm.avg7,a30=cm.avg30;
      document.getElementById('pdTrend').textContent=fmtPrice(t)||'‚Äî';
      document.getElementById('pdLow').textContent=fmtPrice(lo)||'‚Äî';
      setAvgEl('pdAvg1',a1,a7);
      setAvgEl('pdAvg7',a7,a30);
      document.getElementById('pdAvg30').textContent=fmtPrice(a30)||'‚Äî';
    }
    drawChart(cm,'7d');
    updateChartDatapoints(cm,'7d');
    renderSellers(price,cm);
  } catch(e) { document.getElementById('mSet').textContent='Error al cargar'; }
}

function setAvgEl(elId,val,prev) {
  const el=document.getElementById(elId);
  if(!val){el.textContent='‚Äî';return;}
  el.textContent=`‚Ç¨${parseFloat(val).toFixed(2)}`;
  if(prev&&val!==prev){el.classList.remove('up','down');el.classList.add(val>prev?'up':'down');}
}

function drawChart(cm,period) {
  const svg=document.getElementById('chart');
  const W=500,H=100,pad=10;
  if(!cm){svg.innerHTML=`<text x="250" y="52" text-anchor="middle" fill="var(--text3)" font-size="11" font-family="DM Mono">Sin datos</text>`;return;}
  let points=[];
  if(period==='1d'){
    const base=cm.avg1||cm.trend||cm.avg;
    if(!base){drawNoData(svg);return;}
    for(let i=23;i>=0;i--){points.push(i===0?base:base*(0.98+Math.random()*0.04));}
    points.reverse(); points[points.length-1]=cm.avg1||base;
  } else if(period==='7d'){
    const today=cm.avg1||cm.trend,avg7=cm.avg7||today;
    if(!today){drawNoData(svg);return;}
    const start=avg7*0.94;
    for(let i=0;i<7;i++){const t=i/6;points.push(Math.max(start+(today-start)*t+(Math.random()-0.5)*avg7*0.04,0.01));}
    points[points.length-1]=today;
  } else {
    const today=cm.avg1||cm.trend,avg7=cm.avg7||today,avg30=cm.avg30||avg7;
    if(!today){drawNoData(svg);return;}
    for(let i=0;i<30;i++){const t=i/29;const mid=avg30+(today-avg30)*t;points.push(Math.max(mid+(Math.random()-0.5)*avg30*0.06,0.01));}
    points[points.length-1]=today;
  }
  if(!points.length){drawNoData(svg);return;}
  const mn=Math.min(...points),mx=Math.max(...points),range=mx-mn||mn*0.1||0.01;
  const x=i=>pad+(i/(points.length-1))*(W-pad*2);
  const y=v=>H-pad-((v-mn)/range)*(H-pad*2);
  const trend=points[points.length-1]-points[0];
  const col=trend>=0?'var(--nm)':'var(--mp)';
  const line=points.map((p,i)=>`${i===0?'M':'L'}${x(i).toFixed(1)},${y(p).toFixed(1)}`).join(' ');
  const area=line+` L${x(points.length-1).toFixed(1)},${H} L${x(0).toFixed(1)},${H} Z`;
  svg.innerHTML=`<defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="${col}" stop-opacity="0.18"/><stop offset="100%" stop-color="${col}" stop-opacity="0"/></linearGradient></defs>
  <path d="${area}" fill="url(#g)"/>
  <path d="${line}" stroke="${col}" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
  <circle cx="${x(points.length-1).toFixed(1)}" cy="${y(points[points.length-1]).toFixed(1)}" r="4" fill="${col}" stroke="var(--bg2)" stroke-width="2"/>`;
}

function drawNoData(svg){svg.innerHTML=`<text x="250" y="52" text-anchor="middle" fill="var(--text3)" font-size="11" font-family="DM Mono">Sin datos</text>`;}

function updateChartDatapoints(cm,period){
  if(!cm){document.getElementById('chartDatapoints').innerHTML='';return;}
  let items=[];
  if(period==='1d'){
    if(cm.avg1)items.push({l:'Ahora',v:`‚Ç¨${parseFloat(cm.avg1).toFixed(2)}`,c:'var(--nm)'});
    if(cm.low)items.push({l:'M√≠nimo',v:`‚Ç¨${parseFloat(cm.low).toFixed(2)}`,c:'var(--text3)'});
    if(cm.trend)items.push({l:'Tendencia',v:`‚Ç¨${parseFloat(cm.trend).toFixed(2)}`,c:'var(--accent)'});
  } else if(period==='7d'){
    if(cm.avg1)items.push({l:'Hoy',v:`‚Ç¨${parseFloat(cm.avg1).toFixed(2)}`,c:'var(--nm)'});
    if(cm.avg7)items.push({l:'Media 7D',v:`‚Ç¨${parseFloat(cm.avg7).toFixed(2)}`,c:'var(--text3)'});
    if(cm.trend)items.push({l:'Tendencia',v:`‚Ç¨${parseFloat(cm.trend).toFixed(2)}`,c:'var(--accent)'});
  } else {
    if(cm.avg1)items.push({l:'Hoy',v:`‚Ç¨${parseFloat(cm.avg1).toFixed(2)}`,c:'var(--nm)'});
    if(cm.avg30)items.push({l:'Media 30D',v:`‚Ç¨${parseFloat(cm.avg30).toFixed(2)}`,c:'var(--text3)'});
    if(cm.low)items.push({l:'M√≠nimo',v:`‚Ç¨${parseFloat(cm.low).toFixed(2)}`,c:'var(--accent)'});
  }
  document.getElementById('chartDatapoints').innerHTML=items.map(i=>`<div class="cdp"><div class="cdp-label">${i.l}</div><div class="cdp-val" style="color:${i.c}">${i.v}</div></div>`).join('');
}

function switchChart(period,btn){
  document.querySelectorAll('.cp-btn').forEach(t=>t.classList.remove('active'));
  btn.classList.add('active');
  drawChart(curPricing,period);
  updateChartDatapoints(curPricing,period);
}

function renderSellers(basePrice,cm){
  const p=basePrice?parseFloat(basePrice):null;
  if(!p){document.getElementById('sellersList').innerHTML='<div style="color:var(--text3);font-size:0.75rem;padding:10px;font-family:var(--font-mono)">Sin precio de referencia.</div>';return;}
  const prices={NM:p,LP:p*0.75,MP:p*0.48};
  if(cm?.low)prices.NM=Math.max(p*0.9,cm.low);
  const sellers=[
    {n:'TrainerRed99',r:'4.9',s:'342',c:'NM',offset:1.05},
    {n:'Pok√©Collector_ES',r:'4.7',s:'128',c:'LP',offset:0.98},
    {n:'CardShopMadrid',r:'5.0',s:'891',c:'NM',offset:0.97},
    {n:'PokeMarket_EU',r:'4.6',s:'55',c:'MP',offset:1.02},
  ];
  const vis=sellers.filter(s=>cond==='all'||cond===s.c);
  if(!vis.length){document.getElementById('sellersList').innerHTML='<div style="color:var(--text3);font-size:0.75rem;padding:10px;font-family:var(--font-mono)">Sin vendedores para este estado.</div>';return;}
  document.getElementById('sellersList').innerHTML=vis.map(s=>{
    const sp=(prices[s.c]*s.offset).toFixed(2);
    const bc=s.c==='NM'?'badge-nm':s.c==='LP'?'badge-lp':'badge-mp';
    return `<div class="seller-row">
      <div class="s-av">${s.n[0]}</div>
      <div class="s-info">
        <div class="s-name">${s.n}</div>
        <div class="s-meta">‚≠ê ${s.r} ¬∑ ${s.s} ventas <span class="badge ${bc}">${s.c}</span></div>
      </div>
      <div class="s-price">‚Ç¨${sp}</div>
      <button class="btn-buy">Comprar</button>
    </div>`;
  }).join('');
}

function closeModal(){document.getElementById('overlay').classList.remove('open');}
function overlayClick(e){if(e.target===document.getElementById('overlay'))closeModal();}
function submitOffer(){const v=document.getElementById('offerInput').value;if(v){alert(`‚úÖ Oferta de ${v} registrada.`);document.getElementById('offerInput').value='';}}

init();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg ¬∑ Acceder</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#08080d; --bg2:#0e0e16; --surface:#11111c; --surface2:#181825;
  --border:#22223a; --border2:#2d2d4a;
  --accent:#d4f53c; --accent-glow:rgba(212,245,60,0.18); --accent-dim:rgba(212,245,60,0.06);
  --text:#eeeef8; --text2:#9898b8; --text3:#55556a;
  --nm:#2ed573; --mp:#ff4757; --lp:#ffa502;
  --nm-bg:rgba(46,213,115,0.08); --mp-bg:rgba(255,71,87,0.08);
  --font-display:'Bebas Neue',sans-serif;
  --font-mono:'DM Mono',monospace;
  --font-body:'Plus Jakarta Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay;}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* NAV */
nav{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:60px;border-bottom:1px solid var(--border);background:rgba(8,8,13,0.97);backdrop-filter:blur(24px);flex-shrink:0;}
.logo{font-family:var(--font-display);font-size:1.8rem;letter-spacing:3px;cursor:pointer;}
.logo .dot{color:var(--accent);}
.nav-back{display:flex;align-items:center;gap:8px;font-family:var(--font-mono);font-size:0.72rem;color:var(--text3);cursor:pointer;transition:color 0.15s;letter-spacing:0.5px;border:none;background:none;}
.nav-back:hover{color:var(--text2);}

/* LAYOUT */
.auth-layout{display:grid;grid-template-columns:1fr 1fr;flex:1;min-height:0;}

/* LEFT PANEL ‚Äî branding */
.auth-left{
  background:var(--bg2);
  border-right:1px solid var(--border);
  padding:60px 56px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  position:relative;
  overflow:hidden;
}
.al-glow{position:absolute;top:-100px;right:-100px;width:400px;height:400px;background:radial-gradient(circle,rgba(212,245,60,0.07) 0%,transparent 70%);pointer-events:none;}
.al-glow2{position:absolute;bottom:-80px;left:-80px;width:300px;height:300px;background:radial-gradient(circle,rgba(46,213,115,0.05) 0%,transparent 70%);pointer-events:none;}

.al-tag{font-family:var(--font-mono);font-size:0.65rem;color:var(--accent);letter-spacing:2px;text-transform:uppercase;border:1px solid rgba(212,245,60,0.25);padding:4px 12px;border-radius:3px;width:fit-content;margin-bottom:32px;}
.al-headline{font-family:var(--font-display);font-size:4.5rem;line-height:0.92;letter-spacing:2px;margin-bottom:20px;}
.al-headline .accent{color:var(--accent);}
.al-sub{font-size:0.9rem;color:var(--text2);line-height:1.7;font-weight:300;max-width:360px;}

.al-features{display:flex;flex-direction:column;gap:12px;margin-top:auto;padding-top:40px;}
.al-feat{display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--surface);border:1px solid var(--border);border-radius:8px;}
.af-icon{font-size:1.1rem;flex-shrink:0;}
.af-text{font-size:0.82rem;color:var(--text2);font-weight:300;line-height:1.4;}
.af-text strong{color:var(--text);font-weight:600;}

/* RIGHT PANEL ‚Äî forms */
.auth-right{
  display:flex;
  align-items:center;
  justify-content:center;
  padding:40px;
  overflow-y:auto;
}

.auth-box{width:100%;max-width:440px;}

/* TABS */
.auth-tabs{display:flex;gap:0;border:1px solid var(--border);border-radius:7px;overflow:hidden;margin-bottom:28px;}
.auth-tab{flex:1;padding:10px;text-align:center;font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:1px;text-transform:uppercase;cursor:pointer;border:none;background:none;color:var(--text3);transition:all 0.15s;}
.auth-tab.active{background:var(--accent);color:#08080d;}
.auth-tab:not(.active):hover{background:var(--surface);color:var(--text2);}

/* PANELS */
.auth-panel{display:none;}
.auth-panel.active{display:block;animation:fadeIn 0.2s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* Social buttons */
.social-btns{display:flex;flex-direction:column;gap:8px;margin-bottom:20px;}
.social-btn{display:flex;align-items:center;justify-content:center;gap:10px;padding:11px;border:1px solid var(--border2);border-radius:7px;background:var(--surface);color:var(--text);font-family:var(--font-mono);font-size:0.75rem;font-weight:500;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;width:100%;}
.social-btn:hover{border-color:var(--border2);background:var(--surface2);}
.social-btn.google:hover{border-color:rgba(66,133,244,0.4);}
.social-btn.apple:hover{border-color:rgba(255,255,255,0.2);}
.sb-logo{width:18px;height:18px;flex-shrink:0;}

.divider{display:flex;align-items:center;gap:12px;margin:18px 0;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border);}
.divider span{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;}

/* Form elements */
.form-group{margin-bottom:14px;}
.fg-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;display:block;}
.fg-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:11px 14px;color:var(--text);font-family:var(--font-mono);font-size:0.82rem;outline:none;transition:border-color 0.15s;letter-spacing:0.3px;}
.fg-input:focus{border-color:var(--accent);}
.fg-input::placeholder{color:var(--text3);}
.fg-input.error{border-color:var(--mp);}
.fg-error{font-family:var(--font-mono);font-size:0.65rem;color:var(--mp);margin-top:5px;display:none;}
.fg-error.show{display:block;}

.fg-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}

.input-icon-wrap{position:relative;}
.input-icon-wrap .fg-input{padding-right:40px;}
.input-toggle{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text3);cursor:pointer;font-size:0.8rem;padding:0;}
.input-toggle:hover{color:var(--text2);}

.forgot{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);text-align:right;margin-top:6px;cursor:pointer;letter-spacing:0.3px;transition:color 0.15s;}
.forgot:hover{color:var(--accent);}

/* Main button */
.btn-main{width:100%;padding:13px;border:none;border-radius:7px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.78rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer;transition:all 0.2s;margin-top:6px;}
.btn-main:hover{box-shadow:0 0 24px var(--accent-glow);transform:translateY(-1px);}
.btn-main:disabled{opacity:0.4;cursor:not-allowed;transform:none;box-shadow:none;}

.auth-note{font-size:0.75rem;color:var(--text3);text-align:center;margin-top:16px;line-height:1.6;}
.auth-note a{color:var(--text2);cursor:pointer;text-decoration:underline;transition:color 0.15s;}
.auth-note a:hover{color:var(--accent);}

/* ---- REGISTER STEPS ---- */
.reg-progress{display:flex;gap:6px;margin-bottom:24px;}
.rp-step{flex:1;height:3px;border-radius:2px;background:var(--border);transition:background 0.3s;}
.rp-step.done{background:var(--nm);}
.rp-step.active{background:var(--accent);}

.reg-step-title{font-family:var(--font-display);font-size:1.6rem;letter-spacing:1px;margin-bottom:4px;}
.reg-step-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:1px;margin-bottom:20px;}

.reg-panel{display:none;}
.reg-panel.active{display:block;animation:fadeIn 0.2s ease;}

/* Account type selector */
.type-selector{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;}
.type-opt{padding:16px;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all 0.15s;text-align:center;}
.type-opt:hover{border-color:var(--border2);background:var(--surface2);}
.type-opt.selected{border-color:var(--accent);background:var(--accent-dim);}
.to-icon{font-size:1.8rem;margin-bottom:8px;}
.to-title{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;margin-bottom:4px;}
.to-desc{font-size:0.72rem;color:var(--text2);font-weight:300;line-height:1.4;}

/* Age verification */
.age-check{display:flex;align-items:flex-start;gap:10px;padding:14px;background:var(--surface);border:1px solid var(--border);border-radius:8px;cursor:pointer;margin-bottom:10px;transition:all 0.15s;}
.age-check:hover{border-color:var(--border2);}
.age-check.selected{border-color:var(--accent);background:var(--accent-dim);}
.ac-radio{width:18px;height:18px;border-radius:50%;border:2px solid var(--border2);flex-shrink:0;margin-top:1px;transition:all 0.15s;display:flex;align-items:center;justify-content:center;}
.age-check.selected .ac-radio{border-color:var(--accent);background:var(--accent);}
.ac-radio::after{content:'';width:6px;height:6px;border-radius:50%;background:#08080d;display:none;}
.age-check.selected .ac-radio::after{display:block;}
.ac-text{flex:1;}
.ac-title{font-size:0.85rem;font-weight:600;margin-bottom:2px;}
.ac-desc{font-size:0.75rem;color:var(--text2);font-weight:300;line-height:1.4;}

.minor-warning{padding:12px 14px;background:rgba(255,165,2,0.07);border:1px solid rgba(255,165,2,0.2);border-radius:7px;font-size:0.78rem;color:var(--lp);line-height:1.5;margin-top:10px;display:none;}
.minor-warning.show{display:block;}

/* Step navigation */
.reg-nav{display:flex;justify-content:space-between;align-items:center;margin-top:20px;gap:10px;}
.btn-back-sm{padding:10px 18px;border:1px solid var(--border);border-radius:6px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.7rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-back-sm:hover{border-color:var(--border2);color:var(--text2);}
.btn-next-sm{flex:1;padding:11px;border:none;border-radius:6px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-next-sm:hover{box-shadow:0 0 18px var(--accent-glow);}
.btn-next-sm:disabled{opacity:0.4;cursor:not-allowed;box-shadow:none;}

/* Success */
.auth-success{text-align:center;padding:20px 0;}
.as-icon{font-size:3rem;margin-bottom:16px;}
.as-title{font-family:var(--font-display);font-size:2rem;letter-spacing:2px;margin-bottom:8px;}
.as-sub{font-size:0.85rem;color:var(--text2);font-weight:300;line-height:1.6;margin-bottom:24px;}

/* Terms */
.terms-note{font-size:0.72rem;color:var(--text3);text-align:center;line-height:1.6;margin-top:14px;}
.terms-note a{color:var(--text3);cursor:pointer;text-decoration:underline;}
.terms-note a:hover{color:var(--text2);}

/* Country select */
select.fg-input{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%2355556a'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;cursor:pointer;}

@media(max-width:800px){
  .auth-layout{grid-template-columns:1fr;}
  .auth-left{display:none;}
  nav{padding:0 18px;}
  .auth-right{padding:24px 18px;}
}
</style>
</head>
<body>

<nav>
  <div class="logo" onclick="window.location.href='pple-tcg.html'">PPLE<span class="dot">.</span>TCG</div>
  <button class="nav-back" onclick="window.location.href='pple-tcg.html'">‚Üê Volver al mercado</button>
</nav>

<div class="auth-layout">

  <!-- LEFT ‚Äî Branding -->
  <div class="auth-left">
    <div class="al-glow"></div>
    <div class="al-glow2"></div>
    <div>
      <div class="al-tag">√önete a la comunidad</div>
      <div class="al-headline">TRADE<br><span class="accent">SMARTER.</span></div>
      <div class="al-sub">La nueva infraestructura del mercado TCG. Compra y vende con precios reales, env√≠os integrados y verificaci√≥n de autenticidad.</div>
    </div>
    <div class="al-features">
      <div class="al-feat">
        <div class="af-icon">üìä</div>
        <div class="af-text"><strong>Precios reales de Cardmarket</strong> actualizados constantemente en EUR.</div>
      </div>
      <div class="al-feat">
        <div class="af-icon">üîç</div>
        <div class="af-text"><strong>Verificaci√≥n de autenticidad</strong> con pre-grading profesional.</div>
      </div>
      <div class="al-feat">
        <div class="af-icon">üì¶</div>
        <div class="af-text"><strong>Env√≠o integrado</strong> con generaci√≥n autom√°tica de etiquetas.</div>
      </div>
      <div class="al-feat">
        <div class="af-icon">üì∑</div>
        <div class="af-text"><strong>Esc√°ner IA</strong> ‚Äî identifica tu carta con una foto al instante.</div>
      </div>
    </div>
  </div>

  <!-- RIGHT ‚Äî Auth -->
  <div class="auth-right">
    <div class="auth-box">

      <!-- TABS -->
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchTab('login')">Iniciar sesi√≥n</button>
        <button class="auth-tab" onclick="switchTab('register')">Registrarse</button>
      </div>

      <!-- ===== LOGIN ===== -->
      <div class="auth-panel active" id="panelLogin">
        <div class="social-btns">
          <button class="social-btn google" onclick="socialLogin('Google')">
            <svg class="sb-logo" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            Continuar con Google
          </button>
          <button class="social-btn apple" onclick="socialLogin('Apple')">
            <svg class="sb-logo" viewBox="0 0 24 24" fill="white"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg>
            Continuar con Apple
          </button>
        </div>

        <div class="divider"><span>o con email</span></div>

        <div class="form-group">
          <label class="fg-label">Email</label>
          <input class="fg-input" type="email" id="loginEmail" placeholder="tu@email.com">
        </div>
        <div class="form-group">
          <label class="fg-label">Contrase√±a</label>
          <div class="input-icon-wrap">
            <input class="fg-input" type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button class="input-toggle" onclick="togglePass('loginPass',this)">üëÅ</button>
          </div>
          <div class="forgot">¬øOlvidaste tu contrase√±a?</div>
        </div>

        <button class="btn-main" onclick="doLogin()">Entrar</button>

        <div class="auth-note">
          ¬øNo tienes cuenta? <a onclick="switchTab('register')">Reg√≠strate gratis</a>
        </div>
      </div>

      <!-- ===== REGISTER ===== -->
      <div class="auth-panel" id="panelRegister">
        <div class="reg-progress">
          <div class="rp-step active" id="rps1"></div>
          <div class="rp-step" id="rps2"></div>
          <div class="rp-step" id="rps3"></div>
          <div class="rp-step" id="rps4"></div>
        </div>

        <!-- Step R1 ‚Äî Tipo de cuenta + social -->
        <div class="reg-panel active" id="rp1">
          <div class="reg-step-title">CREA TU CUENTA</div>
          <div class="reg-step-sub">Paso 1 de 4 ¬∑ Tipo de cuenta</div>

          <div class="social-btns">
            <button class="social-btn google" onclick="socialLogin('Google')">
              <svg class="sb-logo" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
              Registrarse con Google
            </button>
            <button class="social-btn apple" onclick="socialLogin('Apple')">
              <svg class="sb-logo" viewBox="0 0 24 24" fill="white"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg>
              Registrarse con Apple
            </button>
          </div>

          <div class="divider"><span>o con email</span></div>

          <div class="type-selector">
            <div class="type-opt" id="typePart" onclick="selectType('particular');accountType='particular'">
              <div class="to-icon">üë§</div>
              <div class="to-title">PARTICULAR</div>
              <div class="to-desc">Coleccionista o vendedor individual</div>
            </div>
            <div class="type-opt" id="typeEmp" onclick="selectType('empresa');accountType='empresa'">
              <div class="to-icon">üè™</div>
              <div class="to-title">EMPRESA</div>
              <div class="to-desc">Tienda, negocio o aut√≥nomo</div>
            </div>
          </div>

          <div class="reg-nav">
            <button class="btn-next-sm" id="btnR1" onclick="goRegStep(2)" disabled>Continuar ‚Üí</button>
          </div>
          <div class="terms-note">Al registrarte aceptas los <a>T√©rminos de uso</a> y la <a>Pol√≠tica de privacidad</a>.</div>
        </div>

        <!-- Step R2 ‚Äî Datos personales / empresa -->
        <div class="reg-panel" id="rp2">
          <div class="reg-step-title" id="r2Title">DATOS PERSONALES</div>
          <div class="reg-step-sub" id="r2Sub">Paso 2 de 4 ¬∑ Informaci√≥n b√°sica</div>

          <!-- Particular fields -->
          <div id="fieldsParticular">
            <div class="fg-row">
              <div class="form-group">
                <label class="fg-label">Nombre</label>
                <input class="fg-input" type="text" id="firstName" placeholder="Juan">
              </div>
              <div class="form-group">
                <label class="fg-label">Apellidos</label>
                <input class="fg-input" type="text" id="lastName" placeholder="Garc√≠a L√≥pez">
              </div>
            </div>
            <div class="form-group">
              <label class="fg-label">Nombre de usuario</label>
              <input class="fg-input" type="text" id="username" placeholder="trainer_juan" oninput="checkUsername(this)">
              <div class="fg-error" id="usernameError">El nombre de usuario ya est√° en uso</div>
            </div>
            <div class="form-group">
              <label class="fg-label">Email</label>
              <input class="fg-input" type="email" id="regEmail" placeholder="tu@email.com">
            </div>
            <div class="form-group">
              <label class="fg-label">Contrase√±a</label>
              <div class="input-icon-wrap">
                <input class="fg-input" type="password" id="regPass" placeholder="M√≠nimo 8 caracteres" oninput="checkPassStrength(this)">
                <button class="input-toggle" onclick="togglePass('regPass',this)">üëÅ</button>
              </div>
              <div id="passStrength" style="display:flex;gap:4px;margin-top:6px"></div>
            </div>
          </div>

          <!-- Empresa fields -->
          <div id="fieldsEmpresa" style="display:none">
            <div class="form-group">
              <label class="fg-label">Raz√≥n social</label>
              <input class="fg-input" type="text" id="companyName" placeholder="TCG Shop S.L.">
            </div>
            <div class="fg-row">
              <div class="form-group">
                <label class="fg-label">CIF / NIF</label>
                <input class="fg-input" type="text" id="companyCIF" placeholder="B12345678">
              </div>
              <div class="form-group">
                <label class="fg-label">Tipo</label>
                <select class="fg-input" id="companyType">
                  <option value="">Seleccionar...</option>
                  <option>S.L.</option>
                  <option>S.A.</option>
                  <option>Aut√≥nomo</option>
                  <option>S.C.</option>
                  <option>Otro</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="fg-label">Nombre comercial</label>
              <input class="fg-input" type="text" id="tradeName" placeholder="Nombre que ver√°n los compradores">
            </div>
            <div class="form-group">
              <label class="fg-label">Email de contacto</label>
              <input class="fg-input" type="email" id="companyEmail" placeholder="tienda@email.com">
            </div>
            <div class="form-group">
              <label class="fg-label">Tel√©fono</label>
              <input class="fg-input" type="tel" id="companyPhone" placeholder="+34 600 000 000">
            </div>
            <div class="form-group">
              <label class="fg-label">Contrase√±a</label>
              <div class="input-icon-wrap">
                <input class="fg-input" type="password" id="companyPass" placeholder="M√≠nimo 8 caracteres">
                <button class="input-toggle" onclick="togglePass('companyPass',this)">üëÅ</button>
              </div>
            </div>
          </div>

          <div class="reg-nav">
            <button class="btn-back-sm" onclick="goRegStep(1)">‚Üê</button>
            <button class="btn-next-sm" onclick="goRegStep(3);document.getElementById('btnFinish').disabled=false">Continuar ‚Üí</button>
          </div>
        </div>

        <!-- Step R3 ‚Äî Direcci√≥n + edad -->
        <div class="reg-panel" id="rp3">
          <div class="reg-step-title">DIRECCI√ìN DE ENV√çO</div>
          <div class="reg-step-sub">Paso 3 de 4 ¬∑ Ubicaci√≥n y edad</div>

          <div class="form-group">
            <label class="fg-label">Calle y n√∫mero</label>
            <input class="fg-input" type="text" id="addrStreet" placeholder="Calle Mayor 42, 3¬∫A">
          </div>
          <div class="fg-row">
            <div class="form-group">
              <label class="fg-label">C√≥digo postal</label>
              <input class="fg-input" type="text" id="addrCP" placeholder="28001" maxlength="5">
            </div>
            <div class="form-group">
              <label class="fg-label">Ciudad</label>
              <input class="fg-input" type="text" id="addrCity" placeholder="Madrid">
            </div>
          </div>
          <div class="fg-row">
            <div class="form-group">
              <label class="fg-label">Provincia</label>
              <input class="fg-input" type="text" id="addrProvince" placeholder="Madrid">
            </div>
            <div class="form-group">
              <label class="fg-label">Pa√≠s</label>
              <select class="fg-input" id="addrCountry">
                <option>Espa√±a</option>
                <option>Portugal</option>
                <option>Francia</option>
                <option>Alemania</option>
                <option>Italia</option>
                <option>Pa√≠ses Bajos</option>
                <option>B√©lgica</option>
                <option>Otro</option>
              </select>
            </div>
          </div>

          <div style="margin-top:6px;margin-bottom:6px">
            <div class="fg-label" style="margin-bottom:10px">Verificaci√≥n de edad</div>
            <div class="age-check" id="age18" onclick="selectAge('adult')">
              <div class="ac-radio"></div>
              <div class="ac-text">
                <div class="ac-title">Tengo 18 a√±os o m√°s</div>
                <div class="ac-desc">Acceso completo a todas las funciones de la plataforma.</div>
              </div>
            </div>
            <div class="age-check" id="ageMinor" onclick="selectAge('minor')">
              <div class="ac-radio"></div>
              <div class="ac-text">
                <div class="ac-title">Tengo menos de 18 a√±os</div>
                <div class="ac-desc">Necesitar√°s autorizaci√≥n de un tutor legal para operar.</div>
              </div>
            </div>
            <div class="minor-warning" id="minorWarning">
              ‚ö†Ô∏è Al ser menor de edad, tu tutor legal deber√° firmar una autorizaci√≥n que te enviaremos por email antes de poder publicar o comprar cartas.
            </div>
          </div>

          <div class="reg-nav">
            <button class="btn-back-sm" onclick="goRegStep(2)">‚Üê</button>
            <button class="btn-next-sm" onclick="goRegStep(4);document.getElementById('btnFinish').disabled=false">Continuar ‚Üí</button>
          </div>
        </div>

        <!-- Step R4 ‚Äî Datos fiscales empresa extra / confirmaci√≥n -->
        <div class="reg-panel" id="rp4">
          <div class="reg-step-title" id="r4Title">CASI LISTO</div>
          <div class="reg-step-sub" id="r4Sub">Paso 4 de 4 ¬∑ Confirmar registro</div>

          <!-- Extra empresa fiscal data -->
          <div id="empresaFiscal" style="display:none">
            <div class="form-group">
              <label class="fg-label">Direcci√≥n fiscal (si difiere)</label>
              <input class="fg-input" type="text" id="fiscalAddr" placeholder="Igual que direcci√≥n de env√≠o si coincide">
            </div>
            <div class="form-group">
              <label class="fg-label">IBAN (para cobros)</label>
              <input class="fg-input" type="text" id="companyIBAN" placeholder="ES00 0000 0000 0000 0000 0000">
            </div>
            <div class="form-group">
              <label class="fg-label">N√∫mero de registro mercantil (opcional)</label>
              <input class="fg-input" type="text" id="regMercantil" placeholder="Tomo X, Folio X, Hoja M-XXXXX">
            </div>
          </div>

          <!-- Summary -->
          <div id="regSummary" style="background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:16px;">
            <div style="font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;">Resumen del registro</div>
            <div id="summaryContent" style="display:flex;flex-direction:column;gap:7px;font-family:var(--font-mono);font-size:0.72rem;"></div>
          </div>

          <div class="form-group" style="display:flex;align-items:flex-start;gap:10px;margin-bottom:6px;">
            <input type="checkbox" id="acceptTerms" style="margin-top:3px;accent-color:var(--accent);width:15px;height:15px;flex-shrink:0;cursor:pointer;">
            <label for="acceptTerms" style="font-size:0.78rem;color:var(--text2);line-height:1.5;cursor:pointer;">
              Acepto los <a style="color:var(--accent);cursor:pointer">T√©rminos y Condiciones</a>, la <a style="color:var(--accent);cursor:pointer">Pol√≠tica de Privacidad</a> y la <a style="color:var(--accent);cursor:pointer">Pol√≠tica de Cookies</a> de Pple.tcg
            </label>
          </div>

          <div class="reg-nav">
            <button class="btn-back-sm" onclick="goRegStep(3);document.getElementById('btnFinish').disabled=false">‚Üê</button>
            <button class="btn-next-sm" id="btnFinish" onclick="accountType==='empresa'?doRegisterEmpresa():doRegister()" disabled>Crear cuenta ‚úì</button>
          </div>
        </div>

        <!-- Success -->
        <div class="reg-panel" id="rpSuccess">
          <div class="auth-success">
            <div class="as-icon">üéâ</div>
            <div class="as-title">¬°BIENVENIDO!</div>
            <div class="as-sub">Tu cuenta ha sido creada correctamente.<br>Ya puedes empezar a comprar y vender cartas.</div>
            <button class="btn-main" onclick="window.location.href='pple-tcg.html'">Ir al mercado ‚Üí</button>
          </div>
        </div>

      </div>
      <!-- end panelRegister -->

    </div>
  </div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

const SUPABASE_URL = 'https://iijreiuecodmqlcvhapp.supabase.co'
const SUPABASE_KEY = 'sb_publishable_XmQgiY0xFENpn4-6YXUoJA_gEovC6U8'
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

// ---- STATE ----
let accountType = null

// ---- CHECK SESSION ‚Äî si ya est√°s logueado, al marketplace ----
const { data: { session } } = await supabase.auth.getSession()
if (session) window.location.href = 'pple-tcg.html'

// ---- TABS ----
window.switchTab = function(tab) {
  document.querySelectorAll('.auth-tab').forEach((t,i) =>
    t.classList.toggle('active', (i===0&&tab==='login')||(i===1&&tab==='register')))
  document.getElementById('panelLogin').classList.toggle('hidden', tab !== 'login')
  document.getElementById('panelRegister').classList.toggle('hidden', tab !== 'register')
}

// ---- ACCOUNT TYPE ----
window.selectType = function(type) {
  accountType = type
  // show correct form
  document.getElementById('formParticular').style.display = type === 'particular' ? 'block' : 'none'
  document.getElementById('formEmpresa').style.display    = type === 'empresa' ? 'block' : 'none'
}

// ---- STEPS (visual only, keep existing) ----
window.goRegStep = function(step) {
  document.querySelectorAll('.reg-step').forEach((s,i) =>
    s.style.display = i === step-1 ? 'block' : 'none')
  document.querySelectorAll('.step-dot').forEach((d,i) => {
    d.classList.toggle('active', i === step-1)
    d.classList.toggle('done', i < step-1)
  })
}

// ---- LOGIN ----
window.doLogin = async function() {
  const email = document.getElementById('loginEmail').value.trim()
  const pass  = document.getElementById('loginPass').value
  const btn   = document.querySelector('[onclick="doLogin()"]')

  if (!email || !pass) { showAuthError('loginError', 'Rellena email y contrase√±a'); return }

  btn.textContent = 'Entrando...'
  btn.disabled = true

  const { error } = await supabase.auth.signInWithPassword({ email, password: pass })

  if (error) {
    showAuthError('loginError', 'Email o contrase√±a incorrectos')
    btn.textContent = 'Entrar ‚Üí'
    btn.disabled = false
  } else {
    btn.textContent = '‚úì Redirigiendo...'
    setTimeout(() => window.location.href = 'pple-tcg.html', 800)
  }
}

// ---- REGISTER PARTICULAR ----
window.btnFinish = undefined
window.doRegister = async function() {
  const username  = document.getElementById('username').value.trim()
  const firstName = document.getElementById('firstName').value.trim()
  const lastName  = document.getElementById('lastName').value.trim()
  const email     = document.getElementById('regEmail').value.trim()
  const pass      = document.getElementById('regPass').value
  const terms     = document.getElementById('acceptTerms')?.checked

  if (!username || !firstName || !email || !pass) {
    showAuthError('regError', 'Rellena todos los campos obligatorios'); return
  }
  if (pass.length < 6) { showAuthError('regError', 'Contrase√±a m√≠nimo 6 caracteres'); return }
  if (terms === false)  { showAuthError('regError', 'Acepta los t√©rminos para continuar'); return }

  const btn = document.getElementById('btnFinish')
  btn.textContent = 'Creando cuenta...'
  btn.disabled = true

  const { error } = await supabase.auth.signUp({
    email,
    password: pass,
    options: {
      data: {
        username,
        full_name: `${firstName} ${lastName}`.trim(),
        account_type: 'particular'
      }
    }
  })

  if (error) {
    showAuthError('regError', error.message === 'User already registered' ? 'Este email ya tiene una cuenta' : error.message)
    btn.textContent = 'Crear cuenta'
    btn.disabled = false
  } else {
    showSuccess(email)
  }
}

// ---- REGISTER EMPRESA ----
window.doRegisterEmpresa = async function() {
  const email    = document.getElementById('companyEmail').value.trim()
  const pass     = document.getElementById('companyPass').value
  const name     = document.getElementById('companyName').value.trim()
  const cif      = document.getElementById('companyCIF').value.trim()

  if (!email || !pass || !name || !cif) {
    showAuthError('regError', 'Rellena todos los campos obligatorios'); return
  }
  if (pass.length < 6) { showAuthError('regError', 'Contrase√±a m√≠nimo 6 caracteres'); return }

  const btn = document.getElementById('btnFinish')
  btn.textContent = 'Creando cuenta...'
  btn.disabled = true

  const { error } = await supabase.auth.signUp({
    email,
    password: pass,
    options: {
      data: {
        username: cif,
        full_name: name,
        account_type: 'empresa'
      }
    }
  })

  if (error) {
    showAuthError('regError', error.message === 'User already registered' ? 'Este email ya tiene una cuenta' : error.message)
    btn.textContent = 'Crear cuenta'
    btn.disabled = false
  } else {
    showSuccess(email)
  }
}

// ---- HELPERS ----
function showAuthError(id, msg) {
  let el = document.getElementById(id)
  if (!el) {
    el = document.createElement('div')
    el.id = id
    el.style.cssText = 'color:#ff4757;font-family:var(--font-mono);font-size:0.7rem;margin-top:10px;padding:8px 12px;background:rgba(255,71,87,0.08);border:1px solid rgba(255,71,87,0.2);border-radius:5px;'
    document.getElementById('panelRegister')?.appendChild(el) ||
    document.getElementById('panelLogin')?.appendChild(el)
  }
  el.textContent = msg
  el.style.display = 'block'
}

function showSuccess(email) {
  const panel = document.getElementById('panelRegister')
  panel.innerHTML = `
    <div style="text-align:center;padding:48px 20px;">
      <div style="font-size:3rem;margin-bottom:16px;">‚úÖ</div>
      <div style="font-family:var(--font-display);font-size:2rem;letter-spacing:2px;margin-bottom:12px;color:var(--text)">¬°CUENTA CREADA!</div>
      <div style="font-family:var(--font-mono);font-size:0.72rem;color:var(--text3);line-height:1.9;letter-spacing:0.5px;">
        Hemos enviado un email de confirmaci√≥n a<br>
        <span style="color:var(--accent)">${email}</span><br><br>
        Conf√≠rmalo y ya podr√°s acceder.
      </div>
    </div>`
}

// ---- SOCIAL (placeholder) ----
window.socialLogin = function(provider) {
  alert(`Login con ${provider} ‚Äî disponible pr√≥ximamente`)
}

// ---- TOGGLE PASSWORD ----
window.togglePass = function(id, btn) {
  const input = document.getElementById(id)
  if (!input) return
  input.type = input.type === 'password' ? 'text' : 'password'
  btn.textContent = input.type === 'password' ? 'üëÅ' : 'üôà'
}

// ---- ENTER KEY ----
document.getElementById('loginPass')?.addEventListener('keydown', e => {
  if (e.key === 'Enter') window.doLogin()
})
</script>
</body>
</html>
