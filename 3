<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg ¬∑ Buscar</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#08080d; --bg2:#0e0e16; --surface:#11111c; --surface2:#181825;
  --border:#22223a; --border2:#2d2d4a;
  --accent:#d4f53c; --accent-glow:rgba(212,245,60,0.15); --accent-dim:rgba(212,245,60,0.06);
  --text:#eeeef8; --text2:#9898b8; --text3:#55556a;
  --nm:#2ed573; --lp:#ffa502; --mp:#ff4757;
  --nm-bg:rgba(46,213,115,0.08); --lp-bg:rgba(255,165,2,0.08); --mp-bg:rgba(255,71,87,0.08);
  --psa10:#d4f53c; --psa9:#38bdf8; --psa8:#a78bfa;
  --sealed:#f59e0b; --sealed-bg:rgba(245,158,11,0.08);
  --font-display:'Bebas Neue',sans-serif;
  --font-mono:'DM Mono',monospace;
  --font-body:'Plus Jakarta Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay;}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* NAV */
nav{display:flex;align-items:center;gap:16px;padding:0 40px;height:60px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(8,8,13,0.96);backdrop-filter:blur(24px);z-index:100;}
.logo{font-family:var(--font-display);font-size:1.8rem;letter-spacing:3px;cursor:pointer;flex-shrink:0;}
.logo .dot{color:var(--accent);}

/* SEARCH BAR ‚Äî main element */
.search-wrap{flex:1;display:flex;align-items:center;gap:0;background:var(--surface);border:1px solid var(--border2);border-radius:8px;overflow:hidden;transition:border-color 0.15s;max-width:680px;}
.search-wrap:focus-within{border-color:var(--accent);}
.search-type-select{padding:0 14px;height:40px;background:var(--surface2);border:none;border-right:1px solid var(--border2);color:var(--text2);font-family:var(--font-mono);font-size:0.7rem;letter-spacing:0.5px;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%2355556a'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px;}
.search-type-select:focus{outline:none;}
.search-input{flex:1;height:40px;background:none;border:none;padding:0 14px;color:var(--text);font-family:var(--font-mono);font-size:0.82rem;outline:none;letter-spacing:0.3px;}
.search-input::placeholder{color:var(--text3);}
.search-btn{width:44px;height:40px;background:var(--accent);border:none;color:#08080d;font-size:1rem;cursor:pointer;transition:all 0.15s;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.search-btn:hover{box-shadow:inset 0 0 12px rgba(0,0,0,0.1);}

.nav-right{display:flex;gap:10px;align-items:center;margin-left:auto;flex-shrink:0;}
.btn-outline{padding:7px 16px;border:1px solid var(--border2);border-radius:5px;background:none;color:var(--text2);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-outline:hover{border-color:var(--accent);color:var(--accent);}
.btn-accent{padding:7px 18px;border:none;border-radius:5px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all 0.15s;}
.btn-accent:hover{box-shadow:0 0 20px var(--accent-glow);}

/* RESULTS BAR */
.results-bar{padding:14px 40px;border-bottom:1px solid var(--border);background:var(--bg2);display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;}
.rb-left{display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
.rb-query{font-family:var(--font-display);font-size:1.4rem;letter-spacing:1px;}
.rb-query .q{color:var(--accent);}
.rb-count{font-family:var(--font-mono);font-size:0.7rem;color:var(--text3);letter-spacing:0.5px;}
.rb-right{display:flex;align-items:center;gap:8px;}
.sort-label{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:1px;text-transform:uppercase;}
.sort-select{background:var(--surface);border:1px solid var(--border);border-radius:5px;padding:6px 28px 6px 10px;color:var(--text2);font-family:var(--font-mono);font-size:0.7rem;outline:none;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%2355556a'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;transition:border-color 0.15s;}
.sort-select:focus{border-color:var(--accent);}

/* LAYOUT */
.page-layout{display:grid;grid-template-columns:260px 1fr;max-width:1400px;margin:0 auto;min-height:calc(100vh - 120px);}

/* FILTERS SIDEBAR */
.filters-panel{border-right:1px solid var(--border);padding:24px 20px;position:sticky;top:60px;height:calc(100vh - 60px);overflow-y:auto;}
.fp-title{font-family:var(--font-display);font-size:1rem;letter-spacing:2px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;}
.fp-clear{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);cursor:pointer;letter-spacing:0.5px;transition:color 0.15s;font-weight:normal;}
.fp-clear:hover{color:var(--accent);}

.filter-group{margin-bottom:22px;}
.fg-title{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);}

/* Display type pills */
.type-pills{display:flex;flex-direction:column;gap:5px;}
.type-pill{display:flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--border);border-radius:6px;cursor:pointer;transition:all 0.15s;font-size:0.8rem;}
.type-pill:hover{border-color:var(--border2);background:var(--surface);}
.type-pill.active{border-color:var(--accent);background:var(--accent-dim);}
.type-pill.active-raw{border-color:var(--nm);background:var(--nm-bg);}
.type-pill.active-slab{border-color:var(--psa10);background:rgba(212,245,60,0.06);}
.type-pill.active-sealed{border-color:var(--sealed);background:var(--sealed-bg);}
.tp-icon{font-size:1rem;flex-shrink:0;}
.tp-label{font-size:0.8rem;font-weight:500;}
.tp-count{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);margin-left:auto;}

/* Condition checkboxes */
.cond-options{display:flex;flex-direction:column;gap:6px;}
.cond-opt{display:flex;align-items:center;gap:8px;cursor:pointer;padding:4px 0;}
.cond-opt input{accent-color:var(--accent);width:14px;height:14px;cursor:pointer;}
.co-label{font-size:0.8rem;display:flex;align-items:center;gap:6px;}
.co-badge{font-family:var(--font-mono);font-size:0.6rem;font-weight:700;padding:1px 6px;border-radius:3px;letter-spacing:0.5px;}
.co-nm{background:var(--nm-bg);border:1px solid rgba(46,213,115,0.2);color:var(--nm);}
.co-lp{background:var(--lp-bg);border:1px solid rgba(255,165,2,0.2);color:var(--lp);}
.co-mp{background:var(--mp-bg);border:1px solid rgba(255,71,87,0.2);color:var(--mp);}
.co-p10{background:rgba(212,245,60,0.08);border:1px solid rgba(212,245,60,0.2);color:var(--psa10);}
.co-p9{background:rgba(56,189,248,0.08);border:1px solid rgba(56,189,248,0.2);color:var(--psa9);}
.co-p8{background:rgba(167,139,250,0.08);border:1px solid rgba(167,139,250,0.2);color:var(--psa8);}
.co-count{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);margin-left:auto;}

/* Price range */
.price-range{display:flex;gap:8px;align-items:center;}
.pr-input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:5px;padding:7px 10px;color:var(--text);font-family:var(--font-mono);font-size:0.75rem;outline:none;transition:border-color 0.15s;width:0;}
.pr-input:focus{border-color:var(--accent);}
.pr-sep{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);}
.price-apply{width:100%;margin-top:8px;padding:7px;border:1px solid var(--border2);border-radius:5px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.68rem;font-weight:600;cursor:pointer;transition:all 0.15s;letter-spacing:0.5px;text-transform:uppercase;}
.price-apply:hover{border-color:var(--accent);color:var(--accent);}

/* Set search */
.set-search{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:5px;padding:7px 10px;color:var(--text);font-family:var(--font-mono);font-size:0.72rem;outline:none;transition:border-color 0.15s;margin-bottom:8px;}
.set-search:focus{border-color:var(--accent);}
.set-search::placeholder{color:var(--text3);}
.set-list{display:flex;flex-direction:column;gap:3px;max-height:180px;overflow-y:auto;}
.set-item{display:flex;align-items:center;gap:7px;padding:5px 4px;cursor:pointer;border-radius:4px;transition:background 0.12s;}
.set-item:hover{background:var(--surface);}
.set-item input{accent-color:var(--accent);width:13px;height:13px;cursor:pointer;flex-shrink:0;}
.set-name{font-family:var(--font-mono);font-size:0.68rem;color:var(--text2);}
.set-count{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-left:auto;}

/* Active filters */
.active-filters{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:14px;padding:0 40px;}
.af-tag{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;background:var(--surface);border:1px solid var(--border2);border-radius:20px;font-family:var(--font-mono);font-size:0.62rem;color:var(--text2);letter-spacing:0.3px;}
.af-remove{cursor:pointer;color:var(--text3);transition:color 0.12s;font-size:0.7rem;}
.af-remove:hover{color:var(--mp);}

/* RESULTS GRID */
.results-area{padding:24px 40px;}
.results-tabs{display:flex;gap:0;border:1px solid var(--border);border-radius:6px;overflow:hidden;width:fit-content;margin-bottom:20px;}
.rt-tab{padding:7px 20px;font-family:var(--font-mono);font-size:0.7rem;font-weight:500;letter-spacing:1px;text-transform:uppercase;color:var(--text3);cursor:pointer;border:none;background:none;border-right:1px solid var(--border);transition:all 0.15s;}
.rt-tab:last-child{border-right:none;}
.rt-tab:hover{background:var(--surface);color:var(--text2);}
.rt-tab.active{background:var(--accent);color:#08080d;font-weight:700;}
.rt-tab .tab-count{opacity:0.7;font-size:0.6rem;margin-left:5px;}

/* Product results */
.product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:10px;margin-bottom:28px;}
.result-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;transition:all 0.2s;position:relative;}
.result-card:hover{transform:translateY(-3px);border-color:var(--border2);box-shadow:0 12px 24px rgba(0,0,0,0.4);}
.rc-img{width:100%;height:125px;background:linear-gradient(135deg,#13132a,#1a1a35);display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;}
.rc-img img{width:100%;height:100%;object-fit:contain;padding:4px;}
.rc-type-badge{position:absolute;bottom:6px;left:6px;font-family:var(--font-mono);font-size:0.58rem;font-weight:700;padding:2px 6px;border-radius:3px;letter-spacing:0.5px;}
.rcb-raw{background:var(--nm-bg);border:1px solid rgba(46,213,115,0.3);color:var(--nm);}
.rcb-slab{background:rgba(212,245,60,0.1);border:1px solid rgba(212,245,60,0.3);color:var(--psa10);}
.rcb-sealed{background:var(--sealed-bg);border:1px solid rgba(245,158,11,0.3);color:var(--sealed);}
.rc-verified{position:absolute;top:6px;right:6px;width:18px;height:18px;border-radius:50%;background:var(--nm);display:flex;align-items:center;justify-content:center;font-size:0.5rem;color:#08080d;font-weight:700;}
.rc-body{padding:10px 11px;}
.rc-name{font-family:var(--font-display);font-size:0.9rem;letter-spacing:0.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:1px;}
.rc-set{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rc-seller{font-family:var(--font-mono);font-size:0.6rem;color:var(--text2);margin-bottom:6px;}
.rc-footer{display:flex;justify-content:space-between;align-items:center;}
.rc-price{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;color:var(--accent);}
.rc-stars{font-size:0.65rem;color:var(--accent);}

/* Seller results */
.sellers-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px;}
.seller-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:14px;}
.seller-card:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,0.3);}
.sc-av{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-size:1.3rem;color:#08080d;flex-shrink:0;}
.sc-info{flex:1;min-width:0;}
.sc-name{font-family:var(--font-display);font-size:1rem;letter-spacing:1px;margin-bottom:3px;display:flex;align-items:center;gap:7px;}
.sc-verified-badge{font-family:var(--font-mono);font-size:0.55rem;color:var(--nm);background:var(--nm-bg);border:1px solid rgba(46,213,115,0.2);border-radius:3px;padding:1px 5px;}
.sc-meta{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);margin-bottom:5px;letter-spacing:0.3px;}
.sc-stats{display:flex;gap:10px;}
.sc-stat{font-family:var(--font-mono);font-size:0.62rem;color:var(--text2);}
.sc-stat span{color:var(--accent);}
.sc-rating{font-family:var(--font-display);font-size:1.2rem;letter-spacing:0.5px;color:var(--accent);flex-shrink:0;}

/* Empty / no results */
.no-results{padding:60px 20px;text-align:center;}
.nr-icon{font-size:3rem;margin-bottom:16px;opacity:0.4;}
.nr-title{font-family:var(--font-display);font-size:1.6rem;letter-spacing:2px;margin-bottom:8px;color:var(--text2);}
.nr-sub{font-family:var(--font-mono);font-size:0.7rem;color:var(--text3);letter-spacing:0.5px;}

@media(max-width:900px){
  nav{padding:0 16px;gap:10px;}
  .nav-right{display:none;}
  .results-bar{padding:12px 18px;}
  .active-filters{padding:0 18px;}
  .page-layout{grid-template-columns:1fr;}
  .filters-panel{display:none;}
  .results-area{padding:16px 18px;}
  .product-grid{grid-template-columns:repeat(auto-fill,minmax(145px,1fr));}
}
</style>
</head>
<body>

<nav>
  <div class="logo" onclick="window.location.href='pple-tcg.html'">PPLE<span class="dot">.</span>TCG</div>
  <div class="search-wrap">
    <select class="search-type-select" id="searchType" onchange="handleTypeChange()">
      <option value="product">Producto</option>
      <option value="seller">Vendedores</option>
    </select>
    <input class="search-input" type="text" id="searchInput" placeholder="Buscar carta, set, producto sellado..." value="Charizard" onkeydown="handleSearchKey(event)">
    <button class="search-btn" onclick="doSearch()">‚åï</button>
  </div>
  <div class="nav-right">
    <button class="btn-outline" onclick="window.location.href='pple-tcg-auth.html'">Entrar</button>
    <button class="btn-accent">Registrarse</button>
  </div>
</nav>

<!-- RESULTS BAR -->
<div class="results-bar">
  <div class="rb-left">
    <div class="rb-query">RESULTADOS PARA <span class="q" id="queryDisplay">"Charizard"</span></div>
    <div class="rb-count" id="resultsCount">‚Äî resultados</div>
  </div>
  <div class="rb-right">
    <span class="sort-label">Ordenar</span>
    <select class="sort-select" id="sortSelect" onchange="applyFilters()">
      <option value="price_asc">Precio: menor a mayor</option>
      <option value="price_desc">Precio: mayor a menor</option>
      <option value="relevance" selected>Relevancia</option>
      <option value="rating">Valoraci√≥n vendedor</option>
      <option value="recent">M√°s reciente</option>
    </select>
  </div>
</div>

<!-- ACTIVE FILTERS -->
<div class="active-filters" id="activeFilters"></div>

<div class="page-layout">

  <!-- FILTERS -->
  <div class="filters-panel">
    <div class="fp-title">FILTROS <span class="fp-clear" onclick="clearAllFilters()">Limpiar todo</span></div>

    <!-- Type -->
    <div class="filter-group">
      <div class="fg-title">Tipo de producto</div>
      <div class="type-pills">
        <div class="type-pill active" id="typeAll" onclick="setType('all',this)">
          <span class="tp-icon">üîç</span><span class="tp-label">Todo</span><span class="tp-count" id="countAll">‚Äî</span>
        </div>
        <div class="type-pill" id="typeRaw" onclick="setType('raw',this)">
          <span class="tp-icon">üÉè</span><span class="tp-label">RAW</span><span class="tp-count" id="countRaw">‚Äî</span>
        </div>
        <div class="type-pill" id="typeSlab" onclick="setType('slab',this)">
          <span class="tp-icon">üèÜ</span><span class="tp-label">Slab PSA</span><span class="tp-count" id="countSlab">‚Äî</span>
        </div>
        <div class="type-pill" id="typeSealed" onclick="setType('sealed',this)">
          <span class="tp-icon">üì¶</span><span class="tp-label">Sellado</span><span class="tp-count" id="countSealed">‚Äî</span>
        </div>
      </div>
    </div>

    <!-- Condition (shown for RAW/all) -->
    <div class="filter-group" id="condGroup">
      <div class="fg-title">Estado / Condici√≥n</div>
      <div class="cond-options">
        <label class="cond-opt"><input type="checkbox" value="NM" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-nm">NM</span> Near Mint</span><span class="co-count">‚Äî</span></label>
        <label class="cond-opt"><input type="checkbox" value="LP" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-lp">LP</span> Lightly Played</span><span class="co-count">‚Äî</span></label>
        <label class="cond-opt"><input type="checkbox" value="MP" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-mp">MP</span> Moderately Played</span><span class="co-count">‚Äî</span></label>
      </div>
    </div>

    <!-- PSA grades (shown for slab) -->
    <div class="filter-group" id="gradeGroup" style="display:none">
      <div class="fg-title">Grado PSA</div>
      <div class="cond-options">
        <label class="cond-opt"><input type="checkbox" value="PSA10" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-p10">PSA 10</span></span><span class="co-count">‚Äî</span></label>
        <label class="cond-opt"><input type="checkbox" value="PSA9" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-p9">PSA 9</span></span><span class="co-count">‚Äî</span></label>
        <label class="cond-opt"><input type="checkbox" value="PSA8" onchange="applyFilters()"><span class="co-label"><span class="co-badge co-p8">PSA 8</span></span><span class="co-count">‚Äî</span></label>
      </div>
    </div>

    <!-- Price range -->
    <div class="filter-group">
      <div class="fg-title">Precio (‚Ç¨)</div>
      <div class="price-range">
        <input class="pr-input" type="number" id="priceMin" placeholder="M√≠n" min="0">
        <span class="pr-sep">‚Äî</span>
        <input class="pr-input" type="number" id="priceMax" placeholder="M√°x" min="0">
      </div>
      <button class="price-apply" onclick="applyFilters()">Aplicar rango</button>
    </div>

    <!-- Set -->
    <div class="filter-group">
      <div class="fg-title">Colecci√≥n / Set</div>
      <input class="set-search" type="text" placeholder="Buscar set..." oninput="filterSets(this.value)">
      <div class="set-list" id="setList"></div>
    </div>
  </div>

  <!-- RESULTS -->
  <div class="results-area">
    <div class="results-tabs" id="resultsTabs">
      <button class="rt-tab active" onclick="switchTab('product',this)">Producto<span class="tab-count" id="tabCountProduct"></span></button>
      <button class="rt-tab" onclick="switchTab('seller',this)">Vendedores<span class="tab-count" id="tabCountSeller"></span></button>
    </div>

    <div id="productResults"></div>
    <div id="sellerResults" style="display:none"></div>
  </div>
</div>

<script>
// ---- MOCK DATA ----
const PRODUCTS = [
  { id:1, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'raw',    cond:'NM',    price:124.50, seller:'TrainerRed99',  sellerRating:4.9, verified:true  },
  { id:2, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'raw',    cond:'LP',    price:89.00,  seller:'CardShopMdrid', sellerRating:4.7, verified:false },
  { id:3, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'slab',   cond:'PSA10', price:520.00, seller:'Pok√©Collector',  sellerRating:5.0, verified:true  },
  { id:4, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'slab',   cond:'PSA9',  price:280.00, seller:'PokeMarket_EU', sellerRating:4.8, verified:true  },
  { id:5, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'slab',   cond:'PSA8',  price:165.00, seller:'tcg_madrid',    sellerRating:4.6, verified:false },
  { id:6, name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'raw',    cond:'NM',    price:118.00, seller:'HoloHunter',    sellerRating:4.9, verified:true  },
  { id:7, name:'Booster Box Obsidian Flames',set:'Obsidian Flames',img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',  type:'sealed', cond:'SEALED',price:185.00, seller:'CardShopMdrid', sellerRating:4.7, verified:false },
  { id:8, name:'Charizard ex',         set:'Paldean Fates',      img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'raw',    cond:'NM',    price:42.00,  seller:'Pok√©Fan_ES',     sellerRating:4.5, verified:false },
  { id:9, name:'Charizard ex',         set:'Paldean Fates',      img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'slab',   cond:'PSA10', price:190.00, seller:'TrainerRed99',  sellerRating:4.9, verified:true  },
  { id:10,name:'Charizard ex',         set:'Obsidian Flames',    img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',     type:'raw',    cond:'MP',    price:67.00,  seller:'GottaCatchEm',  sellerRating:4.3, verified:false },
];

const SELLERS = [
  { name:'TrainerRed99',  color:'linear-gradient(135deg,#1a1a2e,#e94560)', rating:4.9, sales:247, listings:18, location:'Madrid',    verified:true  },
  { name:'CardShopMadrid',color:'linear-gradient(135deg,#0f3460,#533483)', rating:4.7, sales:512, listings:34, location:'Madrid',    verified:true  },
  { name:'Pok√©Collector',  color:'linear-gradient(135deg,#2d6a4f,#d4f53c)', rating:5.0, sales:89,  listings:12, location:'Barcelona', verified:true  },
  { name:'HoloHunter',    color:'linear-gradient(135deg,#3d1a6e,#d4f53c)', rating:4.9, sales:156, listings:9,  location:'Valencia',  verified:false },
  { name:'Pok√©Fan_ES',     color:'linear-gradient(135deg,#6e1a1a,#f53c3c)', rating:4.5, sales:44,  listings:6,  location:'Sevilla',   verified:false },
];

const SETS = ['Obsidian Flames','Paldea Evolved','151','Temporal Forces','Twilight Masquerade','Paradox Rift','Paldean Fates','Scarlet & Violet Base'];

let currentType = 'all';
let currentTab  = 'product';
let activeSetFilters = [];

// ---- INIT ----
function init() {
  renderSetList();
  applyFilters();
  updateCounts();
}

function handleTypeChange() {
  const t = document.getElementById('searchType').value;
  const input = document.getElementById('searchInput');
  input.placeholder = t === 'seller' ? 'Buscar vendedor...' : 'Buscar carta, set, producto sellado...';
  if (t === 'seller') {
    switchTab('seller', document.querySelectorAll('.rt-tab')[1]);
  } else {
    switchTab('product', document.querySelectorAll('.rt-tab')[0]);
  }
}

function handleSearchKey(e) {
  if (e.key === 'Enter') doSearch();
}

function doSearch() {
  const q = document.getElementById('searchInput').value.trim() || 'Charizard';
  document.getElementById('queryDisplay').textContent = `"${q}"`;
  applyFilters();
}

// ---- TYPE FILTER ----
function setType(type, el) {
  currentType = type;
  document.querySelectorAll('.type-pill').forEach(p => {
    p.className = 'type-pill';
  });
  const cls = type === 'all' ? 'active' : type === 'raw' ? 'active-raw' : type === 'slab' ? 'active-slab' : 'active-sealed';
  el.classList.add(cls);
  document.getElementById('condGroup').style.display  = (type === 'all' || type === 'raw') ? 'block' : 'none';
  document.getElementById('gradeGroup').style.display = (type === 'slab') ? 'block' : 'none';
  applyFilters();
}

// ---- APPLY FILTERS ----
function applyFilters() {
  const q        = document.getElementById('searchInput').value.toLowerCase();
  const sort     = document.getElementById('sortSelect').value;
  const priceMin = parseFloat(document.getElementById('priceMin').value) || 0;
  const priceMax = parseFloat(document.getElementById('priceMax').value) || Infinity;
  const checkedConds = [...document.querySelectorAll('#condGroup input:checked')].map(i=>i.value);
  const checkedGrades= [...document.querySelectorAll('#gradeGroup input:checked')].map(i=>i.value);

  let filtered = PRODUCTS.filter(p => {
    if (q && !p.name.toLowerCase().includes(q) && !p.set.toLowerCase().includes(q) && !p.seller.toLowerCase().includes(q)) return false;
    if (currentType !== 'all' && p.type !== currentType) return false;
    if (p.price < priceMin || p.price > priceMax) return false;
    if (checkedConds.length && p.type === 'raw' && !checkedConds.includes(p.cond)) return false;
    if (checkedGrades.length && p.type === 'slab' && !checkedGrades.includes(p.cond)) return false;
    if (activeSetFilters.length && !activeSetFilters.includes(p.set)) return false;
    return true;
  });

  // Sort
  if (sort === 'price_asc')  filtered.sort((a,b) => a.price - b.price);
  if (sort === 'price_desc') filtered.sort((a,b) => b.price - a.price);
  if (sort === 'rating')     filtered.sort((a,b) => b.sellerRating - a.sellerRating);

  // Sellers filter
  const sq = document.getElementById('searchInput').value.toLowerCase();
  const filteredSellers = SELLERS.filter(s =>
    !sq || s.name.toLowerCase().includes(sq) || s.location.toLowerCase().includes(sq)
  );

  renderProducts(filtered);
  renderSellers(filteredSellers);
  updateCounts(filtered, filteredSellers);
  renderActiveFilters(checkedConds, checkedGrades, priceMin, priceMax);
}

// ---- RENDER PRODUCTS ----
function renderProducts(items) {
  if (!items.length) {
    document.getElementById('productResults').innerHTML = `
      <div class="no-results">
        <div class="nr-icon">üîç</div>
        <div class="nr-title">SIN RESULTADOS</div>
        <div class="nr-sub">Prueba con otros filtros o un t√©rmino de b√∫squeda diferente</div>
      </div>`;
    return;
  }
  document.getElementById('productResults').innerHTML = `<div class="product-grid">` +
    items.map(p => {
      const isPsa = p.type === 'slab';
      const isSealed = p.type === 'sealed';
      const badgeClass = isPsa ? 'rcb-slab' : isSealed ? 'rcb-sealed' : 'rcb-raw';
      const badgeText  = isPsa ? p.cond.replace('PSA','PSA ') : isSealed ? 'SELLADO' : p.cond;
      const stars = '‚òÖ'.repeat(Math.round(p.sellerRating)) + '‚òÜ'.repeat(5-Math.round(p.sellerRating));
      return `
      <div class="result-card" onclick="window.location.href='pple-tcg-perfil.html'">
        <div class="rc-img">
          <img src="${p.img}" alt="${p.name}" onerror="this.parentNode.innerHTML='üé¥'">
          <div class="rc-type-badge ${badgeClass}">${badgeText}</div>
          ${p.verified ? '<div class="rc-verified">‚úì</div>' : ''}
        </div>
        <div class="rc-body">
          <div class="rc-name">${p.name}</div>
          <div class="rc-set">${p.set}</div>
          <div class="rc-seller">@${p.seller}</div>
          <div class="rc-footer">
            <div class="rc-price">‚Ç¨${p.price.toFixed(2)}</div>
            <div class="rc-stars">${stars}</div>
          </div>
        </div>
      </div>`;
    }).join('') + `</div>`;
}

// ---- RENDER SELLERS ----
function renderSellers(items) {
  if (!items.length) {
    document.getElementById('sellerResults').innerHTML = `
      <div class="no-results">
        <div class="nr-icon">üë§</div>
        <div class="nr-title">SIN VENDEDORES</div>
        <div class="nr-sub">No se encontraron vendedores con ese nombre</div>
      </div>`;
    return;
  }
  document.getElementById('sellerResults').innerHTML = `<div class="sellers-grid">` +
    items.map(s => `
    <div class="seller-card" onclick="window.location.href='pple-tcg-perfil.html'">
      <div class="sc-av" style="background:${s.color}">${s.name[0]}</div>
      <div class="sc-info">
        <div class="sc-name">
          ${s.name}
          ${s.verified ? '<span class="sc-verified-badge">‚úì Verificado</span>' : ''}
        </div>
        <div class="sc-meta">üìç ${s.location} ¬∑ Miembro desde 2023</div>
        <div class="sc-stats">
          <span class="sc-stat"><span>${s.sales}</span> ventas</span>
          <span class="sc-stat"><span>${s.listings}</span> en venta</span>
        </div>
      </div>
      <div class="sc-rating">${s.rating}</div>
    </div>`).join('') + `</div>`;
}

// ---- COUNTS ----
function updateCounts(filtered, filteredSellers) {
  const all    = filtered?.length ?? PRODUCTS.length;
  const raw    = (filtered ?? PRODUCTS).filter(p=>p.type==='raw').length;
  const slab   = (filtered ?? PRODUCTS).filter(p=>p.type==='slab').length;
  const sealed = (filtered ?? PRODUCTS).filter(p=>p.type==='sealed').length;
  const sellers= filteredSellers?.length ?? SELLERS.length;

  document.getElementById('countAll').textContent    = all;
  document.getElementById('countRaw').textContent    = raw;
  document.getElementById('countSlab').textContent   = slab;
  document.getElementById('countSealed').textContent = sealed;
  document.getElementById('resultsCount').textContent= `${all} productos ¬∑ ${sellers} vendedores`;
  document.getElementById('tabCountProduct').textContent = ` (${all})`;
  document.getElementById('tabCountSeller').textContent  = ` (${sellers})`;
}

// ---- ACTIVE FILTER TAGS ----
function renderActiveFilters(conds, grades, min, max) {
  const tags = [];
  if (currentType !== 'all') tags.push({ label: currentType.toUpperCase(), key:'type' });
  conds.forEach(c  => tags.push({ label:c, key:`cond_${c}` }));
  grades.forEach(g => tags.push({ label:g.replace('PSA','PSA '), key:`grade_${g}` }));
  if (min > 0)           tags.push({ label:`Desde ‚Ç¨${min}`, key:'priceMin' });
  if (max < Infinity)    tags.push({ label:`Hasta ‚Ç¨${max}`, key:'priceMax' });
  activeSetFilters.forEach(s => tags.push({ label:s, key:`set_${s}` }));

  document.getElementById('activeFilters').innerHTML = tags.map(t =>
    `<div class="af-tag">${t.label}<span class="af-remove" onclick="removeFilter('${t.key}')">‚úï</span></div>`
  ).join('');
}

function removeFilter(key) {
  if (key === 'type') { setType('all', document.getElementById('typeAll')); return; }
  if (key.startsWith('cond_')) {
    const v = key.replace('cond_','');
    document.querySelector(`#condGroup input[value="${v}"]`).checked = false;
  }
  if (key.startsWith('grade_')) {
    const v = key.replace('grade_','');
    document.querySelector(`#gradeGroup input[value="${v}"]`).checked = false;
  }
  if (key === 'priceMin') document.getElementById('priceMin').value = '';
  if (key === 'priceMax') document.getElementById('priceMax').value = '';
  if (key.startsWith('set_')) {
    activeSetFilters = activeSetFilters.filter(s => s !== key.replace('set_',''));
    renderSetList();
  }
  applyFilters();
}

function clearAllFilters() {
  setType('all', document.getElementById('typeAll'));
  document.querySelectorAll('#condGroup input, #gradeGroup input').forEach(i => i.checked = false);
  document.getElementById('priceMin').value = '';
  document.getElementById('priceMax').value = '';
  activeSetFilters = [];
  renderSetList();
  applyFilters();
}

// ---- SET LIST ----
function renderSetList(filter='') {
  document.getElementById('setList').innerHTML = SETS
    .filter(s => !filter || s.toLowerCase().includes(filter.toLowerCase()))
    .map(s => `
      <div class="set-item">
        <input type="checkbox" value="${s}" ${activeSetFilters.includes(s)?'checked':''} onchange="toggleSet('${s}',this)">
        <span class="set-name">${s}</span>
        <span class="set-count">${PRODUCTS.filter(p=>p.set===s).length}</span>
      </div>`).join('');
}

function filterSets(q) { renderSetList(q); }

function toggleSet(set, input) {
  if (input.checked) activeSetFilters.push(set);
  else activeSetFilters = activeSetFilters.filter(s => s !== set);
  applyFilters();
}

// ---- TABS ----
function switchTab(tab, btn) {
  currentTab = tab;
  document.querySelectorAll('.rt-tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('productResults').style.display = tab === 'product' ? 'block' : 'none';
  document.getElementById('sellerResults').style.display  = tab === 'seller'  ? 'block' : 'none';
  document.getElementById('condGroup').closest('.filters-panel').style.display = tab === 'seller' ? 'none' : '';
}

init();
</script>
</body>
</html>
