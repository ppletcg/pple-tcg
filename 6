<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pple.tcg ¬∑ Portfolio</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#08080d; --bg2:#0e0e16; --surface:#11111c; --surface2:#181825;
  --border:#22223a; --border2:#2d2d4a;
  --accent:#d4f53c; --accent-glow:rgba(212,245,60,0.15); --accent-dim:rgba(212,245,60,0.06);
  --text:#eeeef8; --text2:#9898b8; --text3:#55556a;
  --nm:#2ed573; --lp:#ffa502; --mp:#ff4757;
  --nm-bg:rgba(46,213,115,0.08); --lp-bg:rgba(255,165,2,0.08); --mp-bg:rgba(255,71,87,0.08);
  --psa10:#d4f53c; --psa9:#38bdf8; --psa8:#a78bfa;
  --sealed:#f59e0b;
  --sealed-bg:rgba(245,158,11,0.08);
  --font-display:'Bebas Neue',sans-serif;
  --font-mono:'DM Mono',monospace;
  --font-body:'Plus Jakarta Sans',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay;}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* NAV */
nav{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:60px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(8,8,13,0.96);backdrop-filter:blur(24px);z-index:100;}
.logo{font-family:var(--font-display);font-size:1.8rem;letter-spacing:3px;cursor:pointer;}
.logo .dot{color:var(--accent);}
.nav-pills{display:flex;gap:0;border:1px solid var(--border);border-radius:6px;overflow:hidden;}
.nav-tab{padding:7px 22px;font-family:var(--font-mono);font-size:0.72rem;font-weight:500;letter-spacing:1px;text-transform:uppercase;color:var(--text2);cursor:pointer;border:none;background:none;border-right:1px solid var(--border);transition:all 0.15s;}
.nav-tab:last-child{border-right:none;}
.nav-tab:hover{background:var(--surface);color:var(--text);}
.nav-tab.active{background:var(--accent);color:#08080d;font-weight:700;}
.nav-right{display:flex;gap:10px;align-items:center;}
.nav-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#3d2a6e,#d4f53c);display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;color:#08080d;cursor:pointer;border:1px solid rgba(212,245,60,0.3);}
.btn-accent{padding:7px 18px;border:none;border-radius:5px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all 0.15s;}
.btn-accent:hover{box-shadow:0 0 20px var(--accent-glow);transform:translateY(-1px);}

/* PAGE HEADER */
.page-header{padding:32px 40px 28px;border-bottom:1px solid var(--border);background:var(--bg2);display:flex;align-items:flex-end;justify-content:space-between;gap:24px;flex-wrap:wrap;}
.ph-left{}
.ph-eyebrow{font-family:var(--font-mono);font-size:0.65rem;color:var(--accent);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;}
.ph-title{font-family:var(--font-display);font-size:2.8rem;letter-spacing:2px;line-height:1;margin-bottom:4px;}
.ph-user{font-family:var(--font-mono);font-size:0.72rem;color:var(--text3);letter-spacing:1px;}
.ph-right{display:flex;gap:8px;}
.btn-outline{padding:8px 16px;border:1px solid var(--border2);border-radius:6px;background:none;color:var(--text2);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:0.5px;cursor:pointer;transition:all 0.15s;text-transform:uppercase;}
.btn-outline:hover{border-color:var(--accent);color:var(--accent);}

/* MAIN */
.main{max-width:1400px;margin:0 auto;padding:28px 40px 80px;}

/* KPI ROW */
.kpi-row{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-bottom:24px;}
.kpi-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 18px;transition:border-color 0.15s;}
.kpi-card:hover{border-color:var(--border2);}
.kpi-card.highlight{border-color:rgba(212,245,60,0.2);background:var(--accent-dim);}
.kc-label{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;}
.kc-val{font-family:var(--font-display);font-size:1.8rem;letter-spacing:1px;line-height:1;color:var(--text);}
.kc-val.accent{color:var(--accent);}
.kc-sub{font-family:var(--font-mono);font-size:0.65rem;margin-top:5px;}
.kc-up{color:var(--nm);}
.kc-down{color:var(--mp);}
.kc-flat{color:var(--text3);}

/* CHART SECTION */
.chart-section{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:24px;}
.cs-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.cs-title{font-family:var(--font-display);font-size:1.3rem;letter-spacing:1px;}
.cs-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);margin-top:2px;letter-spacing:0.5px;}
.period-tabs{display:flex;gap:4px;}
.pt-btn{padding:4px 12px;border-radius:4px;border:1px solid var(--border);background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.65rem;cursor:pointer;transition:all 0.12s;letter-spacing:0.3px;}
.pt-btn.active{background:var(--accent);border-color:var(--accent);color:#08080d;font-weight:700;}
.chart-wrap{position:relative;}
svg.portfolio-chart{width:100%;height:180px;}
.chart-labels{display:flex;justify-content:space-between;margin-top:8px;padding:0 2px;}
.chart-lbl{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:0.3px;}
.chart-tooltip{position:absolute;background:var(--surface2);border:1px solid var(--border2);border-radius:6px;padding:8px 12px;font-family:var(--font-mono);font-size:0.7rem;pointer-events:none;display:none;white-space:nowrap;}
.ct-date{color:var(--text3);font-size:0.62rem;margin-bottom:3px;}
.ct-val{color:var(--accent);font-weight:500;}

/* SECTION HEADERS */
.section{margin-bottom:28px;}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.sh-left{display:flex;align-items:center;gap:12px;}
.sh-icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;}
.sh-icon.raw{background:var(--nm-bg);border:1px solid rgba(46,213,115,0.2);}
.sh-icon.psa{background:rgba(212,245,60,0.07);border:1px solid rgba(212,245,60,0.15);}
.sh-icon.sealed{background:var(--sealed-bg);border:1px solid rgba(245,158,11,0.2);}
.sh-icon.wish{background:var(--mp-bg);border:1px solid rgba(255,71,87,0.15);}
.sh-title{font-family:var(--font-display);font-size:1.2rem;letter-spacing:1px;}
.sh-count{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:1px;}
.sh-value{font-family:var(--font-display);font-size:1.1rem;letter-spacing:0.5px;color:var(--accent);}
.sh-right{display:flex;align-items:center;gap:10px;}
.add-btn{display:flex;align-items:center;gap:6px;padding:6px 14px;border:1px solid var(--border2);border-radius:5px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.68rem;font-weight:600;cursor:pointer;transition:all 0.15s;letter-spacing:0.3px;text-transform:uppercase;}
.add-btn:hover{border-color:var(--accent);color:var(--accent);}

/* CARDS GRID */
.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;}

.pcard{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;transition:all 0.2s;position:relative;}
.pcard:hover{transform:translateY(-3px);border-color:var(--border2);box-shadow:0 12px 24px rgba(0,0,0,0.4);}
.pcard.for-sale{border-color:rgba(212,245,60,0.2);}
.pcard.for-sale::after{content:'EN VENTA';position:absolute;top:7px;right:7px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.55rem;font-weight:700;letter-spacing:1px;padding:2px 6px;border-radius:3px;}

.pcard-img{width:100%;height:130px;background:linear-gradient(135deg,#13132a,#1a1a35);display:flex;align-items:center;justify-content:center;font-size:2rem;overflow:hidden;position:relative;}
.pcard-img img{width:100%;height:100%;object-fit:contain;padding:4px;}

/* slab frame effect */
.pcard.is-slab .pcard-img{background:linear-gradient(135deg,#1a1a0a,#2a2a10,#1a1a0a);border-bottom:2px solid rgba(212,245,60,0.15);}

.pc-grade{position:absolute;bottom:6px;left:6px;font-family:var(--font-mono);font-size:0.6rem;font-weight:700;padding:2px 7px;border-radius:3px;letter-spacing:0.5px;}
.grade-10{background:rgba(212,245,60,0.2);border:1px solid rgba(212,245,60,0.4);color:#d4f53c;}
.grade-9{background:rgba(56,189,248,0.15);border:1px solid rgba(56,189,248,0.3);color:#38bdf8;}
.grade-8{background:rgba(167,139,250,0.15);border:1px solid rgba(167,139,250,0.3);color:#a78bfa;}
.cond-raw{position:absolute;bottom:6px;left:6px;font-family:var(--font-mono);font-size:0.6rem;font-weight:700;padding:2px 7px;border-radius:3px;letter-spacing:0.5px;}
.raw-nm{background:rgba(46,213,115,0.15);border:1px solid rgba(46,213,115,0.3);color:var(--nm);}
.raw-lp{background:rgba(255,165,2,0.15);border:1px solid rgba(255,165,2,0.3);color:var(--lp);}

.pcard-body{padding:10px 11px;}
.pc-name{font-family:var(--font-display);font-size:0.9rem;letter-spacing:0.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:1px;}
.pc-set{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-bottom:7px;letter-spacing:0.3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.pc-footer{display:flex;justify-content:space-between;align-items:baseline;}
.pc-price{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;}
.pc-chg{font-family:var(--font-mono);font-size:0.6rem;}
.chg-up{color:var(--nm);}
.chg-down{color:var(--mp);}
.pc-paid{font-family:var(--font-mono);font-size:0.58rem;color:var(--text3);margin-top:3px;}

/* Sealed product grid */
.sealed-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:10px;}
.sealed-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;transition:all 0.2s;}
.sealed-card:hover{transform:translateY(-3px);border-color:rgba(245,158,11,0.3);box-shadow:0 12px 24px rgba(0,0,0,0.4);}
.sc-img{width:100%;height:150px;background:linear-gradient(135deg,#1a1208,#2a200a,#1a1208);display:flex;align-items:center;justify-content:center;font-size:2.5rem;overflow:hidden;}
.sc-img img{width:100%;height:100%;object-fit:contain;padding:8px;}
.sc-body{padding:11px 12px;}
.sc-type{font-family:var(--font-mono);font-size:0.6rem;color:var(--sealed);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:4px;}
.sc-name{font-family:var(--font-display);font-size:0.95rem;letter-spacing:0.5px;margin-bottom:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sc-set{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);margin-bottom:7px;letter-spacing:0.3px;}
.sc-footer{display:flex;justify-content:space-between;align-items:baseline;}
.sc-price{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;color:var(--sealed);}
.sc-trend{font-family:var(--font-mono);font-size:0.6rem;}
.sc-qty{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);margin-top:3px;}
.sealed-badge{display:inline-flex;align-items:center;gap:4px;background:var(--sealed-bg);border:1px solid rgba(245,158,11,0.2);border-radius:3px;padding:2px 7px;font-family:var(--font-mono);font-size:0.6rem;color:var(--sealed);letter-spacing:0.5px;}

/* Wishlist */
.wish-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:8px;}
.wish-item{display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--surface);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all 0.15s;}
.wish-item:hover{border-color:var(--border2);}
.wi-img{width:36px;height:50px;object-fit:contain;border-radius:4px;background:var(--surface2);flex-shrink:0;}
.wi-info{flex:1;min-width:0;}
.wi-name{font-size:0.83rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px;}
.wi-set{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:0.3px;}
.wi-target{font-family:var(--font-mono);font-size:0.62rem;color:var(--text3);margin-top:3px;}
.wi-target span{color:var(--accent);}
.wi-price{text-align:right;flex-shrink:0;}
.wi-current{font-family:var(--font-display);font-size:1rem;letter-spacing:0.5px;}
.wi-diff{font-family:var(--font-mono);font-size:0.62rem;margin-top:2px;}
.wi-alert{width:28px;height:28px;border-radius:50%;border:1px solid rgba(212,245,60,0.2);background:var(--accent-dim);display:flex;align-items:center;justify-content:center;font-size:0.7rem;flex-shrink:0;cursor:pointer;transition:all 0.15s;}
.wi-alert:hover{background:var(--accent);border-color:var(--accent);}
.wi-alert.active{background:var(--accent);border-color:var(--accent);}

/* Empty states */
.empty-state{padding:32px;text-align:center;border:1.5px dashed var(--border);border-radius:10px;cursor:pointer;transition:all 0.15s;}
.empty-state:hover{border-color:var(--border2);}
.es-icon{font-size:2rem;margin-bottom:10px;opacity:0.5;}
.es-title{font-family:var(--font-display);font-size:1rem;letter-spacing:1px;color:var(--text2);margin-bottom:4px;}
.es-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:0.3px;}

/* Add card modal */
.modal-overlay{position:fixed;inset:0;background:rgba(4,4,8,0.9);backdrop-filter:blur(16px);z-index:500;display:none;align-items:center;justify-content:center;padding:20px;}
.modal-overlay.open{display:flex;}
.modal{background:var(--surface);border:1px solid var(--border2);border-radius:12px;width:100%;max-width:480px;padding:28px;animation:mIn 0.2s ease;}
@keyframes mIn{from{opacity:0;transform:scale(0.96) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-title{font-family:var(--font-display);font-size:1.4rem;letter-spacing:1px;margin-bottom:4px;}
.modal-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text3);letter-spacing:0.5px;margin-bottom:20px;}
.form-group{margin-bottom:14px;}
.fg-label{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;display:block;}
.fg-input{width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:10px 14px;color:var(--text);font-family:var(--font-mono);font-size:0.82rem;outline:none;transition:border-color 0.15s;letter-spacing:0.3px;}
.fg-input:focus{border-color:var(--accent);}
.fg-input::placeholder{color:var(--text3);}
.fg-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.search-results{max-height:200px;overflow-y:auto;margin-top:8px;display:flex;flex-direction:column;gap:4px;}
.sr-item{display:flex;align-items:center;gap:10px;padding:8px 10px;background:var(--bg2);border:1px solid var(--border);border-radius:6px;cursor:pointer;transition:all 0.12s;}
.sr-item:hover{border-color:var(--accent);}
.sr-thumb{width:28px;height:38px;object-fit:contain;border-radius:3px;}
.sr-name{font-size:0.8rem;font-weight:600;margin-bottom:1px;}
.sr-set{font-family:var(--font-mono);font-size:0.6rem;color:var(--text3);}
.sr-price{font-family:var(--font-display);font-size:0.9rem;color:var(--accent);margin-left:auto;flex-shrink:0;}
.modal-btns{display:flex;gap:8px;margin-top:20px;}
.btn-cancel{flex:1;padding:10px;border:1px solid var(--border);border-radius:6px;background:none;color:var(--text3);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;cursor:pointer;text-transform:uppercase;letter-spacing:0.5px;transition:all 0.15s;}
.btn-cancel:hover{border-color:var(--border2);color:var(--text2);}
.btn-add{flex:2;padding:10px;border:none;border-radius:6px;background:var(--accent);color:#08080d;font-family:var(--font-mono);font-size:0.72rem;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:1px;transition:all 0.15s;}
.btn-add:hover{box-shadow:0 0 16px var(--accent-glow);}
.btn-add:disabled{opacity:0.4;cursor:not-allowed;box-shadow:none;}

@media(max-width:900px){
  nav{padding:0 18px;}
  .nav-pills{display:none;}
  .main{padding:20px 18px 60px;}
  .page-header{padding:24px 18px 20px;}
  .kpi-row{grid-template-columns:repeat(3,1fr);}
  .cards-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));}
}
</style>
</head>
<body>

<nav>
  <div class="logo" onclick="window.location.href='pple-tcg.html'">PPLE<span class="dot">.</span>TCG</div>
  <div class="nav-pills">
    <button class="nav-tab" onclick="window.location.href='pple-tcg.html'">Mercado</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-vender.html'">Vender</button>
    <button class="nav-tab active">Portfolio</button>
    <button class="nav-tab" onclick="window.location.href='pple-tcg-mensajes.html'">Mensajes</button>
  </div>
  <div class="nav-right">
    <button class="btn-outline" onclick="openModal('raw')">+ A√±adir carta</button>
    <div class="nav-avatar">J</div>
  </div>
</nav>

<div class="page-header">
  <div class="ph-left">
    <div class="ph-eyebrow">Mi colecci√≥n ¬∑ Actualizado hoy</div>
    <div class="ph-title">PORTFOLIO</div>
    <div class="ph-user">@TrainerJuan ¬∑ Coleccionista desde 2021</div>
  </div>
  <div class="ph-right">
    <button class="btn-outline">Exportar CSV</button>
    <button class="btn-accent">+ A√±adir</button>
  </div>
</div>

<div class="main">

  <!-- KPI ROW -->
  <div class="kpi-row">
    <div class="kpi-card highlight">
      <div class="kc-label">Valor total</div>
      <div class="kc-val accent" id="totalValue">‚Ç¨0</div>
      <div class="kc-sub kc-up" id="totalChg">‚Äî</div>
    </div>
    <div class="kpi-card">
      <div class="kc-label">RAW</div>
      <div class="kc-val" id="rawValue">‚Ç¨0</div>
      <div class="kc-sub kc-flat" id="rawCount">0 cartas</div>
    </div>
    <div class="kpi-card">
      <div class="kc-label">Slabs PSA</div>
      <div class="kc-val" id="slabValue">‚Ç¨0</div>
      <div class="kc-sub kc-flat" id="slabCount">0 cartas</div>
    </div>
    <div class="kpi-card">
      <div class="kc-label">Sellado</div>
      <div class="kc-val" id="sealedValue">‚Ç¨0</div>
      <div class="kc-sub kc-flat" id="sealedCount">0 items</div>
    </div>
    <div class="kpi-card">
      <div class="kc-label">En venta</div>
      <div class="kc-val" id="forSaleVal">‚Ç¨0</div>
      <div class="kc-sub kc-flat" id="forSaleCount">0 anuncios</div>
    </div>
    <div class="kpi-card">
      <div class="kc-label">Coste total</div>
      <div class="kc-val" id="costVal">‚Ç¨0</div>
      <div class="kc-sub" id="pnlVal">‚Äî</div>
    </div>
  </div>

  <!-- CHART -->
  <div class="chart-section">
    <div class="cs-header">
      <div>
        <div class="cs-title">EVOLUCI√ìN DEL PORTFOLIO</div>
        <div class="cs-sub">Valor total estimado basado en precios de Cardmarket</div>
      </div>
      <div class="period-tabs">
        <button class="pt-btn" onclick="switchPeriod('1m',this)">1M</button>
        <button class="pt-btn active" onclick="switchPeriod('3m',this)">3M</button>
        <button class="pt-btn" onclick="switchPeriod('6m',this)">6M</button>
        <button class="pt-btn" onclick="switchPeriod('1y',this)">1A</button>
      </div>
    </div>
    <div class="chart-wrap">
      <svg class="portfolio-chart" id="portfolioChart" viewBox="0 0 1000 180"></svg>
      <div class="chart-tooltip" id="chartTooltip">
        <div class="ct-date" id="ttDate">‚Äî</div>
        <div class="ct-val" id="ttVal">‚Äî</div>
      </div>
    </div>
    <div class="chart-labels" id="chartLabels"></div>
  </div>

  <!-- RAW SECTION -->
  <div class="section">
    <div class="section-header">
      <div class="sh-left">
        <div class="sh-icon raw">üÉè</div>
        <div>
          <div class="sh-title">RAW</div>
          <div class="sh-count" id="rawSectionCount">0 cartas</div>
        </div>
      </div>
      <div class="sh-right">
        <div class="sh-value" id="rawSectionVal">‚Ç¨0</div>
        <button class="add-btn" onclick="openModal('raw')">+ A√±adir</button>
      </div>
    </div>
    <div class="cards-grid" id="rawGrid"></div>
  </div>

  <!-- PSA SECTION -->
  <div class="section">
    <div class="section-header">
      <div class="sh-left">
        <div class="sh-icon psa">üèÜ</div>
        <div>
          <div class="sh-title">SLABS PSA</div>
          <div class="sh-count" id="psaSectionCount">0 cartas</div>
        </div>
      </div>
      <div class="sh-right">
        <div class="sh-value" id="psaSectionVal">‚Ç¨0</div>
        <button class="add-btn" onclick="openModal('psa')">+ A√±adir</button>
      </div>
    </div>
    <div class="cards-grid" id="psaGrid"></div>
  </div>

  <!-- SEALED SECTION -->
  <div class="section">
    <div class="section-header">
      <div class="sh-left">
        <div class="sh-icon sealed">üì¶</div>
        <div>
          <div class="sh-title">PRODUCTO SELLADO</div>
          <div class="sh-count" id="sealedSectionCount">0 items</div>
        </div>
      </div>
      <div class="sh-right">
        <div class="sh-value" id="sealedSectionVal">‚Ç¨0</div>
        <button class="add-btn" onclick="openModal('sealed')">+ A√±adir</button>
      </div>
    </div>
    <div class="sealed-grid" id="sealedGrid"></div>
  </div>

  <!-- WISHLIST -->
  <div class="section">
    <div class="section-header">
      <div class="sh-left">
        <div class="sh-icon wish">‚ù§Ô∏è</div>
        <div>
          <div class="sh-title">WISHLIST</div>
          <div class="sh-count" id="wishCount">0 cartas buscadas</div>
        </div>
      </div>
      <div class="sh-right">
        <button class="add-btn" onclick="openModal('wish')">+ A√±adir</button>
      </div>
    </div>
    <div class="wish-grid" id="wishGrid"></div>
  </div>

</div>

<!-- ADD MODAL -->
<div class="modal-overlay" id="addModal" onclick="closeModalOverlay(event)">
  <div class="modal">
    <div class="modal-title" id="modalTitle">A√ëADIR CARTA</div>
    <div class="modal-sub" id="modalSub">Busca la carta en el cat√°logo</div>
    <div class="form-group">
      <label class="fg-label">Buscar carta</label>
      <input class="fg-input" type="text" id="modalSearch" placeholder="Nombre de la carta..." oninput="modalSearchCards(this.value)">
      <div class="search-results" id="modalResults"></div>
    </div>
    <div id="modalExtraFields" style="display:none">
      <div class="fg-row" id="modalCondRow">
        <div class="form-group">
          <label class="fg-label" id="modalCondLabel">Estado</label>
          <select class="fg-input" id="modalCond">
            <option value="NM">NM ‚Äî Near Mint</option>
            <option value="LP">LP ‚Äî Lightly Played</option>
            <option value="MP">MP ‚Äî Moderately Played</option>
          </select>
        </div>
        <div class="form-group">
          <label class="fg-label">Precio pagado (‚Ç¨)</label>
          <input class="fg-input" type="number" id="modalPaid" placeholder="0.00" step="0.01">
        </div>
      </div>
      <div class="form-group" id="modalSaleRow" style="display:none">
        <label class="fg-label">¬øPoner en venta?</label>
        <select class="fg-input" id="modalSale">
          <option value="no">No, solo en portfolio</option>
          <option value="yes">S√≠, publicar anuncio</option>
        </select>
      </div>
    </div>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="document.getElementById('addModal').classList.remove('open')">Cancelar</button>
      <button class="btn-add" id="btnModalAdd" onclick="addToPortfolio()" disabled>A√±adir al portfolio</button>
    </div>
  </div>
</div>

<script>
const BASE = 'https://api.tcgdex.net/v2/en';
let modalMode = 'raw';
let selectedModalCard = null;
let searchTimer = null;

// ---- PORTFOLIO DATA ----
const portfolio = {
  raw: [
    { id:'sv3-3',    name:'Charizard ex',    set:'Obsidian Flames',   img:'https://assets.tcgdex.net/univ/sv/sv03/3/high.png',   cond:'NM', price:124.50, paid:89.00,  forSale:true  },
    { id:'sv2-83',   name:'Pikachu ex',      set:'Paldea Evolved',    img:'https://assets.tcgdex.net/univ/sv/sv02/83/high.png',  cond:'NM', price:84.20,  paid:60.00,  forSale:false },
    { id:'sv5-95',   name:'Umbreon ex',      set:'Temporal Forces',   img:'https://assets.tcgdex.net/univ/sv/sv05/95/high.png',  cond:'LP', price:67.30,  paid:55.00,  forSale:false },
    { id:'sv4-84',   name:'Gardevoir ex',    set:'Paradox Rift',      img:'https://assets.tcgdex.net/univ/sv/sv04/84/high.png',  cond:'NM', price:45.80,  paid:32.00,  forSale:false },
    { id:'sv6-210',  name:'Iron Valiant ex', set:'Twilight Masquerade',img:'https://assets.tcgdex.net/univ/sv/sv06/210/high.png',cond:'NM', price:38.20,  paid:28.00,  forSale:true  },
    { id:'sv1-198',  name:'Miraidon ex',     set:'Scarlet & Violet',  img:'https://assets.tcgdex.net/univ/sv/sv01/198/high.png', cond:'NM', price:52.40,  paid:44.00,  forSale:false },
  ],
  psa: [
    { id:'sv3pt5-11',name:'Mewtwo ex',       set:'151',               img:'https://assets.tcgdex.net/univ/sv/sv3pt5/11/high.png',grade:'PSA10',price:210.00,paid:145.00,forSale:false,cert:'45821937' },
    { id:'sv03-125', name:'Tyranitar ex',    set:'Obsidian Flames',   img:'https://assets.tcgdex.net/univ/sv/sv03/125/high.png', grade:'PSA9', price:89.00, paid:65.00, forSale:true, cert:'45821938' },
    { id:'sv02-201', name:'Sylveon ex',      set:'Paldea Evolved',    img:'https://assets.tcgdex.net/univ/sv/sv02/201/high.png', grade:'PSA9', price:55.00, paid:38.00, forSale:false,cert:'45821939' },
  ],
  sealed: [
    { name:'Booster Box Obsidian Flames',  set:'Obsidian Flames',  type:'Booster Box', price:185.00, paid:130.00, trend:'+42%', qty:1,   img:'üì¶' },
    { name:'Elite Trainer Box 151',        set:'Scarlet & Violet 151',type:'ETB',      price:89.00,  paid:65.00,  trend:'+37%', qty:2,   img:'üéÅ' },
    { name:'Booster Bundle Temporal Forces',set:'Temporal Forces', type:'Bundle',      price:38.00,  paid:28.00,  trend:'+36%', qty:3,   img:'üì¶' },
    { name:'Charizard ex Premium Collection',set:'Promos',         type:'Collection', price:62.00,  paid:49.99,  trend:'+24%', qty:1,   img:'‚≠ê' },
  ],
  wishlist: [
    { id:'sv06-191', name:'Pecharunt ex',    set:'Twilight Masquerade',img:'https://assets.tcgdex.net/univ/sv/sv06/191/high.png', price:28.70, target:24.00 },
    { id:'sv3pt5-205',name:'Mew ex',         set:'151',               img:'https://assets.tcgdex.net/univ/sv/sv3pt5/205/high.png',price:32.10, target:25.00 },
    { id:'sv05-176', name:'Terapagos ex',    set:'Temporal Forces',   img:'https://assets.tcgdex.net/univ/sv/sv05/176/high.png',  price:41.50, target:35.00 },
    { id:'sv04-197', name:'Walking Wake ex', set:'Paradox Rift',      img:'https://assets.tcgdex.net/univ/sv/sv04/197/high.png',  price:19.80, target:15.00 },
  ]
};

// ---- COMPUTE TOTALS ----
function computeTotals() {
  const rawVal   = portfolio.raw.reduce((s,c) => s+c.price, 0);
  const slabVal  = portfolio.psa.reduce((s,c) => s+c.price, 0);
  const sealVal  = portfolio.sealed.reduce((s,c) => s+c.price*c.qty, 0);
  const totalVal = rawVal + slabVal + sealVal;
  const totalCost= [...portfolio.raw,...portfolio.psa].reduce((s,c)=>s+c.paid,0)
                 + portfolio.sealed.reduce((s,c)=>s+c.paid*c.qty,0);
  const forSaleItems = [...portfolio.raw,...portfolio.psa].filter(c=>c.forSale);
  const forSaleVal = forSaleItems.reduce((s,c)=>s+c.price,0);
  const pnl = totalVal - totalCost;

  document.getElementById('totalValue').textContent  = fmt(totalVal);
  document.getElementById('totalChg').textContent    = `‚ñ≤ +${((pnl/totalCost)*100).toFixed(1)}% desde coste`;
  document.getElementById('rawValue').textContent    = fmt(rawVal);
  document.getElementById('rawCount').textContent    = `${portfolio.raw.length} cartas`;
  document.getElementById('slabValue').textContent   = fmt(slabVal);
  document.getElementById('slabCount').textContent   = `${portfolio.psa.length} slabs`;
  document.getElementById('sealedValue').textContent = fmt(sealVal);
  document.getElementById('sealedCount').textContent = `${portfolio.sealed.reduce((s,c)=>s+c.qty,0)} items`;
  document.getElementById('forSaleVal').textContent  = fmt(forSaleVal);
  document.getElementById('forSaleCount').textContent= `${forSaleItems.length} anuncios`;
  document.getElementById('costVal').textContent     = fmt(totalCost);
  const pnlEl = document.getElementById('pnlVal');
  pnlEl.textContent = `${pnl>=0?'‚ñ≤ +':'‚ñº '}${fmt(pnl)} P&L`;
  pnlEl.className = 'kc-sub ' + (pnl>=0?'kc-up':'kc-down');

  document.getElementById('rawSectionCount').textContent  = `${portfolio.raw.length} cartas`;
  document.getElementById('rawSectionVal').textContent    = fmt(rawVal);
  document.getElementById('psaSectionCount').textContent  = `${portfolio.psa.length} cartas`;
  document.getElementById('psaSectionVal').textContent    = fmt(slabVal);
  document.getElementById('sealedSectionCount').textContent = `${portfolio.sealed.reduce((s,c)=>s+c.qty,0)} items`;
  document.getElementById('sealedSectionVal').textContent   = fmt(sealVal);
  document.getElementById('wishCount').textContent = `${portfolio.wishlist.length} cartas buscadas`;

  return totalVal;
}

function fmt(v) { return `‚Ç¨${parseFloat(v).toFixed(2)}`; }

// ---- RENDER GRIDS ----
function renderGrids() {
  // RAW
  document.getElementById('rawGrid').innerHTML = portfolio.raw.length
    ? portfolio.raw.map(c => `
      <div class="pcard ${c.forSale?'for-sale':''}">
        <div class="pcard-img">
          <img src="${c.img}" alt="${c.name}" onerror="this.parentNode.innerHTML='üé¥'">
          <div class="cond-raw raw-${c.cond.toLowerCase()}">${c.cond}</div>
        </div>
        <div class="pcard-body">
          <div class="pc-name">${c.name}</div>
          <div class="pc-set">${c.set}</div>
          <div class="pc-footer">
            <div class="pc-price">${fmt(c.price)}</div>
            <div class="pc-chg ${c.price>c.paid?'chg-up':'chg-down'}">${c.price>c.paid?'‚ñ≤':'‚ñº'} ${Math.abs(((c.price-c.paid)/c.paid)*100).toFixed(0)}%</div>
          </div>
          <div class="pc-paid">Coste: ${fmt(c.paid)}</div>
        </div>
      </div>`).join('')
    : emptyState('A√±ade tu primera carta RAW','Escanea o busca manualmente','raw');

  // PSA
  document.getElementById('psaGrid').innerHTML = portfolio.psa.length
    ? portfolio.psa.map(c => {
        const gc = c.grade==='PSA10'?'grade-10':c.grade==='PSA9'?'grade-9':'grade-8';
        return `
      <div class="pcard is-slab ${c.forSale?'for-sale':''}">
        <div class="pcard-img">
          <img src="${c.img}" alt="${c.name}" onerror="this.parentNode.innerHTML='üèÜ'">
          <div class="pc-grade ${gc}">${c.grade.replace('PSA','PSA ')}</div>
        </div>
        <div class="pcard-body">
          <div class="pc-name">${c.name}</div>
          <div class="pc-set">${c.set} ¬∑ #${c.cert}</div>
          <div class="pc-footer">
            <div class="pc-price">${fmt(c.price)}</div>
            <div class="pc-chg ${c.price>c.paid?'chg-up':'chg-down'}">${c.price>c.paid?'‚ñ≤':'‚ñº'} ${Math.abs(((c.price-c.paid)/c.paid)*100).toFixed(0)}%</div>
          </div>
          <div class="pc-paid">Coste: ${fmt(c.paid)}</div>
        </div>
      </div>`}).join('')
    : emptyState('A√±ade tu primera slab PSA','Declara el grado y n√∫mero de certificado','psa');

  // SEALED
  document.getElementById('sealedGrid').innerHTML = portfolio.sealed.length
    ? portfolio.sealed.map(p => `
      <div class="sealed-card">
        <div class="sc-img"><span style="font-size:3rem">${p.img}</span></div>
        <div class="sc-body">
          <div class="sc-type"><span class="sealed-badge">üì¶ ${p.type}</span></div>
          <div class="sc-name">${p.name}</div>
          <div class="sc-set">${p.set}</div>
          <div class="sc-footer">
            <div class="sc-price">${fmt(p.price*p.qty)}</div>
            <div class="sc-trend chg-up">‚ñ≤ ${p.trend}</div>
          </div>
          <div class="sc-qty">x${p.qty} ¬∑ Coste: ${fmt(p.paid*p.qty)}</div>
        </div>
      </div>`).join('')
    : emptyState('A√±ade producto sellado','Displays, ETBs, Booster Boxes...','sealed');

  // WISHLIST
  document.getElementById('wishGrid').innerHTML = portfolio.wishlist.length
    ? portfolio.wishlist.map(w => {
        const diff = w.price - w.target;
        const isClose = diff <= w.target * 0.1;
        return `
      <div class="wish-item">
        <img class="wi-img" src="${w.img}" onerror="this.style.display='none'" alt="">
        <div class="wi-info">
          <div class="wi-name">${w.name}</div>
          <div class="wi-set">${w.set}</div>
          <div class="wi-target">Objetivo: <span>${fmt(w.target)}</span></div>
        </div>
        <div class="wi-price">
          <div class="wi-current">${fmt(w.price)}</div>
          <div class="wi-diff ${isClose?'chg-up':'chg-down'}">${isClose?'‚úì Cerca!':'‚ñ≤ '+fmt(diff)+' lejos'}</div>
        </div>
        <div class="wi-alert active" title="Alerta de precio activada">üîî</div>
      </div>`}).join('')
    : emptyState('Tu wishlist est√° vac√≠a','A√±ade cartas que est√©s buscando a buen precio','wish');
}

function emptyState(title, sub, mode) {
  return `<div class="empty-state" onclick="openModal('${mode}')">
    <div class="es-icon">+</div>
    <div class="es-title">${title}</div>
    <div class="es-sub">${sub}</div>
  </div>`;
}

// ---- CHART ----
const PERIODS = {
  '1m': { points:30, label:'√öltimo mes',   labels:['1 Feb','8 Feb','15 Feb','22 Feb','Hoy'] },
  '3m': { points:90, label:'3 meses',      labels:['Nov','Dic','Ene','Feb','Hoy'] },
  '6m': { points:180,label:'6 meses',      labels:['Ago','Sep','Oct','Nov','Dic','Hoy'] },
  '1y': { points:365,label:'Este a√±o',     labels:['Mar','May','Jul','Sep','Nov','Hoy'] },
};
let currentPeriod = '3m';

function buildChartData(period, endVal) {
  const n = PERIODS[period].points;
  const points = [];
  // Start lower, trend upward with some noise
  const startVal = endVal * (period==='1m'?0.88:period==='3m'?0.72:period==='6m'?0.58:0.42);
  for (let i=0;i<n;i++) {
    const t = i/(n-1);
    const trend = startVal + (endVal-startVal)*Math.pow(t,0.8);
    const noise = trend*(0.97+Math.random()*0.06);
    points.push(i===n-1?endVal:noise);
  }
  return points;
}

function drawPortfolioChart(period, totalVal) {
  const svg = document.getElementById('portfolioChart');
  const W=1000, H=180, padX=8, padY=16;
  const points = buildChartData(period, totalVal);
  const mn=Math.min(...points)*0.97, mx=Math.max(...points)*1.03;
  const range=mx-mn||1;
  const x = i => padX + (i/(points.length-1))*(W-padX*2);
  const y = v => H-padY-((v-mn)/range)*(H-padY*2);
  const trend = points[points.length-1]-points[0];
  const col = trend>=0?'var(--nm)':'var(--mp)';
  const line = points.map((p,i)=>`${i===0?'M':'L'}${x(i).toFixed(1)},${y(p).toFixed(1)}`).join(' ');
  const area = line+` L${x(points.length-1).toFixed(1)},${H} L${x(0).toFixed(1)},${H} Z`;
  // Grid lines
  let grid='';
  for(let i=0;i<4;i++){
    const yg=(padY + i*(H-padY*2)/3).toFixed(1);
    const val=(mn+range*(1-i/3)).toFixed(0);
    grid+=`<line x1="${padX}" y1="${yg}" x2="${W-padX}" y2="${yg}" stroke="rgba(255,255,255,0.04)" stroke-width="1"/>`;
    grid+=`<text x="${padX+4}" y="${parseFloat(yg)-4}" font-family="DM Mono" font-size="11" fill="rgba(255,255,255,0.2)">‚Ç¨${val}</text>`;
  }
  svg.innerHTML=`<defs>
    <linearGradient id="cg" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="${col}" stop-opacity="0.18"/>
      <stop offset="100%" stop-color="${col}" stop-opacity="0.01"/>
    </linearGradient>
  </defs>
  ${grid}
  <path d="${area}" fill="url(#cg)"/>
  <path d="${line}" stroke="${col}" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
  <circle cx="${x(points.length-1).toFixed(1)}" cy="${y(points[points.length-1]).toFixed(1)}" r="5" fill="${col}" stroke="var(--bg2)" stroke-width="2.5"/>`;

  document.getElementById('chartLabels').innerHTML =
    PERIODS[period].labels.map(l=>`<span class="chart-lbl">${l}</span>`).join('');
}

function switchPeriod(p, btn) {
  currentPeriod=p;
  document.querySelectorAll('.pt-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const total=computeTotals();
  drawPortfolioChart(p, total);
}

// ---- MODAL ----
function openModal(mode) {
  modalMode=mode; selectedModalCard=null;
  document.getElementById('addModal').classList.add('open');
  document.getElementById('modalSearch').value='';
  document.getElementById('modalResults').innerHTML='';
  document.getElementById('modalExtraFields').style.display='none';
  document.getElementById('btnModalAdd').disabled=true;

  const titles={raw:'A√ëADIR CARTA RAW',psa:'A√ëADIR SLAB PSA',sealed:'A√ëADIR PRODUCTO SELLADO',wish:'A√ëADIR A WISHLIST'};
  const subs={raw:'Busca en el cat√°logo y declara el estado',psa:'Busca la carta y a√±ade el grado PSA',sealed:'A√±ade un producto sellado a tu colecci√≥n',wish:'Cartas que quieres comprar a un precio objetivo'};
  document.getElementById('modalTitle').textContent=titles[mode]||'A√ëADIR';
  document.getElementById('modalSub').textContent=subs[mode]||'';

  // Adapt fields for PSA
  if(mode==='psa') {
    document.getElementById('modalCondLabel').textContent='Grado PSA';
    document.getElementById('modalCond').innerHTML=`<option value="PSA10">PSA 10</option><option value="PSA9">PSA 9</option><option value="PSA8">PSA 8</option>`;
  } else {
    document.getElementById('modalCondLabel').textContent='Estado';
    document.getElementById('modalCond').innerHTML=`<option value="NM">NM ‚Äî Near Mint</option><option value="LP">LP ‚Äî Lightly Played</option><option value="MP">MP ‚Äî Moderately Played</option>`;
  }
}

function closeModalOverlay(e) {
  if(e.target===document.getElementById('addModal'))
    document.getElementById('addModal').classList.remove('open');
}

let mTimer=null;
async function modalSearchCards(q) {
  clearTimeout(mTimer);
  if(q.length<2){document.getElementById('modalResults').innerHTML='';return;}
  mTimer=setTimeout(async()=>{
    try {
      const r=await fetch(`${BASE}/cards?name=${encodeURIComponent(q)}`);
      const cards=await r.json();
      if(!Array.isArray(cards)||!cards.length){
        document.getElementById('modalResults').innerHTML='<div style="padding:8px;font-family:var(--font-mono);font-size:0.7rem;color:var(--text3)">Sin resultados</div>';
        return;
      }
      document.getElementById('modalResults').innerHTML=cards.slice(0,6).map(c=>`
        <div class="sr-item" onclick="selectModalCard(${JSON.stringify(c).replace(/"/g,'&quot;')})">
          <img class="sr-thumb" src="${c.image?c.image+'/low.png':''}" onerror="this.style.display='none'">
          <div>
            <div class="sr-name">${c.name}</div>
            <div class="sr-set">${c.set?.name||'‚Äî'} ¬∑ #${c.localId}</div>
          </div>
          <div class="sr-price" id="mp-${c.id}">‚Äî</div>
        </div>`).join('');
      cards.slice(0,6).forEach(async c=>{
        try{
          const dr=await fetch(`${BASE}/cards/${c.id}`);
          const d=await dr.json();
          const p=d.pricing?.cardmarket?.trend;
          const el=document.getElementById(`mp-${c.id}`);
          if(el)el.textContent=p?`‚Ç¨${parseFloat(p).toFixed(2)}`:'‚Äî';
        }catch(e){}
      });
    } catch(e){}
  },350);
}

function selectModalCard(card) {
  selectedModalCard=card;
  document.getElementById('modalSearch').value=card.name;
  document.getElementById('modalResults').innerHTML=`
    <div style="display:flex;align-items:center;gap:10px;padding:8px 10px;background:var(--accent-dim);border:1px solid rgba(212,245,60,0.2);border-radius:6px;">
      <img class="sr-thumb" src="${card.image?card.image+'/low.png':''}" onerror="this.style.display='none'">
      <div style="flex:1"><div class="sr-name">${card.name}</div><div class="sr-set">${card.set?.name||'‚Äî'} ¬∑ #${card.localId}</div></div>
      <div style="color:var(--nm);font-family:var(--font-mono);font-size:0.7rem">‚úì Seleccionada</div>
    </div>`;
  document.getElementById('modalExtraFields').style.display='block';
  document.getElementById('btnModalAdd').disabled=false;
}

function addToPortfolio() {
  if(!selectedModalCard)return;
  const cond=document.getElementById('modalCond').value;
  const paid=parseFloat(document.getElementById('modalPaid').value)||0;
  const entry={
    id:selectedModalCard.id, name:selectedModalCard.name,
    set:selectedModalCard.set?.name||'‚Äî',
    img:selectedModalCard.image?selectedModalCard.image+'/high.png':null,
    price:paid||20, paid:paid, forSale:false
  };
  if(modalMode==='raw'){entry.cond=cond;portfolio.raw.push(entry);}
  else if(modalMode==='psa'){entry.grade=cond;entry.cert='‚Äî';portfolio.psa.push(entry);}
  else if(modalMode==='wish'){entry.target=paid;portfolio.wishlist.push(entry);}
  document.getElementById('addModal').classList.remove('open');
  const total=computeTotals();
  renderGrids();
  drawPortfolioChart(currentPeriod,total);
}

// ---- INIT ----
const total=computeTotals();
renderGrids();
drawPortfolioChart(currentPeriod,total);
</script>
</body>
</html>
